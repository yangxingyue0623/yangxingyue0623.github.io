<a name=top></a><!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Hugo-HT</title><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/fonts.css><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/r.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/bash.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/python.min.js></script><script src=https://cdn.jsdelivr.net/npm/vega@5.17.0></script><script src=https://cdn.jsdelivr.net/npm/vega-lite@4.17.0></script><script src=https://cdn.jsdelivr.net/npm/vega-embed@6.12.2></script><script>hljs.initHighlightingOnLoad();</script><link rel=icon href=https://yangxingyue0623.github.io/media/hugo-logo.png></head><body><div class=wrapper><header class=header><nav class=nav><a href=/ class=nav-logo><img src=/media/hugo-logo.png width=50 height=50 alt=Hugo-ht></a><ul class=nav-links><li><a href=/>主页</a></li><li><a href=/cn/about/>关于</a></li><li><a href=/cn/posts/>博客</a></li><li><a href=/en/about>English</a></li></ul></nav></header><main class=content role=main><div style=text-align:center><h1>springboot项目Eatting外卖</h1><p>yangxingyue0623
/ 2022-12-01</p><hr></div><span class=article-toolbar><a href=https://github.com/yangxingyue0623/yangxingyue0623.github.io/edit/master/content/cn/posts/2021-01-07-springbootEatting.md style=font-size:24px;color:#000 target=_blank><i class="fa fa-edit" aria-hidden=true title=编辑本页></i></a></span><div class="body-text list-text"><p>Eating外卖</p><p>[toc]</p><h1 id=项目的最终部署>项目的最终部署<a href=#项目的最终部署 class=header-anchor arialabel=Anchor> #</a></h1><p>项目的部署架构</p><p><img src=https://img-blog.csdnimg.cn/img_convert/18cb4a8eab7562dc09d2f89735202999.png alt=image-20210901221425159></p><blockquote><p>我用了虚拟机A（192.168.8.131）虚拟机B（192.168.8.130）</p><p>虚拟机A （nginx前端部署，主库）</p><p>虚拟机B（后端项目部署，从库，redis缓存）</p></blockquote><h1 id=github源码地址httpsgithubcomyangxingyue0623eating_take_out>Github:<a href=https://github.com/yangxingyue0623/Eating_Take_Out target=_blank rel="noreferrer noopener">源码地址</a></h1><h1 id=gitee-源码地址httpsgiteecomyangxingyue0623reggie_take_outgit>gitee :<a href=https://gitee.com/yangxingyue0623/reggie_take_out.git target=_blank rel="noreferrer noopener">源码地址</a></h1><h2 id=1项目介绍>1.项目介绍<a href=#1项目介绍 class=header-anchor arialabel=Anchor> #</a></h2><blockquote><ul><li><p>本项目Eatting外卖是专门为餐饮企业（餐厅、饭店）定制的一款软件产品，包括 系统管理后台 和 移动端应用 两部分。</p></li><li><p>系统管理后台主要提供给餐饮企业内部员工使用，可以对餐厅的分类、菜品、套餐、订单、员工等进行管理维护。</p></li><li><p>移动端应用主要提供给消费者使用，可以在线浏览菜品、添加购物车、下单等。</p></li></ul></blockquote><h3 id=11-管理端>1.1 管理端<a href=#11-管理端 class=header-anchor arialabel=Anchor> #</a></h3><blockquote><p>餐饮企业内部员工使用。 主要功能有:</p></blockquote><table><thead><tr><th>模块</th><th style=text-align:left>描述</th></tr></thead><tbody><tr><td>登录/退出</td><td style=text-align:left>内部员工必须登录后,才可以访问系统管理后台</td></tr><tr><td>员工管理</td><td style=text-align:left>管理员可以在系统后台对员工信息进行管理，包含查询、新增、编辑、禁用等功能</td></tr><tr><td>分类管理</td><td style=text-align:left>主要对当前餐厅经营的 菜品分类 或 套餐分类 进行管理维护， 包含查询、新增、修改、删除等功能</td></tr><tr><td>菜品管理</td><td style=text-align:left>主要维护各个分类下的菜品信息，包含查询、新增、修改、删除、启售、停售等功能</td></tr><tr><td>套餐管理</td><td style=text-align:left>主要维护当前餐厅中的套餐信息，包含查询、新增、修改、删除、启售、停售等功能</td></tr><tr><td>订单明细</td><td style=text-align:left>主要维护用户在移动端下的订单信息，包含查询、取消、派送、完成，以及订单报表下载等功能</td></tr></tbody></table><h3 id=12-移动端>1.2 移动端<a href=#12-移动端 class=header-anchor arialabel=Anchor> #</a></h3><blockquote><p>移动端应用主要提供给消费者使用。主要功能有:</p></blockquote><table><thead><tr><th>模块</th><th>描述</th></tr></thead><tbody><tr><td>登录/退出</td><td>在移动端, 用户也需要登录后使用APP进行点餐</td></tr><tr><td>个人信息</td><td>在个人中心页面中会展示当前用户的基本信息, 用户可以管理收货地址, 也可以查询历史订单数据</td></tr><tr><td>点餐-购物车</td><td>用户选中的菜品就会加入用户的购物车, 主要包含 查询购物车、加入购物车、删除购物车、清空购物车等功能</td></tr><tr><td>订单支付</td><td>用户选完菜品/套餐后, 可以对购物车菜品进行结算支付, 这时就需要进行订单的支付</td></tr><tr><td>点餐-菜单</td><td>在点餐界面需要展示出菜品分类/套餐分类, 并根据当前选择的分类加载其中的菜品信息, 供用户查询选择</td></tr></tbody></table><h2 id=2项目技术栈>2.项目技术栈<a href=#2项目技术栈 class=header-anchor arialabel=Anchor> #</a></h2><blockquote><p>关于本项目的技术选型, 我们将会从 用户层、网关层、应用层、数据层 这几个方面进行介绍，而对于我们服务端开发工程师来说，在项目开发过程中，我们主要关注应用层及数据层技术的应用。</p></blockquote><h3 id=21用户层h5vuejselementui>2.1用户层H5,Vue.js,ElementUI<a href=#21用户层h5vuejselementui class=header-anchor arialabel=Anchor> #</a></h3><blockquote><p>本项目中在构建系统管理后台的前端页面，我们会用到H5、Vue.js、ElementUI等技术。而在构建移动端应用时，我们会使用到微信小程序。</p></blockquote><h3 id=22网关层-nginx部署静态资源反向代理和负载均衡>2.2网关层 Nginx(部署静态资源,反向代理和负载均衡)<a href=#22网关层-nginx部署静态资源反向代理和负载均衡 class=header-anchor arialabel=Anchor> #</a></h3><blockquote><p>Nginx是一个服务器，主要用来作为Http服务器，部署静态资源，访问性能高。在Nginx中还有两个比较重要的作用： 反向代理和负载均衡， 在进行项目部署时，要实现Tomcat的负载均衡，就可以通过Nginx来实现。</p></blockquote><h3 id=23应用层-springbootspringmvcspringsessionlombackswagger>2.3.应用层 springboot+springmvc+springsession+lomback+swagger<a href=#23应用层-springbootspringmvcspringsessionlombackswagger class=header-anchor arialabel=Anchor> #</a></h3><ul><li>SpringBoot： 快速构建Spring项目, 采用 &ldquo;约定优于配置&rdquo; 的思想, 简化Spring项目的配置开发。</li><li>Spring: 统一管理项目中的各种资源(bean), 在web开发的各层中都会用到。</li><li>SpringMVC：SpringMVC是spring框架的一个模块，springmvc和spring无需通过中间整合层进行整合，可以无缝集成。</li><li>SpringSession: 主要解决在集群环境下的Session共享问题。</li><li>lombok：能以简单的注解形式来简化java代码，提高开发人员的开发效率。例如开发中经常需要写的javabean，都需要花时间去添加相应的getter/setter，也许还要去写构造器、equals等方法。</li><li>Swagger： 可以自动的帮助开发人员生成接口文档，并对接口进行测试。</li></ul><h3 id=24数据层-mysqlmybatisplusredisspringcacahe>2.4数据层 mysql+mybatisplus+redis+springcacahe<a href=#24数据层-mysqlmybatisplusredisspringcacahe class=header-anchor arialabel=Anchor> #</a></h3><ul><li><p>MySQL： 关系型数据库, 本项目的核心业务数据都会采用MySQL进行存储。</p></li><li><p>MybatisPlus： 本项目持久层将会使用MybatisPlus来简化开发, 基本的单表增删改查直接调用框架提供的方法即可。</p></li><li><p>Redis： 基于key-value格式存储的内存数据库, 访问速度快, 经常使用它做缓存(降低数据库访问压力, 提供访问效率), 在后面的性能优化中会使用。</p></li><li><p>springcache:基于注解实现项目的缓存</p></li></ul><h3 id=25工具-gitmavenjunitpostmanlinux>2.5工具 Git+Maven+Junit+Postman+Linux<a href=#25工具-gitmavenjunitpostmanlinux class=header-anchor arialabel=Anchor> #</a></h3><ul><li><p>Git: 版本控制工具, 在团队协作中, 使用该工具对项目中的代码进行管理。</p></li><li><p>Maven: 项目构建工具。</p></li><li><p>Junit：单元测试工具，开发人员功能实现完毕后，需要通过junit对功能进行单元测试。</p></li><li><p>postman :用于前后端接口进行接口测试。</p></li><li><p>Linux:利用sh脚本进行项目的自动部署</p></li></ul><h3 id=26用户角色>2.6用户角色<a href=#26用户角色 class=header-anchor arialabel=Anchor> #</a></h3><blockquote><p>在瑞吉外卖这个项目中，存在以下三种用户，这三种用户对应三个角色： 后台系统管理员、后台系统普通员工、C端(移动端)用户。</p></blockquote><table><thead><tr><th>角色</th><th>权限操作</th></tr></thead><tbody><tr><td>后台系统管理员</td><td>登录后台管理系统，拥有后台系统中的所有操作权限</td></tr><tr><td>后台系统普通员工</td><td>登录后台管理系统，对菜品、套餐、订单等进行管理 (不包含员工管理)</td></tr><tr><td>C端用户</td><td>登录移动端应用，可以浏览菜品、添加购物车、设置地址、在线下单等</td></tr></tbody></table><h2 id=3项目的依赖>3.项目的依赖<a href=#3项目的依赖 class=header-anchor arialabel=Anchor> #</a></h2><h3 id=31版本>3.1版本<a href=#31版本 class=header-anchor arialabel=Anchor> #</a></h3><ul><li>springboot 2.7.5</li><li>maven 3.6</li><li>idea 2020.2</li><li>VMware Workstation Pro 15</li><li>xshell 7</li><li>nginx 1.20.1</li><li>node 12v mong 4.17</li></ul><h3 id=32pomxml文件>3.2pom.xml文件<a href=#32pomxml文件 class=header-anchor arialabel=Anchor> #</a></h3><div class=highlight><pre style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml>    <span style=color:green;font-weight:700>&lt;/dependency&gt;</span>
        <span style=color:#408080;font-style:italic>&lt;!-- springcache--&gt;</span>
        <span style=color:green;font-weight:700>&lt;dependency&gt;</span>
            <span style=color:green;font-weight:700>&lt;groupId&gt;</span>org.springframework.boot<span style=color:green;font-weight:700>&lt;/groupId&gt;</span>
            <span style=color:green;font-weight:700>&lt;artifactId&gt;</span>spring-boot-starter-cache<span style=color:green;font-weight:700>&lt;/artifactId&gt;</span>
        <span style=color:green;font-weight:700>&lt;/dependency&gt;</span>
        <span style=color:green;font-weight:700>&lt;dependency&gt;</span>
            <span style=color:green;font-weight:700>&lt;groupId&gt;</span>org.springframework.boot<span style=color:green;font-weight:700>&lt;/groupId&gt;</span>
            <span style=color:green;font-weight:700>&lt;artifactId&gt;</span>spring-boot-starter-test<span style=color:green;font-weight:700>&lt;/artifactId&gt;</span>
            <span style=color:green;font-weight:700>&lt;scope&gt;</span>test<span style=color:green;font-weight:700>&lt;/scope&gt;</span>
        <span style=color:green;font-weight:700>&lt;/dependency&gt;</span>
        <span style=color:#408080;font-style:italic>&lt;!-- web --&gt;</span>
        <span style=color:green;font-weight:700>&lt;dependency&gt;</span>
            <span style=color:green;font-weight:700>&lt;groupId&gt;</span>org.springframework.boot<span style=color:green;font-weight:700>&lt;/groupId&gt;</span>
            <span style=color:green;font-weight:700>&lt;artifactId&gt;</span>spring-boot-starter-web<span style=color:green;font-weight:700>&lt;/artifactId&gt;</span>
            <span style=color:green;font-weight:700>&lt;scope&gt;</span>compile<span style=color:green;font-weight:700>&lt;/scope&gt;</span>
        <span style=color:green;font-weight:700>&lt;/dependency&gt;</span>
        <span style=color:#408080;font-style:italic>&lt;!--lombok --&gt;</span>
        <span style=color:green;font-weight:700>&lt;dependency&gt;</span>
            <span style=color:green;font-weight:700>&lt;groupId&gt;</span>org.projectlombok<span style=color:green;font-weight:700>&lt;/groupId&gt;</span>
            <span style=color:green;font-weight:700>&lt;artifactId&gt;</span>lombok<span style=color:green;font-weight:700>&lt;/artifactId&gt;</span>
            <span style=color:green;font-weight:700>&lt;version&gt;</span>1.18.24<span style=color:green;font-weight:700>&lt;/version&gt;</span>
        <span style=color:green;font-weight:700>&lt;/dependency&gt;</span>
        <span style=color:#408080;font-style:italic>&lt;!--fastjson --&gt;</span>
        <span style=color:green;font-weight:700>&lt;dependency&gt;</span>
            <span style=color:green;font-weight:700>&lt;groupId&gt;</span>com.alibaba<span style=color:green;font-weight:700>&lt;/groupId&gt;</span>
            <span style=color:green;font-weight:700>&lt;artifactId&gt;</span>fastjson<span style=color:green;font-weight:700>&lt;/artifactId&gt;</span>
            <span style=color:green;font-weight:700>&lt;version&gt;</span>1.2.60<span style=color:green;font-weight:700>&lt;/version&gt;</span>
        <span style=color:green;font-weight:700>&lt;/dependency&gt;</span>
        <span style=color:#408080;font-style:italic>&lt;!--commons-lang工具类 --&gt;</span>
        <span style=color:green;font-weight:700>&lt;dependency&gt;</span>
            <span style=color:green;font-weight:700>&lt;groupId&gt;</span>commons-lang<span style=color:green;font-weight:700>&lt;/groupId&gt;</span>
            <span style=color:green;font-weight:700>&lt;artifactId&gt;</span>commons-lang<span style=color:green;font-weight:700>&lt;/artifactId&gt;</span>
            <span style=color:green;font-weight:700>&lt;version&gt;</span>2.6<span style=color:green;font-weight:700>&lt;/version&gt;</span>
        <span style=color:green;font-weight:700>&lt;/dependency&gt;</span>
        <span style=color:green;font-weight:700>&lt;dependency&gt;</span>
            <span style=color:green;font-weight:700>&lt;groupId&gt;</span>mysql<span style=color:green;font-weight:700>&lt;/groupId&gt;</span>
            <span style=color:green;font-weight:700>&lt;artifactId&gt;</span>mysql-connector-java<span style=color:green;font-weight:700>&lt;/artifactId&gt;</span>
            <span style=color:green;font-weight:700>&lt;scope&gt;</span>runtime<span style=color:green;font-weight:700>&lt;/scope&gt;</span>
        <span style=color:green;font-weight:700>&lt;/dependency&gt;</span>
        <span style=color:green;font-weight:700>&lt;dependency&gt;</span>
            <span style=color:green;font-weight:700>&lt;groupId&gt;</span>com.alibaba<span style=color:green;font-weight:700>&lt;/groupId&gt;</span>
            <span style=color:green;font-weight:700>&lt;artifactId&gt;</span>druid-spring-boot-starter<span style=color:green;font-weight:700>&lt;/artifactId&gt;</span>
            <span style=color:green;font-weight:700>&lt;version&gt;</span>1.1.22<span style=color:green;font-weight:700>&lt;/version&gt;</span>
        <span style=color:green;font-weight:700>&lt;/dependency&gt;</span>
<span style=color:#408080;font-style:italic>&lt;!--        添加一个devtools--&gt;</span>
        <span style=color:green;font-weight:700>&lt;dependency&gt;</span>
            <span style=color:green;font-weight:700>&lt;groupId&gt;</span>org.springframework.boot<span style=color:green;font-weight:700>&lt;/groupId&gt;</span>
            <span style=color:green;font-weight:700>&lt;artifactId&gt;</span>spring-boot-devtools<span style=color:green;font-weight:700>&lt;/artifactId&gt;</span>
            <span style=color:green;font-weight:700>&lt;scope&gt;</span>runtime<span style=color:green;font-weight:700>&lt;/scope&gt;</span>
            <span style=color:green;font-weight:700>&lt;optional&gt;</span>true<span style=color:green;font-weight:700>&lt;/optional&gt;</span>
        <span style=color:green;font-weight:700>&lt;/dependency&gt;</span>
<span style=color:#408080;font-style:italic>&lt;!--        添加myp--&gt;</span>
        <span style=color:green;font-weight:700>&lt;dependency&gt;</span>
            <span style=color:green;font-weight:700>&lt;groupId&gt;</span>com.baomidou<span style=color:green;font-weight:700>&lt;/groupId&gt;</span>
            <span style=color:green;font-weight:700>&lt;artifactId&gt;</span>mybatis-plus-boot-starter<span style=color:green;font-weight:700>&lt;/artifactId&gt;</span>
            <span style=color:green;font-weight:700>&lt;version&gt;</span>3.4.1<span style=color:green;font-weight:700>&lt;/version&gt;</span>
        <span style=color:green;font-weight:700>&lt;/dependency&gt;</span>
        <span style=color:#408080;font-style:italic>&lt;!--阿里云短信服务--&gt;</span>
        <span style=color:green;font-weight:700>&lt;dependency&gt;</span>
            <span style=color:green;font-weight:700>&lt;groupId&gt;</span>com.aliyun<span style=color:green;font-weight:700>&lt;/groupId&gt;</span>
            <span style=color:green;font-weight:700>&lt;artifactId&gt;</span>aliyun-java-sdk-core<span style=color:green;font-weight:700>&lt;/artifactId&gt;</span>
            <span style=color:green;font-weight:700>&lt;version&gt;</span>4.5.16<span style=color:green;font-weight:700>&lt;/version&gt;</span>
        <span style=color:green;font-weight:700>&lt;/dependency&gt;</span>
        <span style=color:#408080;font-style:italic>&lt;!-- 邮件服务,用来做验证码的发送验证--&gt;</span>
        <span style=color:green;font-weight:700>&lt;dependency&gt;</span>
            <span style=color:green;font-weight:700>&lt;groupId&gt;</span>org.springframework.boot<span style=color:green;font-weight:700>&lt;/groupId&gt;</span>
            <span style=color:green;font-weight:700>&lt;artifactId&gt;</span>spring-boot-starter-mail<span style=color:green;font-weight:700>&lt;/artifactId&gt;</span>
        <span style=color:green;font-weight:700>&lt;/dependency&gt;</span>
        <span style=color:#408080;font-style:italic>&lt;!-- Thymeleaf 模版，用于发送模版邮件 --&gt;</span>
        <span style=color:green;font-weight:700>&lt;dependency&gt;</span>
            <span style=color:green;font-weight:700>&lt;groupId&gt;</span>org.springframework.boot<span style=color:green;font-weight:700>&lt;/groupId&gt;</span>
            <span style=color:green;font-weight:700>&lt;artifactId&gt;</span>spring-boot-starter-thymeleaf<span style=color:green;font-weight:700>&lt;/artifactId&gt;</span>
        <span style=color:green;font-weight:700>&lt;/dependency&gt;</span>

        <span style=color:green;font-weight:700>&lt;dependency&gt;</span>
            <span style=color:green;font-weight:700>&lt;groupId&gt;</span>com.aliyun<span style=color:green;font-weight:700>&lt;/groupId&gt;</span>
            <span style=color:green;font-weight:700>&lt;artifactId&gt;</span>aliyun-java-sdk-dysmsapi<span style=color:green;font-weight:700>&lt;/artifactId&gt;</span>
            <span style=color:green;font-weight:700>&lt;version&gt;</span>2.1.0<span style=color:green;font-weight:700>&lt;/version&gt;</span>
        <span style=color:green;font-weight:700>&lt;/dependency&gt;</span>
<span style=color:#408080;font-style:italic>&lt;!--        读写分离依赖--&gt;</span>
<span style=color:#408080;font-style:italic>&lt;!--        &lt;dependency&gt;--&gt;</span>
<span style=color:#408080;font-style:italic>&lt;!--            &lt;groupId&gt;org.apache.shardingsphere&lt;/groupId&gt;--&gt;</span>
<span style=color:#408080;font-style:italic>&lt;!--            &lt;artifactId&gt;sharding-jdbc-spring-boot-starter&lt;/artifactId&gt;--&gt;</span>
<span style=color:#408080;font-style:italic>&lt;!--            &lt;version&gt;4.0.0-RC1&lt;/version&gt;--&gt;</span>
<span style=color:#408080;font-style:italic>&lt;!--        &lt;/dependency&gt;--&gt;</span>
        <span style=color:#408080;font-style:italic>&lt;!--swwager依赖--&gt;</span>
        <span style=color:green;font-weight:700>&lt;dependency&gt;</span>
            <span style=color:green;font-weight:700>&lt;groupId&gt;</span>com.github.xiaoymin<span style=color:green;font-weight:700>&lt;/groupId&gt;</span>
            <span style=color:green;font-weight:700>&lt;artifactId&gt;</span>knife4j-spring-boot-starter<span style=color:green;font-weight:700>&lt;/artifactId&gt;</span>
            <span style=color:green;font-weight:700>&lt;version&gt;</span>2.0.4<span style=color:green;font-weight:700>&lt;/version&gt;</span>
        <span style=color:green;font-weight:700>&lt;/dependency&gt;</span>

        <span style=color:green;font-weight:700>&lt;dependency&gt;</span>
            <span style=color:green;font-weight:700>&lt;groupId&gt;</span>cn.hutool<span style=color:green;font-weight:700>&lt;/groupId&gt;</span>
            <span style=color:green;font-weight:700>&lt;artifactId&gt;</span>hutool-all<span style=color:green;font-weight:700>&lt;/artifactId&gt;</span>
            <span style=color:green;font-weight:700>&lt;version&gt;</span>5.7.18<span style=color:green;font-weight:700>&lt;/version&gt;</span>
        <span style=color:green;font-weight:700>&lt;/dependency&gt;</span>
        <span style=color:green;font-weight:700>&lt;dependency&gt;</span>
            <span style=color:green;font-weight:700>&lt;groupId&gt;</span>junit<span style=color:green;font-weight:700>&lt;/groupId&gt;</span>
            <span style=color:green;font-weight:700>&lt;artifactId&gt;</span>junit<span style=color:green;font-weight:700>&lt;/artifactId&gt;</span>
            <span style=color:green;font-weight:700>&lt;scope&gt;</span>test<span style=color:green;font-weight:700>&lt;/scope&gt;</span>
        <span style=color:green;font-weight:700>&lt;/dependency&gt;</span>
    <span style=color:green;font-weight:700>&lt;/dependencies&gt;</span>
    <span style=color:green;font-weight:700>&lt;build&gt;</span>
        <span style=color:green;font-weight:700>&lt;plugins&gt;</span>
            <span style=color:green;font-weight:700>&lt;plugin&gt;</span>
                <span style=color:green;font-weight:700>&lt;groupId&gt;</span>org.springframework.boot<span style=color:green;font-weight:700>&lt;/groupId&gt;</span>
                <span style=color:green;font-weight:700>&lt;artifactId&gt;</span>spring-boot-maven-plugin<span style=color:green;font-weight:700>&lt;/artifactId&gt;</span>
            <span style=color:green;font-weight:700>&lt;/plugin&gt;</span>
        <span style=color:green;font-weight:700>&lt;/plugins&gt;</span>
            <span style=color:green;font-weight:700>&lt;resources&gt;</span>
                <span style=color:green;font-weight:700>&lt;resource&gt;</span>
                    <span style=color:#408080;font-style:italic>&lt;!-- xml放在java目录下--&gt;</span>
                    <span style=color:green;font-weight:700>&lt;directory&gt;</span>src/main/java<span style=color:green;font-weight:700>&lt;/directory&gt;</span>
                    <span style=color:green;font-weight:700>&lt;includes&gt;</span>
                        <span style=color:green;font-weight:700>&lt;include&gt;</span>**/*.xml<span style=color:green;font-weight:700>&lt;/include&gt;</span>
                    <span style=color:green;font-weight:700>&lt;/includes&gt;</span>
                <span style=color:green;font-weight:700>&lt;/resource&gt;</span>
                <span style=color:#408080;font-style:italic>&lt;!--指定资源的位置（xml放在resources下，可以不用指定）--&gt;</span>
                <span style=color:green;font-weight:700>&lt;resource&gt;</span>
                    <span style=color:green;font-weight:700>&lt;directory&gt;</span>src/main/resources<span style=color:green;font-weight:700>&lt;/directory&gt;</span>
                <span style=color:green;font-weight:700>&lt;/resource&gt;</span>
            <span style=color:green;font-weight:700>&lt;/resources&gt;</span>
    <span style=color:green;font-weight:700>&lt;/build&gt;</span>
<span style=color:green;font-weight:700>&lt;/project&gt;</span>

   

</code></pre></div><h3 id=33-applicationyaml>3.3 application.yaml<a href=#33-applicationyaml class=header-anchor arialabel=Anchor> #</a></h3><div class=highlight><pre style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:green;font-weight:700>server</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>port</span>:<span style=color:#bbb> </span><span style=color:#666>8080</span><span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>spring</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>application</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>reggie_take_out<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:#408080;font-style:italic>#应用的名称默认该项目名</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>datasource</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>druid</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>driver-class-name</span>:<span style=color:#bbb> </span>com.mysql.cj.jdbc.Driver<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:#408080;font-style:italic>#jdbc:mysql://192.168.8.1:3306/reggie?serverTimezone=Asia/Shanghai&amp;useUnicode=true&amp;characterEncoding=utf-8&amp;zeroDateTimeBehavior=convertToNull&amp;useSSL=false&amp;allowPublicKeyRetrieval=true</span><span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:#408080;font-style:italic>#Url要改成自己的jdbc:mysql://localhost:3306/reggie?serverTimezone=UTC</span><span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>url</span>:<span style=color:#bbb> </span>jdbc:mysql://localhost:3306/reggie?serverTimezone=Asia/Shanghai&amp;useUnicode=true&amp;characterEncoding=utf-8&amp;zeroDateTimeBehavior=convertToNull&amp;useSSL=false&amp;allowPublicKeyRetrieval=true<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>username</span>:<span style=color:#bbb> </span>root<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>password</span>:<span style=color:#bbb> </span><span style=color:#666>123456</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>redis</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>host</span>:<span style=color:#bbb> </span><span style=color:#666>192.168.8.130</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>port</span>:<span style=color:#bbb> </span><span style=color:#666>6379</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>password</span>:<span style=color:#bbb> </span>xxxxxx<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>cache</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>redis</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>time-to-live</span>:<span style=color:#bbb> </span><span style=color:#666>1800000</span><span style=color:#bbb> </span><span style=color:#408080;font-style:italic>#设置缓存有效期</span><span style=color:#bbb>
</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>lettuce</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>pool</span>:<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>max-active</span>:<span style=color:#bbb> </span><span style=color:#666>10</span><span style=color:#bbb> </span><span style=color:#408080;font-style:italic>#最大连接数量</span><span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>max-idle</span>:<span style=color:#bbb> </span><span style=color:#666>10</span><span style=color:#bbb> </span><span style=color:#408080;font-style:italic>#阻塞最大等待时间</span><span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>min-idle</span>:<span style=color:#bbb> </span><span style=color:#666>1</span><span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>time-between-eviction-runs</span>:<span style=color:#bbb> </span>10s<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>database</span>:<span style=color:#bbb> </span><span style=color:#666>1</span><span style=color:#bbb> </span><span style=color:#408080;font-style:italic>#操作的数据库1，这里默认是0,我的0做的其他项目缓存</span><span style=color:#bbb>
</span><span style=color:#bbb>
</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#408080;font-style:italic># 邮箱配置</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>mail</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>host</span>:<span style=color:#bbb> </span>smtp.qq.com <span style=color:#bbb> </span><span style=color:#408080;font-style:italic># 发送邮件的服务器地址</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>username</span>:<span style=color:#bbb> </span>xxxxxxx@qq.com<span style=color:#bbb> </span><span style=color:#408080;font-style:italic># 开启 IMAP/SMTP服务 的qq邮箱的账号</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>password</span>:<span style=color:#bbb> </span>xxxxxxxxx<span style=color:#bbb> </span><span style=color:#408080;font-style:italic># 开启 IMAP/SMTP服务 获得的授权码,而不是qq邮箱的登录密码</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>default-encoding</span>:<span style=color:#bbb> </span>UTF-8<span style=color:#bbb>
</span><span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>mybatis-plus</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>configuration</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:#408080;font-style:italic>#在映射实体或者属性时，将数据库中表名和字段名中的下划线去掉，按照驼峰命名法映射</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:#408080;font-style:italic>#比如表user_name &gt; 对应表userName</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>map-underscore-to-camel-case</span>:<span style=color:#bbb> </span><span style=color:green;font-weight:700>true</span><span style=color:#bbb>
</span><span style=color:#bbb>     </span><span style=color:#408080;font-style:italic>#日志输出</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>log-impl</span>:<span style=color:#bbb> </span>org.apache.ibatis.logging.stdout.StdOutImpl<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>global-config</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:#408080;font-style:italic>#    mapper-locations: classpath:mybatis/mapper/*.xml</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>db-config</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>id-type</span>:<span style=color:#bbb> </span>ASSIGN_ID<span style=color:#bbb> </span><span style=color:#408080;font-style:italic>#该配置完成后，每个模型类的主键ID策略都将成为assign_id</span><span style=color:#bbb>
</span><span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#408080;font-style:italic>#设置一个外部配置源，输出的地址</span><span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>reggie</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>path</span>:<span style=color:#bbb> </span>D:/img/<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#408080;font-style:italic>#  path: /usr/local/img/</span><span style=color:#bbb>
</span></code></pre></div><h2 id=4代码实现>4.代码实现<a href=#4代码实现 class=header-anchor arialabel=Anchor> #</a></h2><h3 id=41启动类>4.1启动类<a href=#41启动类 class=header-anchor arialabel=Anchor> #</a></h3><div class=highlight><pre style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:green;font-weight:700>package</span> <span style=color:#00f;font-weight:700>com.yang.reggie</span><span style=color:#666>;</span>
<span style=color:green;font-weight:700>import</span> <span style=color:#00f;font-weight:700>lombok.extern.slf4j.Slf4j</span><span style=color:#666>;</span>
<span style=color:green;font-weight:700>import</span> <span style=color:#00f;font-weight:700>org.mybatis.spring.annotation.MapperScan</span><span style=color:#666>;</span>
<span style=color:green;font-weight:700>import</span> <span style=color:#00f;font-weight:700>org.springframework.boot.SpringApplication</span><span style=color:#666>;</span>
<span style=color:green;font-weight:700>import</span> <span style=color:#00f;font-weight:700>org.springframework.boot.autoconfigure.SpringBootApplication</span><span style=color:#666>;</span>
<span style=color:green;font-weight:700>import</span> <span style=color:#00f;font-weight:700>org.springframework.boot.web.servlet.ServletComponentScan</span><span style=color:#666>;</span>
<span style=color:green;font-weight:700>import</span> <span style=color:#00f;font-weight:700>org.springframework.cache.annotation.EnableCaching</span><span style=color:#666>;</span>
<span style=color:green;font-weight:700>import</span> <span style=color:#00f;font-weight:700>org.springframework.transaction.annotation.EnableTransactionManagement</span><span style=color:#666>;</span>
<span style=color:#a2f>@Slf4j</span>
<span style=color:#a2f>@SpringBootApplication</span>
<span style=color:#a2f>@MapperScan</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;com.yang.reggie.mapper&#34;</span><span style=color:#666>)</span>
<span style=color:#a2f>@ServletComponentScan</span> <span style=color:#408080;font-style:italic>//@ServletComponentScan(basePackages = &#34;com.admin&#34;)
</span><span style=color:#408080;font-style:italic>// :指定原生Servlet组件都放在那里
</span><span style=color:#408080;font-style:italic></span><span style=color:#a2f>@EnableCaching</span>
<span style=color:#a2f>@EnableTransactionManagement</span>
<span style=color:green;font-weight:700>public</span> <span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>XingyueApplication</span> <span style=color:#666>{</span>
    <span style=color:green;font-weight:700>public</span> <span style=color:green;font-weight:700>static</span> <span style=color:#b00040>void</span> <span style=color:#00f>main</span><span style=color:#666>(</span>String<span style=color:#666>[]</span> args<span style=color:#666>)</span> <span style=color:#666>{</span>
        SpringApplication<span style=color:#666>.</span><span style=color:#7d9029>run</span><span style=color:#666>(</span>XingyueApplication<span style=color:#666>.</span><span style=color:#7d9029>class</span><span style=color:#666>,</span>args<span style=color:#666>);</span>
        log<span style=color:#666>.</span><span style=color:#7d9029>info</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;项目启动成功&#34;</span><span style=color:#666>);</span>
    <span style=color:#666>}</span>
<span style=color:#666>}</span>
</code></pre></div><h3 id=42-filter>4.2 filter<a href=#42-filter class=header-anchor arialabel=Anchor> #</a></h3><div class=highlight><pre style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>
<span style=color:#a2f>@WebFilter</span><span style=color:#666>(</span>filterName <span style=color:#666>=</span> <span style=color:#ba2121>&#34;LoginCheckFilter&#34;</span><span style=color:#666>,</span>urlPatterns <span style=color:#666>=</span> <span style=color:#ba2121>&#34;/*&#34;</span><span style=color:#666>)</span>
<span style=color:#a2f>@Slf4j</span>
<span style=color:#408080;font-style:italic>//拦截所有
</span><span style=color:#408080;font-style:italic></span><span style=color:green;font-weight:700>public</span> <span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>LoginCheckFilter</span> <span style=color:green;font-weight:700>implements</span> Filter <span style=color:#666>{</span>
    <span style=color:green;font-weight:700>public</span> <span style=color:green;font-weight:700>static</span> <span style=color:green;font-weight:700>final</span> AntPathMatcher pathMatcher<span style=color:#666>=</span><span style=color:green;font-weight:700>new</span> AntPathMatcher<span style=color:#666>();</span>
    <span style=color:#408080;font-style:italic>//路径匹配器，通配符
</span><span style=color:#408080;font-style:italic></span>    <span style=color:#a2f>@Override</span>
    <span style=color:green;font-weight:700>public</span> <span style=color:#b00040>void</span> <span style=color:#00f>doFilter</span><span style=color:#666>(</span>ServletRequest servletRequest<span style=color:#666>,</span> ServletResponse servletResponse<span style=color:#666>,</span> FilterChain filterChain<span style=color:#666>)</span> <span style=color:green;font-weight:700>throws</span> IOException<span style=color:#666>,</span> ServletException <span style=color:#666>{</span>

        HttpServletResponse response<span style=color:#666>=(</span>HttpServletResponse<span style=color:#666>)</span> servletResponse<span style=color:#666>;</span>
        HttpServletRequest request<span style=color:#666>=(</span>HttpServletRequest<span style=color:#666>)</span> servletRequest<span style=color:#666>;</span>
        <span style=color:#408080;font-style:italic>//1.获得本次访问的uri
</span><span style=color:#408080;font-style:italic></span>        String requestURI <span style=color:#666>=</span> request<span style=color:#666>.</span><span style=color:#7d9029>getRequestURI</span><span style=color:#666>();</span>
        log<span style=color:#666>.</span><span style=color:#7d9029>info</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;拦截请求为：{}&#34;</span><span style=color:#666>,</span>requestURI<span style=color:#666>);</span>
        <span style=color:#408080;font-style:italic>//2.定义不需要过滤的。注意/backend/**不能解决index.html所以需要路径通配符
</span><span style=color:#408080;font-style:italic></span>        String <span style=color:#666>[]</span> urls<span style=color:#666>=</span><span style=color:green;font-weight:700>new</span> String<span style=color:#666>[]{</span>
             <span style=color:#ba2121>&#34;/employee/login&#34;</span> <span style=color:#666>,</span>
                <span style=color:#ba2121>&#34;/employee/logout&#34;</span> <span style=color:#666>,</span>
                <span style=color:#ba2121>&#34;/backend/**&#34;</span> <span style=color:#666>,</span>
                <span style=color:#ba2121>&#34;/front/**&#34;</span> <span style=color:#666>,</span>
                <span style=color:#ba2121>&#34;/common/**&#34;</span><span style=color:#666>,</span>
                <span style=color:#ba2121>&#34;/user/sendMsg&#34;</span><span style=color:#666>,</span> <span style=color:#408080;font-style:italic>//移动端发送短信
</span><span style=color:#408080;font-style:italic></span>                <span style=color:#ba2121>&#34;/user/login&#34;</span> <span style=color:#666>,</span> <span style=color:#408080;font-style:italic>// 移动端登陆
</span><span style=color:#408080;font-style:italic></span>                <span style=color:#ba2121>&#34;/doc.html&#34;</span><span style=color:#666>,</span>
                <span style=color:#ba2121>&#34;/webjars/**&#34;</span><span style=color:#666>,</span>
                <span style=color:#ba2121>&#34;/swagger-resources&#34;</span><span style=color:#666>,</span>
                <span style=color:#ba2121>&#34;/v2/api-docs&#34;</span>
        <span style=color:#666>};</span>
        <span style=color:#408080;font-style:italic>//3.判断本次请求是否拦截
</span><span style=color:#408080;font-style:italic></span>        <span style=color:#b00040>boolean</span> check <span style=color:#666>=</span> check<span style=color:#666>(</span>urls<span style=color:#666>,</span> requestURI<span style=color:#666>);</span>
        <span style=color:green;font-weight:700>if</span> <span style=color:#666>(</span>check<span style=color:#666>){</span>
            log<span style=color:#666>.</span><span style=color:#7d9029>info</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;本次请求不处理&#34;</span><span style=color:#666>);</span>
            filterChain<span style=color:#666>.</span><span style=color:#7d9029>doFilter</span><span style=color:#666>(</span>request<span style=color:#666>,</span>response<span style=color:#666>);</span>
            <span style=color:green;font-weight:700>return</span><span style=color:#666>;</span><span style=color:#408080;font-style:italic>//不拦截
</span><span style=color:#408080;font-style:italic></span>        <span style=color:#666>}</span>
        <span style=color:#408080;font-style:italic>//4-1判断登录状态，如果已经登录直接放行
</span><span style=color:#408080;font-style:italic></span>        <span style=color:green;font-weight:700>if</span><span style=color:#666>(</span>request<span style=color:#666>.</span><span style=color:#7d9029>getSession</span><span style=color:#666>().</span><span style=color:#7d9029>getAttribute</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;employee&#34;</span><span style=color:#666>)!=</span><span style=color:green;font-weight:700>null</span><span style=color:#666>){</span>
           Long empId <span style=color:#666>=(</span>Long<span style=color:#666>)</span> request<span style=color:#666>.</span><span style=color:#7d9029>getSession</span><span style=color:#666>().</span><span style=color:#7d9029>getAttribute</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;employee&#34;</span><span style=color:#666>);</span>
            BaseContext<span style=color:#666>.</span><span style=color:#7d9029>setCurrentId</span><span style=color:#666>(</span>empId<span style=color:#666>);</span>
            log<span style=color:#666>.</span><span style=color:#7d9029>info</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;登录用户id为: {}&#34;</span><span style=color:#666>,</span>request<span style=color:#666>.</span><span style=color:#7d9029>getSession</span><span style=color:#666>().</span><span style=color:#7d9029>getAttribute</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;employee&#34;</span><span style=color:#666>));</span>
            filterChain<span style=color:#666>.</span><span style=color:#7d9029>doFilter</span><span style=color:#666>(</span>request<span style=color:#666>,</span>response<span style=color:#666>);</span>
            <span style=color:green;font-weight:700>return</span><span style=color:#666>;</span><span style=color:#408080;font-style:italic>//不拦截
</span><span style=color:#408080;font-style:italic></span>        <span style=color:#666>}</span>
        <span style=color:#408080;font-style:italic>//4-2判断登录状态，如果已经登录直接放行
</span><span style=color:#408080;font-style:italic></span>        <span style=color:green;font-weight:700>if</span><span style=color:#666>(</span>request<span style=color:#666>.</span><span style=color:#7d9029>getSession</span><span style=color:#666>().</span><span style=color:#7d9029>getAttribute</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;user&#34;</span><span style=color:#666>)!=</span><span style=color:green;font-weight:700>null</span><span style=color:#666>){</span>
            Long userId <span style=color:#666>=(</span>Long<span style=color:#666>)</span> request<span style=color:#666>.</span><span style=color:#7d9029>getSession</span><span style=color:#666>().</span><span style=color:#7d9029>getAttribute</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;user&#34;</span><span style=color:#666>);</span>
            BaseContext<span style=color:#666>.</span><span style=color:#7d9029>setCurrentId</span><span style=color:#666>(</span>userId<span style=color:#666>);</span>
            log<span style=color:#666>.</span><span style=color:#7d9029>info</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;登录用户id为: {}&#34;</span><span style=color:#666>,</span>request<span style=color:#666>.</span><span style=color:#7d9029>getSession</span><span style=color:#666>().</span><span style=color:#7d9029>getAttribute</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;user&#34;</span><span style=color:#666>));</span>
            filterChain<span style=color:#666>.</span><span style=color:#7d9029>doFilter</span><span style=color:#666>(</span>request<span style=color:#666>,</span>response<span style=color:#666>);</span>
            <span style=color:green;font-weight:700>return</span><span style=color:#666>;</span><span style=color:#408080;font-style:italic>//不拦截
</span><span style=color:#408080;font-style:italic></span>        <span style=color:#666>}</span>


        <span style=color:#408080;font-style:italic>//5.如果没有登录，需要结合前端看。
</span><span style=color:#408080;font-style:italic></span>        <span style=color:#408080;font-style:italic>//通过输出流的方式向前端响应数据
</span><span style=color:#408080;font-style:italic></span>        <span style=color:#408080;font-style:italic>//(写json数据给前端）
</span><span style=color:#408080;font-style:italic></span>        response<span style=color:#666>.</span><span style=color:#7d9029>getWriter</span><span style=color:#666>().</span><span style=color:#7d9029>write</span><span style=color:#666>(</span>JSON<span style=color:#666>.</span><span style=color:#7d9029>toJSONString</span><span style=color:#666>(</span>R<span style=color:#666>.</span><span style=color:#7d9029>error</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;NOTLOGIN&#34;</span><span style=color:#666>)));</span>
        log<span style=color:#666>.</span><span style=color:#7d9029>info</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;用户未登录&#34;</span><span style=color:#666>);</span>
       <span style=color:green;font-weight:700>return</span><span style=color:#666>;</span>
    <span style=color:#666>}</span>

    <span style=color:#408080;font-style:italic>/**
</span><span style=color:#408080;font-style:italic>     * 路径匹配判断放行
</span><span style=color:#408080;font-style:italic>     * @param urls
</span><span style=color:#408080;font-style:italic>     * @param requstURI
</span><span style=color:#408080;font-style:italic>     * @return
</span><span style=color:#408080;font-style:italic>     */</span>
    <span style=color:green;font-weight:700>public</span> <span style=color:#b00040>boolean</span> <span style=color:#00f>check</span><span style=color:#666>(</span>String<span style=color:#666>[]</span> urls<span style=color:#666>,</span>String requstURI<span style=color:#666>){</span>
        <span style=color:green;font-weight:700>for</span> <span style=color:#666>(</span>String url <span style=color:#666>:</span> urls<span style=color:#666>)</span> <span style=color:#666>{</span>
            <span style=color:#b00040>boolean</span> match <span style=color:#666>=</span> pathMatcher<span style=color:#666>.</span><span style=color:#7d9029>match</span><span style=color:#666>(</span>url<span style=color:#666>,</span> requstURI<span style=color:#666>);</span>
            <span style=color:#408080;font-style:italic>//后者是否和前者匹配
</span><span style=color:#408080;font-style:italic></span>            <span style=color:green;font-weight:700>if</span> <span style=color:#666>(</span>match<span style=color:#666>){</span>
                <span style=color:green;font-weight:700>return</span> <span style=color:green;font-weight:700>true</span><span style=color:#666>;</span>
            <span style=color:#666>}</span>
        <span style=color:#666>}</span>
        <span style=color:green;font-weight:700>return</span> <span style=color:green;font-weight:700>false</span><span style=color:#666>;</span>
    <span style=color:#666>}</span>
<span style=color:#666>}</span>
</code></pre></div><h3 id=43-common包>4.3 common包<a href=#43-common包 class=header-anchor arialabel=Anchor> #</a></h3><h4 id=431--base-context基于用户的线程封装类>4.3.1 Base Context基于用户的线程封装类<a href=#431--base-context基于用户的线程封装类 class=header-anchor arialabel=Anchor> #</a></h4><div class=highlight><pre style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>ackage com<span style=color:#666>.</span><span style=color:#7d9029>yang</span><span style=color:#666>.</span><span style=color:#7d9029>reggie</span><span style=color:#666>.</span><span style=color:#7d9029>com</span><span style=color:#666>;</span>

<span style=color:#408080;font-style:italic>/**
</span><span style=color:#408080;font-style:italic> * 基于ThreadLocal封装工具类，用户保存和获取当前登录用户id
</span><span style=color:#408080;font-style:italic> */</span>
<span style=color:green;font-weight:700>public</span> <span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>BaseContext</span> <span style=color:#666>{</span>
    <span style=color:green;font-weight:700>private</span> <span style=color:green;font-weight:700>static</span> ThreadLocal<span style=color:#666>&lt;</span>Long<span style=color:#666>&gt;</span> threadLocal <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> ThreadLocal<span style=color:#666>&lt;&gt;();</span>

    <span style=color:#408080;font-style:italic>/**
</span><span style=color:#408080;font-style:italic>     * 设置值
</span><span style=color:#408080;font-style:italic>     * @param id
</span><span style=color:#408080;font-style:italic>     */</span>
    <span style=color:green;font-weight:700>public</span> <span style=color:green;font-weight:700>static</span> <span style=color:#b00040>void</span> <span style=color:#00f>setCurrentId</span><span style=color:#666>(</span>Long id<span style=color:#666>){</span>
        threadLocal<span style=color:#666>.</span><span style=color:#7d9029>set</span><span style=color:#666>(</span>id<span style=color:#666>);</span>
    <span style=color:#666>}</span>

    <span style=color:#408080;font-style:italic>/**
</span><span style=color:#408080;font-style:italic>     * 获取值
</span><span style=color:#408080;font-style:italic>     * @return
</span><span style=color:#408080;font-style:italic>     */</span>
    <span style=color:green;font-weight:700>public</span> <span style=color:green;font-weight:700>static</span> Long <span style=color:#00f>getCurrentId</span><span style=color:#666>(){</span>
        <span style=color:green;font-weight:700>return</span> threadLocal<span style=color:#666>.</span><span style=color:#7d9029>get</span><span style=color:#666>();</span>
    <span style=color:#666>}</span>
<span style=color:#666>}</span>
</code></pre></div><h4 id=432自定义业务异常类-custom-exception>4.3.2自定义业务异常类 Custom Exception<a href=#432自定义业务异常类-custom-exception class=header-anchor arialabel=Anchor> #</a></h4><div class=highlight><pre style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>
 
<span style=color:#408080;font-style:italic>/*
</span><span style=color:#408080;font-style:italic>* 自定义业务异常
</span><span style=color:#408080;font-style:italic>* 继承了运行时异常
</span><span style=color:#408080;font-style:italic>* 1.查询当前分类是否关联了套餐或者菜品，如果已经关联不允许删除，抛出这个业务异常
</span><span style=color:#408080;font-style:italic>*   该异常将在全局异常处理器中被捕获，并获取它携带的的信息
</span><span style=color:#408080;font-style:italic>* */</span>
<span style=color:green;font-weight:700>public</span> <span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>CustomException</span> <span style=color:green;font-weight:700>extends</span> RuntimeException<span style=color:#666>{</span>
    <span style=color:green;font-weight:700>public</span> <span style=color:#00f>CustomException</span><span style=color:#666>(</span>String message<span style=color:#666>){</span>
        <span style=color:green;font-weight:700>super</span><span style=color:#666>(</span>message<span style=color:#666>);</span>
    <span style=color:#666>}</span>
<span style=color:#666>}</span>
</code></pre></div><h4 id=433全局异常处理类-globalexception-handler>4.3.3全局异常处理类 GlobalException Handler<a href=#433全局异常处理类-globalexception-handler class=header-anchor arialabel=Anchor> #</a></h4><div class=highlight><pre style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#408080;font-style:italic>/*
</span><span style=color:#408080;font-style:italic>* ControllerAdvice这个代表拦截所有带RestController和Controller的类
</span><span style=color:#408080;font-style:italic>* ResponseBody将结果封装成json数据并返回
</span><span style=color:#408080;font-style:italic>* */</span>
<span style=color:#a2f>@ControllerAdvice</span><span style=color:#666>(</span>annotations <span style=color:#666>=</span> <span style=color:#666>{</span>RestController<span style=color:#666>.</span><span style=color:#7d9029>class</span><span style=color:#666>,</span> Controller<span style=color:#666>.</span><span style=color:#7d9029>class</span><span style=color:#666>})</span>
<span style=color:#a2f>@ResponseBody</span>
<span style=color:#a2f>@Slf4j</span>
<span style=color:green;font-weight:700>public</span> <span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>GlobalExceptionHandler</span> <span style=color:#666>{</span>
 
    <span style=color:#408080;font-style:italic>/**
</span><span style=color:#408080;font-style:italic>     * 异常处理方法
</span><span style=color:#408080;font-style:italic>     * 目的：禁止重复添加具有唯一约束字段的数据(如：相同username的员工用户，相同sort的菜品等)
</span><span style=color:#408080;font-style:italic>     * @return
</span><span style=color:#408080;font-style:italic>     */</span>
    <span style=color:#a2f>@ExceptionHandler</span><span style=color:#666>(</span>SQLIntegrityConstraintViolationException<span style=color:#666>.</span><span style=color:#7d9029>class</span><span style=color:#666>)</span>
    <span style=color:green;font-weight:700>public</span> R<span style=color:#666>&lt;</span>String<span style=color:#666>&gt;</span> <span style=color:#00f>exceptionHandler</span><span style=color:#666>(</span>SQLIntegrityConstraintViolationException ex<span style=color:#666>){</span>
        log<span style=color:#666>.</span><span style=color:#7d9029>error</span><span style=color:#666>(</span>ex<span style=color:#666>.</span><span style=color:#7d9029>getMessage</span><span style=color:#666>());</span>
        <span style=color:#408080;font-style:italic>//如果异常信息包括这个关键字，说明了已经违反了username的唯一约束
</span><span style=color:#408080;font-style:italic></span>        <span style=color:#408080;font-style:italic>//IDEA抛出异常信息例子：Duplicate entry &#39;zhangsan&#39; for key &#39;employee.idx_username&#39;
</span><span style=color:#408080;font-style:italic></span>        <span style=color:green;font-weight:700>if</span><span style=color:#666>(</span>ex<span style=color:#666>.</span><span style=color:#7d9029>getMessage</span><span style=color:#666>().</span><span style=color:#7d9029>contains</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;Duplicate entry&#34;</span><span style=color:#666>)){</span>
            String<span style=color:#666>[]</span> split <span style=color:#666>=</span> ex<span style=color:#666>.</span><span style=color:#7d9029>getMessage</span><span style=color:#666>().</span><span style=color:#7d9029>split</span><span style=color:#666>(</span><span style=color:#ba2121>&#34; &#34;</span><span style=color:#666>);</span>
            String msg <span style=color:#666>=</span> split<span style=color:#666>[</span>2<span style=color:#666>]</span> <span style=color:#666>+</span> <span style=color:#ba2121>&#34;已存在&#34;</span><span style=color:#666>;</span>
            <span style=color:green;font-weight:700>return</span> R<span style=color:#666>.</span><span style=color:#7d9029>error</span><span style=color:#666>(</span>msg<span style=color:#666>);</span>
        <span style=color:#666>}</span>
        <span style=color:#408080;font-style:italic>//如果产生其他异常信息，则输出&#34;未知错误&#34;
</span><span style=color:#408080;font-style:italic></span>        <span style=color:green;font-weight:700>return</span> R<span style=color:#666>.</span><span style=color:#7d9029>error</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;未知错误&#34;</span><span style=color:#666>);</span>
    <span style=color:#666>}</span>
 
    <span style=color:#408080;font-style:italic>/**
</span><span style=color:#408080;font-style:italic>     * 异常处理方法
</span><span style=color:#408080;font-style:italic>     * 这是自己写的异常，捕获这个异常，并收到它携带的信息
</span><span style=color:#408080;font-style:italic>     * @return
</span><span style=color:#408080;font-style:italic>     */</span>
    <span style=color:#a2f>@ExceptionHandler</span><span style=color:#666>(</span>CustomException<span style=color:#666>.</span><span style=color:#7d9029>class</span><span style=color:#666>)</span>
    <span style=color:green;font-weight:700>public</span> R<span style=color:#666>&lt;</span>String<span style=color:#666>&gt;</span> <span style=color:#00f>exceptionHandler</span><span style=color:#666>(</span>CustomException ex<span style=color:#666>){</span>
        log<span style=color:#666>.</span><span style=color:#7d9029>error</span><span style=color:#666>(</span>ex<span style=color:#666>.</span><span style=color:#7d9029>getMessage</span><span style=color:#666>());</span>
        <span style=color:green;font-weight:700>return</span> R<span style=color:#666>.</span><span style=color:#7d9029>error</span><span style=color:#666>(</span>ex<span style=color:#666>.</span><span style=color:#7d9029>getMessage</span><span style=color:#666>());</span>
    <span style=color:#666>}</span>
<span style=color:#666>}</span>

</code></pre></div><h4 id=434-自定义结果返回类r>4.3.4 自定义结果返回类R<a href=#434-自定义结果返回类r class=header-anchor arialabel=Anchor> #</a></h4><blockquote><p>设计表现层返回结果的模型类，用于后端与前端进行数据格式统一，也称为<strong>前后端数据协议</strong></p></blockquote><div class=highlight><pre style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#a2f>@Data</span>
<span style=color:green;font-weight:700>public</span> <span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>R</span><span style=color:#666>&lt;</span>T<span style=color:#666>&gt;</span> <span style=color:green;font-weight:700>implements</span> Serializable <span style=color:#666>{</span>

    <span style=color:green;font-weight:700>private</span> Integer code<span style=color:#666>;</span> <span style=color:#408080;font-style:italic>//编码：1成功，0和其它数字为失败
</span><span style=color:#408080;font-style:italic></span>
    <span style=color:green;font-weight:700>private</span> String msg<span style=color:#666>;</span> <span style=color:#408080;font-style:italic>//错误信息
</span><span style=color:#408080;font-style:italic></span>
    <span style=color:green;font-weight:700>private</span> T data<span style=color:#666>;</span> <span style=color:#408080;font-style:italic>//数据
</span><span style=color:#408080;font-style:italic></span>
    <span style=color:green;font-weight:700>private</span> Map map <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> HashMap<span style=color:#666>();</span> <span style=color:#408080;font-style:italic>//动态数据
</span><span style=color:#408080;font-style:italic></span>
    <span style=color:green;font-weight:700>public</span> <span style=color:green;font-weight:700>static</span> <span style=color:#666>&lt;</span>T<span style=color:#666>&gt;</span> R<span style=color:#666>&lt;</span>T<span style=color:#666>&gt;</span> <span style=color:#00f>success</span><span style=color:#666>(</span>T object<span style=color:#666>)</span> <span style=color:#666>{</span>
        R<span style=color:#666>&lt;</span>T<span style=color:#666>&gt;</span> r <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> R<span style=color:#666>&lt;</span>T<span style=color:#666>&gt;();</span>
        r<span style=color:#666>.</span><span style=color:#7d9029>data</span> <span style=color:#666>=</span> object<span style=color:#666>;</span>
        r<span style=color:#666>.</span><span style=color:#7d9029>code</span> <span style=color:#666>=</span> 1<span style=color:#666>;</span>
        <span style=color:green;font-weight:700>return</span> r<span style=color:#666>;</span>
    <span style=color:#666>}</span>

    <span style=color:green;font-weight:700>public</span> <span style=color:green;font-weight:700>static</span> <span style=color:#666>&lt;</span>T<span style=color:#666>&gt;</span> R<span style=color:#666>&lt;</span>T<span style=color:#666>&gt;</span> <span style=color:#00f>error</span><span style=color:#666>(</span>String msg<span style=color:#666>)</span> <span style=color:#666>{</span>
        R r <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> R<span style=color:#666>();</span>
        r<span style=color:#666>.</span><span style=color:#7d9029>msg</span> <span style=color:#666>=</span> msg<span style=color:#666>;</span>
        r<span style=color:#666>.</span><span style=color:#7d9029>code</span> <span style=color:#666>=</span> 0<span style=color:#666>;</span>
        <span style=color:green;font-weight:700>return</span> r<span style=color:#666>;</span>
    <span style=color:#666>}</span>

    <span style=color:green;font-weight:700>public</span> R<span style=color:#666>&lt;</span>T<span style=color:#666>&gt;</span> <span style=color:#00f>add</span><span style=color:#666>(</span>String key<span style=color:#666>,</span> Object value<span style=color:#666>)</span> <span style=color:#666>{</span>
        <span style=color:green;font-weight:700>this</span><span style=color:#666>.</span><span style=color:#7d9029>map</span><span style=color:#666>.</span><span style=color:#7d9029>put</span><span style=color:#666>(</span>key<span style=color:#666>,</span> value<span style=color:#666>);</span>
        <span style=color:green;font-weight:700>return</span> <span style=color:green;font-weight:700>this</span><span style=color:#666>;</span>
    <span style=color:#666>}</span>

<span style=color:#666>}</span>
</code></pre></div><h4 id=435自定义元数据对象处理器类mymetaobjecthandler>4.3.5自定义元数据对象处理器类MyMetaObjectHandler<a href=#435自定义元数据对象处理器类mymetaobjecthandler class=header-anchor arialabel=Anchor> #</a></h4><div class=highlight><pre style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>
<span style=color:#408080;font-style:italic>/**
</span><span style=color:#408080;font-style:italic> * 自定义元素据对象处理器
</span><span style=color:#408080;font-style:italic> */</span>
<span style=color:#a2f>@Component</span>
<span style=color:#a2f>@Slf4j</span>
<span style=color:green;font-weight:700>public</span> <span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>MyMetaObjecthandler</span> <span style=color:green;font-weight:700>implements</span> MetaObjectHandler <span style=color:#666>{</span>
    <span style=color:#a2f>@Override</span>
    <span style=color:green;font-weight:700>public</span> <span style=color:#b00040>void</span> <span style=color:#00f>insertFill</span><span style=color:#666>(</span>MetaObject metaObject<span style=color:#666>)</span> <span style=color:#666>{</span>
        log<span style=color:#666>.</span><span style=color:#7d9029>info</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;公共字段自动填充【insert]&#34;</span><span style=color:#666>);</span>
        log<span style=color:#666>.</span><span style=color:#7d9029>info</span><span style=color:#666>(</span>metaObject<span style=color:#666>.</span><span style=color:#7d9029>toString</span><span style=color:#666>());</span>
        metaObject<span style=color:#666>.</span><span style=color:#7d9029>setValue</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;createTime&#34;</span><span style=color:#666>,</span> LocalDateTime<span style=color:#666>.</span><span style=color:#7d9029>now</span><span style=color:#666>());</span>
        metaObject<span style=color:#666>.</span><span style=color:#7d9029>setValue</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;updateTime&#34;</span><span style=color:#666>,</span> LocalDateTime<span style=color:#666>.</span><span style=color:#7d9029>now</span><span style=color:#666>());</span>
       metaObject<span style=color:#666>.</span><span style=color:#7d9029>setValue</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;createUser&#34;</span><span style=color:#666>,</span>BaseContext<span style=color:#666>.</span><span style=color:#7d9029>getCurrentId</span><span style=color:#666>());</span>
     metaObject<span style=color:#666>.</span><span style=color:#7d9029>setValue</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;updateUser&#34;</span><span style=color:#666>,</span>BaseContext<span style=color:#666>.</span><span style=color:#7d9029>getCurrentId</span><span style=color:#666>());</span>

    <span style=color:#666>}</span>

    <span style=color:#a2f>@Override</span>
    <span style=color:green;font-weight:700>public</span> <span style=color:#b00040>void</span> <span style=color:#00f>updateFill</span><span style=color:#666>(</span>MetaObject metaObject<span style=color:#666>)</span> <span style=color:#666>{</span>
        log<span style=color:#666>.</span><span style=color:#7d9029>info</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;公共字段自动填充【update]&#34;</span><span style=color:#666>);</span>
        log<span style=color:#666>.</span><span style=color:#7d9029>info</span><span style=color:#666>(</span>metaObject<span style=color:#666>.</span><span style=color:#7d9029>toString</span><span style=color:#666>());</span>
        metaObject<span style=color:#666>.</span><span style=color:#7d9029>setValue</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;updateTime&#34;</span><span style=color:#666>,</span> LocalDateTime<span style=color:#666>.</span><span style=color:#7d9029>now</span><span style=color:#666>());</span>
        metaObject<span style=color:#666>.</span><span style=color:#7d9029>setValue</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;updateUser&#34;</span><span style=color:#666>,</span>BaseContext<span style=color:#666>.</span><span style=color:#7d9029>getCurrentId</span><span style=color:#666>());</span>
    <span style=color:#666>}</span>
<span style=color:#666>}</span>
</code></pre></div><h3 id=44config包>4.4config包<a href=#44config包 class=header-anchor arialabel=Anchor> #</a></h3><h4 id=441对象映射器jacksonobjectmapper>4.4.1对象映射器JacksonObjectMapper<a href=#441对象映射器jacksonobjectmapper class=header-anchor arialabel=Anchor> #</a></h4><div class=highlight><pre style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#408080;font-style:italic>/**
</span><span style=color:#408080;font-style:italic> * 对象映射器:基于jackson将Java对象转为json，或者将json转为Java对象
</span><span style=color:#408080;font-style:italic> * 将JSON解析为Java对象的过程称为 [JSON反序列化Java对象]
</span><span style=color:#408080;font-style:italic> * 从Java对象生成JSON的过程称为 [序列化Java对象到JSON]
</span><span style=color:#408080;font-style:italic> ** 解决问题：1.雪花算法生成的id过长，js处理时丢失精度，导致id和数据库中的不匹配，从而更新失败问题
</span><span style=color:#408080;font-style:italic> * * 2.改变时间的格式等
</span><span style=color:#408080;font-style:italic> */</span>
<span style=color:green;font-weight:700>public</span> <span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>JacksonObjectMapper</span> <span style=color:green;font-weight:700>extends</span> ObjectMapper <span style=color:#666>{</span>

    <span style=color:green;font-weight:700>public</span> <span style=color:green;font-weight:700>static</span> <span style=color:green;font-weight:700>final</span> String DEFAULT_DATE_FORMAT <span style=color:#666>=</span> <span style=color:#ba2121>&#34;yyyy-MM-dd&#34;</span><span style=color:#666>;</span>
    <span style=color:green;font-weight:700>public</span> <span style=color:green;font-weight:700>static</span> <span style=color:green;font-weight:700>final</span> String DEFAULT_DATE_TIME_FORMAT <span style=color:#666>=</span> <span style=color:#ba2121>&#34;yyyy-MM-dd HH:mm:ss&#34;</span><span style=color:#666>;</span>
    <span style=color:green;font-weight:700>public</span> <span style=color:green;font-weight:700>static</span> <span style=color:green;font-weight:700>final</span> String DEFAULT_TIME_FORMAT <span style=color:#666>=</span> <span style=color:#ba2121>&#34;HH:mm:ss&#34;</span><span style=color:#666>;</span>

    <span style=color:green;font-weight:700>public</span> <span style=color:#00f>JacksonObjectMapper</span><span style=color:#666>()</span> <span style=color:#666>{</span>
        <span style=color:green;font-weight:700>super</span><span style=color:#666>();</span>
        <span style=color:#408080;font-style:italic>//收到未知属性时不报异常
</span><span style=color:#408080;font-style:italic></span>        <span style=color:green;font-weight:700>this</span><span style=color:#666>.</span><span style=color:#7d9029>configure</span><span style=color:#666>(</span>FAIL_ON_UNKNOWN_PROPERTIES<span style=color:#666>,</span> <span style=color:green;font-weight:700>false</span><span style=color:#666>);</span>

        <span style=color:#408080;font-style:italic>//反序列化时，属性不存在的兼容处理
</span><span style=color:#408080;font-style:italic></span>        <span style=color:green;font-weight:700>this</span><span style=color:#666>.</span><span style=color:#7d9029>getDeserializationConfig</span><span style=color:#666>().</span><span style=color:#7d9029>withoutFeatures</span><span style=color:#666>(</span>DeserializationFeature<span style=color:#666>.</span><span style=color:#7d9029>FAIL_ON_UNKNOWN_PROPERTIES</span><span style=color:#666>);</span>


        SimpleModule simpleModule <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> SimpleModule<span style=color:#666>()</span>
                <span style=color:#666>.</span><span style=color:#7d9029>addDeserializer</span><span style=color:#666>(</span>LocalDateTime<span style=color:#666>.</span><span style=color:#7d9029>class</span><span style=color:#666>,</span> <span style=color:green;font-weight:700>new</span> LocalDateTimeDeserializer<span style=color:#666>(</span>DateTimeFormatter<span style=color:#666>.</span><span style=color:#7d9029>ofPattern</span><span style=color:#666>(</span>DEFAULT_DATE_TIME_FORMAT<span style=color:#666>)))</span>
                <span style=color:#666>.</span><span style=color:#7d9029>addDeserializer</span><span style=color:#666>(</span>LocalDate<span style=color:#666>.</span><span style=color:#7d9029>class</span><span style=color:#666>,</span> <span style=color:green;font-weight:700>new</span> LocalDateDeserializer<span style=color:#666>(</span>DateTimeFormatter<span style=color:#666>.</span><span style=color:#7d9029>ofPattern</span><span style=color:#666>(</span>DEFAULT_DATE_FORMAT<span style=color:#666>)))</span>
                <span style=color:#666>.</span><span style=color:#7d9029>addDeserializer</span><span style=color:#666>(</span>LocalTime<span style=color:#666>.</span><span style=color:#7d9029>class</span><span style=color:#666>,</span> <span style=color:green;font-weight:700>new</span> LocalTimeDeserializer<span style=color:#666>(</span>DateTimeFormatter<span style=color:#666>.</span><span style=color:#7d9029>ofPattern</span><span style=color:#666>(</span>DEFAULT_TIME_FORMAT<span style=color:#666>)))</span>

                <span style=color:#666>.</span><span style=color:#7d9029>addSerializer</span><span style=color:#666>(</span>BigInteger<span style=color:#666>.</span><span style=color:#7d9029>class</span><span style=color:#666>,</span> ToStringSerializer<span style=color:#666>.</span><span style=color:#7d9029>instance</span><span style=color:#666>)</span>
                <span style=color:#666>.</span><span style=color:#7d9029>addSerializer</span><span style=color:#666>(</span>Long<span style=color:#666>.</span><span style=color:#7d9029>class</span><span style=color:#666>,</span> ToStringSerializer<span style=color:#666>.</span><span style=color:#7d9029>instance</span><span style=color:#666>)</span>
                <span style=color:#666>.</span><span style=color:#7d9029>addSerializer</span><span style=color:#666>(</span>LocalDateTime<span style=color:#666>.</span><span style=color:#7d9029>class</span><span style=color:#666>,</span> <span style=color:green;font-weight:700>new</span> LocalDateTimeSerializer<span style=color:#666>(</span>DateTimeFormatter<span style=color:#666>.</span><span style=color:#7d9029>ofPattern</span><span style=color:#666>(</span>DEFAULT_DATE_TIME_FORMAT<span style=color:#666>)))</span>
                <span style=color:#666>.</span><span style=color:#7d9029>addSerializer</span><span style=color:#666>(</span>LocalDate<span style=color:#666>.</span><span style=color:#7d9029>class</span><span style=color:#666>,</span> <span style=color:green;font-weight:700>new</span> LocalDateSerializer<span style=color:#666>(</span>DateTimeFormatter<span style=color:#666>.</span><span style=color:#7d9029>ofPattern</span><span style=color:#666>(</span>DEFAULT_DATE_FORMAT<span style=color:#666>)))</span>
                <span style=color:#666>.</span><span style=color:#7d9029>addSerializer</span><span style=color:#666>(</span>LocalTime<span style=color:#666>.</span><span style=color:#7d9029>class</span><span style=color:#666>,</span> <span style=color:green;font-weight:700>new</span> LocalTimeSerializer<span style=color:#666>(</span>DateTimeFormatter<span style=color:#666>.</span><span style=color:#7d9029>ofPattern</span><span style=color:#666>(</span>DEFAULT_TIME_FORMAT<span style=color:#666>)));</span>

        <span style=color:#408080;font-style:italic>//注册功能模块 例如，可以添加自定义序列化器和反序列化器
</span><span style=color:#408080;font-style:italic></span>        <span style=color:green;font-weight:700>this</span><span style=color:#666>.</span><span style=color:#7d9029>registerModule</span><span style=color:#666>(</span>simpleModule<span style=color:#666>);</span>
    <span style=color:#666>}</span>
<span style=color:#666>}</span>

</code></pre></div><h4 id=442配置mybatis-plus的分页插件mybatisplusconfig>4.4.2配置Mybatis-plus的分页插件MybatisPlusConfig<a href=#442配置mybatis-plus的分页插件mybatisplusconfig class=header-anchor arialabel=Anchor> #</a></h4><div class=highlight><pre style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#a2f>@Configuration</span>
<span style=color:green;font-weight:700>public</span> <span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>MybatisPliusConfig</span> <span style=color:#666>{</span>
    <span style=color:green;font-weight:700>public</span> MybatisPlusInterceptor <span style=color:#00f>mybatisPlusInterceptor</span><span style=color:#666>(){</span>
        MybatisPlusInterceptor mybatisPlusInterceptor <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> MybatisPlusInterceptor<span style=color:#666>();</span>
        mybatisPlusInterceptor<span style=color:#666>.</span><span style=color:#7d9029>addInnerInterceptor</span><span style=color:#666>(</span><span style=color:green;font-weight:700>new</span> PaginationInnerInterceptor<span style=color:#666>());</span>
        <span style=color:green;font-weight:700>return</span> mybatisPlusInterceptor<span style=color:#666>;</span>
    <span style=color:#666>}</span>
<span style=color:#666>}</span>
</code></pre></div><h4 id=443静态资源映射webmvcconfig>4.4.3静态资源映射WebMvcConfig<a href=#443静态资源映射webmvcconfig class=header-anchor arialabel=Anchor> #</a></h4><div class=highlight><pre style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#a2f>@Component</span>
<span style=color:#a2f>@Slf4j</span>
<span style=color:#a2f>@EnableSwagger2</span>
<span style=color:#a2f>@EnableKnife4j</span>
<span style=color:green;font-weight:700>public</span> <span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>WebMvcConfig</span> <span style=color:green;font-weight:700>extends</span> WebMvcConfigurationSupport <span style=color:#666>{</span>
    <span style=color:#408080;font-style:italic>/**
</span><span style=color:#408080;font-style:italic>     * 设置静态资源映射
</span><span style=color:#408080;font-style:italic>     * 设置静态资源映射
</span><span style=color:#408080;font-style:italic>     * 使启动项目后可以访问到HTML等静态资源
</span><span style=color:#408080;font-style:italic>     * @param registry
</span><span style=color:#408080;font-style:italic>     */</span>
    <span style=color:#a2f>@Override</span>
    <span style=color:green;font-weight:700>protected</span> <span style=color:#b00040>void</span> <span style=color:#00f>addResourceHandlers</span><span style=color:#666>(</span>ResourceHandlerRegistry registry<span style=color:#666>)</span> <span style=color:#666>{</span>
        registry<span style=color:#666>.</span><span style=color:#7d9029>addResourceHandler</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;doc.html&#34;</span><span style=color:#666>).</span><span style=color:#7d9029>addResourceLocations</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;classpath:/META-INF/resources/&#34;</span><span style=color:#666>);</span>
        registry<span style=color:#666>.</span><span style=color:#7d9029>addResourceHandler</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;/webjars/**&#34;</span><span style=color:#666>).</span><span style=color:#7d9029>addResourceLocations</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;classpath:/META-INF/resources/webjars/&#34;</span><span style=color:#666>);</span>

        registry<span style=color:#666>.</span><span style=color:#7d9029>addResourceHandler</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;/backend/**&#34;</span><span style=color:#666>)</span>
                <span style=color:#666>.</span><span style=color:#7d9029>addResourceLocations</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;classpath:/backend/&#34;</span><span style=color:#666>);</span>
        registry<span style=color:#666>.</span><span style=color:#7d9029>addResourceHandler</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;/front/**&#34;</span><span style=color:#666>)</span>
                <span style=color:#666>.</span><span style=color:#7d9029>addResourceLocations</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;classpath:/front/&#34;</span><span style=color:#666>);</span>
        <span style=color:#408080;font-style:italic>//当访问的url含/backend/开头的时候去classpath:/backend/找
</span><span style=color:#408080;font-style:italic></span>        log<span style=color:#666>.</span><span style=color:#7d9029>info</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;进行静态资源映射&#34;</span><span style=color:#666>);</span>
    <span style=color:#666>}</span>

    <span style=color:#a2f>@Override</span> <span style=color:#408080;font-style:italic>//扩展mvc框架的转换器
</span><span style=color:#408080;font-style:italic></span>    <span style=color:green;font-weight:700>protected</span> <span style=color:#b00040>void</span> <span style=color:#00f>extendMessageConverters</span><span style=color:#666>(</span>List<span style=color:#666>&lt;</span>HttpMessageConverter<span style=color:#666>&lt;?&gt;&gt;</span> converters<span style=color:#666>)</span> <span style=color:#666>{</span>
       log<span style=color:#666>.</span><span style=color:#7d9029>info</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;扩展消息转换器&#34;</span><span style=color:#666>);</span>
        MappingJackson2HttpMessageConverter messageConverter
                <span style=color:#666>=</span><span style=color:green;font-weight:700>new</span> MappingJackson2HttpMessageConverter<span style=color:#666>();</span>
        <span style=color:#408080;font-style:italic>//设置对象转换器，底层使用json将java对象转成json
</span><span style=color:#408080;font-style:italic></span>        messageConverter<span style=color:#666>.</span><span style=color:#7d9029>setObjectMapper</span><span style=color:#666>(</span><span style=color:green;font-weight:700>new</span> JacksonObjectMapper<span style=color:#666>());</span>
        <span style=color:#408080;font-style:italic>//将上面的消息转换器追加到mvc框架的转换器容器集合中，主要要放在前面所以加0
</span><span style=color:#408080;font-style:italic></span>        converters<span style=color:#666>.</span><span style=color:#7d9029>add</span><span style=color:#666>(</span>0<span style=color:#666>,</span>messageConverter<span style=color:#666>);</span>
    <span style=color:#666>}</span>


    <span style=color:#a2f>@Bean</span>
    <span style=color:green;font-weight:700>public</span> Docket <span style=color:#00f>createRestApi</span><span style=color:#666>()</span> <span style=color:#666>{</span>
        <span style=color:#408080;font-style:italic>// 文档类型
</span><span style=color:#408080;font-style:italic></span>        <span style=color:green;font-weight:700>return</span> <span style=color:green;font-weight:700>new</span> Docket<span style=color:#666>(</span>DocumentationType<span style=color:#666>.</span><span style=color:#7d9029>SWAGGER_2</span><span style=color:#666>)</span>
                <span style=color:#666>.</span><span style=color:#7d9029>apiInfo</span><span style=color:#666>(</span>apiInfo<span style=color:#666>())</span>
                <span style=color:#666>.</span><span style=color:#7d9029>select</span><span style=color:#666>()</span>
                <span style=color:#666>.</span><span style=color:#7d9029>apis</span><span style=color:#666>(</span>RequestHandlerSelectors<span style=color:#666>.</span><span style=color:#7d9029>basePackage</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;com.yang.reggie.controller&#34;</span><span style=color:#666>))</span>
                <span style=color:#666>.</span><span style=color:#7d9029>paths</span><span style=color:#666>(</span>PathSelectors<span style=color:#666>.</span><span style=color:#7d9029>any</span><span style=color:#666>())</span>
                <span style=color:#666>.</span><span style=color:#7d9029>build</span><span style=color:#666>();</span>
    <span style=color:#666>}</span>

    <span style=color:green;font-weight:700>private</span> ApiInfo <span style=color:#00f>apiInfo</span><span style=color:#666>()</span> <span style=color:#666>{</span>
        <span style=color:green;font-weight:700>return</span> <span style=color:green;font-weight:700>new</span> ApiInfoBuilder<span style=color:#666>()</span>
                <span style=color:#666>.</span><span style=color:#7d9029>title</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;星月外卖&#34;</span><span style=color:#666>)</span>
                <span style=color:#666>.</span><span style=color:#7d9029>version</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;1.0&#34;</span><span style=color:#666>)</span>
                <span style=color:#666>.</span><span style=color:#7d9029>description</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;星月外卖接口文档&#34;</span><span style=color:#666>)</span>
                <span style=color:#666>.</span><span style=color:#7d9029>build</span><span style=color:#666>();</span>
    <span style=color:#666>}</span>

<span style=color:#666>}</span>
</code></pre></div><h4 id=444redisconfig>4.4.4RedisConfig<a href=#444redisconfig class=header-anchor arialabel=Anchor> #</a></h4><div class=highlight><pre style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#a2f>@Configuration</span>
<span style=color:green;font-weight:700>public</span> <span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>RedisConfig</span> <span style=color:green;font-weight:700>extends</span> CachingConfigurerSupport <span style=color:#666>{</span>
    <span style=color:#a2f>@Bean</span>
    <span style=color:green;font-weight:700>public</span> RedisTemplate<span style=color:#666>&lt;</span>String<span style=color:#666>,</span>Object<span style=color:#666>&gt;</span> <span style=color:#00f>redisTemplate</span><span style=color:#666>(</span>RedisConnectionFactory factory<span style=color:#666>){</span>
        RedisTemplate<span style=color:#666>&lt;</span>String<span style=color:#666>,</span>Object<span style=color:#666>&gt;</span>template<span style=color:#666>=</span><span style=color:green;font-weight:700>new</span> RedisTemplate<span style=color:#666>&lt;&gt;();</span>
        <span style=color:#408080;font-style:italic>//关联
</span><span style=color:#408080;font-style:italic></span>        template<span style=color:#666>.</span><span style=color:#7d9029>setConnectionFactory</span><span style=color:#666>(</span>factory<span style=color:#666>);</span>
        <span style=color:#408080;font-style:italic>//设置key的序列化器
</span><span style=color:#408080;font-style:italic></span>        template<span style=color:#666>.</span><span style=color:#7d9029>setKeySerializer</span><span style=color:#666>(</span><span style=color:green;font-weight:700>new</span> StringRedisSerializer<span style=color:#666>());</span>
        <span style=color:#408080;font-style:italic>//设置value的序列化器
</span><span style=color:#408080;font-style:italic></span>         template<span style=color:#666>.</span><span style=color:#7d9029>setHashKeySerializer</span><span style=color:#666>(</span><span style=color:green;font-weight:700>new</span> StringRedisSerializer<span style=color:#666>());</span>
        <span style=color:green;font-weight:700>return</span> template<span style=color:#666>;</span>
    <span style=color:#666>}</span>
<span style=color:#666>}</span>
</code></pre></div><h3 id=45utils包>4.5Utils包<a href=#45utils包 class=header-anchor arialabel=Anchor> #</a></h3><h4 id=451redisconstans>4.5.1RedisConstans<a href=#451redisconstans class=header-anchor arialabel=Anchor> #</a></h4><div class=highlight><pre style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#408080;font-style:italic>/**
</span><span style=color:#408080;font-style:italic> * @author yangxingyue0623
</span><span style=color:#408080;font-style:italic> * @date 2022/12/7 23:12
</span><span style=color:#408080;font-style:italic> */</span>
<span style=color:green;font-weight:700>public</span> <span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>RedisConstans</span> <span style=color:#666>{</span>
    <span style=color:green;font-weight:700>public</span> <span style=color:green;font-weight:700>static</span> <span style=color:green;font-weight:700>final</span> String LOGIN_CODE_KEY <span style=color:#666>=</span> <span style=color:#ba2121>&#34;login:code:&#34;</span><span style=color:#666>;</span>
<span style=color:#666>}</span>

</code></pre></div><h4 id=452-smsutils>4.5.2 SMSUtils<a href=#452-smsutils class=header-anchor arialabel=Anchor> #</a></h4><div class=highlight><pre style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#408080;font-style:italic>/**
</span><span style=color:#408080;font-style:italic> * 短信发送工具类
</span><span style=color:#408080;font-style:italic> */</span>
<span style=color:green;font-weight:700>public</span> <span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>SMSUtils</span> <span style=color:#666>{</span>

	<span style=color:#408080;font-style:italic>/**
</span><span style=color:#408080;font-style:italic>	 * 发送短信
</span><span style=color:#408080;font-style:italic>	 * @param signName 签名
</span><span style=color:#408080;font-style:italic>	 * @param templateCode 模板
</span><span style=color:#408080;font-style:italic>	 * @param phoneNumbers 手机号
</span><span style=color:#408080;font-style:italic>	 * @param param 参数
</span><span style=color:#408080;font-style:italic>	 */</span>
	<span style=color:green;font-weight:700>public</span> <span style=color:green;font-weight:700>static</span> <span style=color:#b00040>void</span> <span style=color:#00f>sendMessage</span><span style=color:#666>(</span>String signName<span style=color:#666>,</span> String templateCode<span style=color:#666>,</span>String phoneNumbers<span style=color:#666>,</span>String param<span style=color:#666>){</span>
		DefaultProfile profile <span style=color:#666>=</span> DefaultProfile<span style=color:#666>.</span><span style=color:#7d9029>getProfile</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;cn-hangzhou&#34;</span><span style=color:#666>,</span> <span style=color:#ba2121>&#34;&#34;</span><span style=color:#666>,</span> <span style=color:#ba2121>&#34;&#34;</span><span style=color:#666>);</span>
		IAcsClient client <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> DefaultAcsClient<span style=color:#666>(</span>profile<span style=color:#666>);</span>

		SendSmsRequest request <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> SendSmsRequest<span style=color:#666>();</span>
		request<span style=color:#666>.</span><span style=color:#7d9029>setSysRegionId</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;cn-hangzhou&#34;</span><span style=color:#666>);</span>
		request<span style=color:#666>.</span><span style=color:#7d9029>setPhoneNumbers</span><span style=color:#666>(</span>phoneNumbers<span style=color:#666>);</span>
		request<span style=color:#666>.</span><span style=color:#7d9029>setSignName</span><span style=color:#666>(</span>signName<span style=color:#666>);</span>
		request<span style=color:#666>.</span><span style=color:#7d9029>setTemplateCode</span><span style=color:#666>(</span>templateCode<span style=color:#666>);</span>
		request<span style=color:#666>.</span><span style=color:#7d9029>setTemplateParam</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;{\&#34;code\&#34;:\&#34;&#34;</span><span style=color:#666>+</span>param<span style=color:#666>+</span><span style=color:#ba2121>&#34;\&#34;}&#34;</span><span style=color:#666>);</span>
		<span style=color:green;font-weight:700>try</span> <span style=color:#666>{</span>
			SendSmsResponse response <span style=color:#666>=</span> client<span style=color:#666>.</span><span style=color:#7d9029>getAcsResponse</span><span style=color:#666>(</span>request<span style=color:#666>);</span>
			System<span style=color:#666>.</span><span style=color:#7d9029>out</span><span style=color:#666>.</span><span style=color:#7d9029>println</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;短信发送成功&#34;</span><span style=color:#666>);</span>
		<span style=color:#666>}</span><span style=color:green;font-weight:700>catch</span> <span style=color:#666>(</span>ClientException e<span style=color:#666>)</span> <span style=color:#666>{</span>
			e<span style=color:#666>.</span><span style=color:#7d9029>printStackTrace</span><span style=color:#666>();</span>
		<span style=color:#666>}</span>
	<span style=color:#666>}</span>
<span style=color:#666>}</span>
</code></pre></div><h4 id=453-validatecodeutils>4.5.3 ValidateCodeUtils<a href=#453-validatecodeutils class=header-anchor arialabel=Anchor> #</a></h4><div class=highlight><pre style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>
<span style=color:#408080;font-style:italic>/**
</span><span style=color:#408080;font-style:italic> * 随机生成验证码工具类
</span><span style=color:#408080;font-style:italic> */</span>
<span style=color:green;font-weight:700>public</span> <span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>ValidateCodeUtils</span> <span style=color:#666>{</span>
    <span style=color:#408080;font-style:italic>/**
</span><span style=color:#408080;font-style:italic>     * 随机生成验证码
</span><span style=color:#408080;font-style:italic>     * @param length 长度为4位或者6位
</span><span style=color:#408080;font-style:italic>     * @return
</span><span style=color:#408080;font-style:italic>     */</span>
    <span style=color:green;font-weight:700>public</span> <span style=color:green;font-weight:700>static</span> Integer <span style=color:#00f>generateValidateCode</span><span style=color:#666>(</span><span style=color:#b00040>int</span> length<span style=color:#666>){</span>
        Integer code <span style=color:#666>=</span><span style=color:green;font-weight:700>null</span><span style=color:#666>;</span>
        <span style=color:green;font-weight:700>if</span><span style=color:#666>(</span>length <span style=color:#666>==</span> 4<span style=color:#666>){</span>
            code <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> Random<span style=color:#666>().</span><span style=color:#7d9029>nextInt</span><span style=color:#666>(</span>9999<span style=color:#666>);</span><span style=color:#408080;font-style:italic>//生成随机数，最大为9999
</span><span style=color:#408080;font-style:italic></span>            <span style=color:green;font-weight:700>if</span><span style=color:#666>(</span>code <span style=color:#666>&lt;</span> 1000<span style=color:#666>){</span>
                code <span style=color:#666>=</span> code <span style=color:#666>+</span> 1000<span style=color:#666>;</span><span style=color:#408080;font-style:italic>//保证随机数为4位数字
</span><span style=color:#408080;font-style:italic></span>            <span style=color:#666>}</span>
        <span style=color:#666>}</span><span style=color:green;font-weight:700>else</span> <span style=color:green;font-weight:700>if</span><span style=color:#666>(</span>length <span style=color:#666>==</span> 6<span style=color:#666>){</span>
            code <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> Random<span style=color:#666>().</span><span style=color:#7d9029>nextInt</span><span style=color:#666>(</span>999999<span style=color:#666>);</span><span style=color:#408080;font-style:italic>//生成随机数，最大为999999
</span><span style=color:#408080;font-style:italic></span>            <span style=color:green;font-weight:700>if</span><span style=color:#666>(</span>code <span style=color:#666>&lt;</span> 100000<span style=color:#666>){</span>
                code <span style=color:#666>=</span> code <span style=color:#666>+</span> 100000<span style=color:#666>;</span><span style=color:#408080;font-style:italic>//保证随机数为6位数字
</span><span style=color:#408080;font-style:italic></span>            <span style=color:#666>}</span>
        <span style=color:#666>}</span><span style=color:green;font-weight:700>else</span><span style=color:#666>{</span>
            <span style=color:green;font-weight:700>throw</span> <span style=color:green;font-weight:700>new</span> RuntimeException<span style=color:#666>(</span><span style=color:#ba2121>&#34;只能生成4位或6位数字验证码&#34;</span><span style=color:#666>);</span>
        <span style=color:#666>}</span>
        <span style=color:green;font-weight:700>return</span> code<span style=color:#666>;</span>
    <span style=color:#666>}</span>

    <span style=color:#408080;font-style:italic>/**
</span><span style=color:#408080;font-style:italic>     * 随机生成指定长度字符串验证码
</span><span style=color:#408080;font-style:italic>     * @param length 长度
</span><span style=color:#408080;font-style:italic>     * @return
</span><span style=color:#408080;font-style:italic>     */</span>
    <span style=color:green;font-weight:700>public</span> <span style=color:green;font-weight:700>static</span> String <span style=color:#00f>generateValidateCode4String</span><span style=color:#666>(</span><span style=color:#b00040>int</span> length<span style=color:#666>){</span>
        Random rdm <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> Random<span style=color:#666>();</span>
        String hash1 <span style=color:#666>=</span> Integer<span style=color:#666>.</span><span style=color:#7d9029>toHexString</span><span style=color:#666>(</span>rdm<span style=color:#666>.</span><span style=color:#7d9029>nextInt</span><span style=color:#666>());</span>
        String capstr <span style=color:#666>=</span> hash1<span style=color:#666>.</span><span style=color:#7d9029>substring</span><span style=color:#666>(</span>0<span style=color:#666>,</span> length<span style=color:#666>);</span>
        <span style=color:green;font-weight:700>return</span> capstr<span style=color:#666>;</span>
    <span style=color:#666>}</span>
<span style=color:#666>}</span>

</code></pre></div><h2 id=5entity包dto包>5.entity包,DTO包<a href=#5entity包dto包 class=header-anchor arialabel=Anchor> #</a></h2><div class=highlight><pre style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#408080;font-style:italic>/**
</span><span style=color:#408080;font-style:italic> 菜品
</span><span style=color:#408080;font-style:italic> */</span>
<span style=color:#a2f>@Data</span>
<span style=color:green;font-weight:700>public</span> <span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>Dish</span> <span style=color:green;font-weight:700>implements</span> Serializable <span style=color:#666>{</span>

    <span style=color:green;font-weight:700>private</span> <span style=color:green;font-weight:700>static</span> <span style=color:green;font-weight:700>final</span> <span style=color:#b00040>long</span> serialVersionUID <span style=color:#666>=</span> 1L<span style=color:#666>;</span>

    <span style=color:green;font-weight:700>private</span> Long id<span style=color:#666>;</span>


    <span style=color:#408080;font-style:italic>//菜品名称
</span><span style=color:#408080;font-style:italic></span>    <span style=color:green;font-weight:700>private</span> String name<span style=color:#666>;</span>


    <span style=color:#408080;font-style:italic>//菜品分类id
</span><span style=color:#408080;font-style:italic></span>    <span style=color:green;font-weight:700>private</span> Long categoryId<span style=color:#666>;</span>


    <span style=color:#408080;font-style:italic>//菜品价格
</span><span style=color:#408080;font-style:italic></span>    <span style=color:green;font-weight:700>private</span> BigDecimal price<span style=color:#666>;</span>


    <span style=color:#408080;font-style:italic>//商品码
</span><span style=color:#408080;font-style:italic></span>    <span style=color:green;font-weight:700>private</span> String code<span style=color:#666>;</span>


    <span style=color:#408080;font-style:italic>//图片
</span><span style=color:#408080;font-style:italic></span>    <span style=color:green;font-weight:700>private</span> String image<span style=color:#666>;</span>


    <span style=color:#408080;font-style:italic>//描述信息
</span><span style=color:#408080;font-style:italic></span>    <span style=color:green;font-weight:700>private</span> String description<span style=color:#666>;</span>


    <span style=color:#408080;font-style:italic>//0 停售 1 起售
</span><span style=color:#408080;font-style:italic></span>    <span style=color:green;font-weight:700>private</span> Integer status<span style=color:#666>;</span>


    <span style=color:#408080;font-style:italic>//顺序
</span><span style=color:#408080;font-style:italic></span>    <span style=color:green;font-weight:700>private</span> Integer sort<span style=color:#666>;</span>


    <span style=color:#a2f>@TableField</span><span style=color:#666>(</span>fill <span style=color:#666>=</span> FieldFill<span style=color:#666>.</span><span style=color:#7d9029>INSERT</span><span style=color:#666>)</span>
    <span style=color:green;font-weight:700>private</span> LocalDateTime createTime<span style=color:#666>;</span>


    <span style=color:#a2f>@TableField</span><span style=color:#666>(</span>fill <span style=color:#666>=</span> FieldFill<span style=color:#666>.</span><span style=color:#7d9029>INSERT_UPDATE</span><span style=color:#666>)</span>
    <span style=color:green;font-weight:700>private</span> LocalDateTime updateTime<span style=color:#666>;</span>


    <span style=color:#a2f>@TableField</span><span style=color:#666>(</span>fill <span style=color:#666>=</span> FieldFill<span style=color:#666>.</span><span style=color:#7d9029>INSERT</span><span style=color:#666>)</span>
    <span style=color:green;font-weight:700>private</span> Long createUser<span style=color:#666>;</span>


    <span style=color:#a2f>@TableField</span><span style=color:#666>(</span>fill <span style=color:#666>=</span> FieldFill<span style=color:#666>.</span><span style=color:#7d9029>INSERT_UPDATE</span><span style=color:#666>)</span>
    <span style=color:green;font-weight:700>private</span> Long updateUser<span style=color:#666>;</span>


    <span style=color:#408080;font-style:italic>//是否删除
</span><span style=color:#408080;font-style:italic></span>    <span style=color:#a2f>@TableLogic</span>
    <span style=color:green;font-weight:700>private</span> Integer isDeleted<span style=color:#666>;</span>

<span style=color:#666>}</span>
其余略
</code></pre></div><blockquote><p>此时传输的参数，需要封装一个新的对象进行接收Data Transfer Object 数据传输对象，一般用于展示层与层之间的数据传输</p><p>前端回传的json数据需要RequestBody反序列化到我们定义的实体类中</p></blockquote><table><thead><tr><th>实体模型</th><th>描述</th></tr></thead><tbody><tr><td>DTO</td><td>Data Transfer Object(数据传输对象)，一般用于展示层与服务层之间的数据传输。</td></tr><tr><td>Entity</td><td>最常用实体类，基本和数据表一一对应，一个实体类对应一张表。</td></tr><tr><td>VO</td><td>Value Object(值对象), 主要用于封装前端页面展示的数据对象，用一个VO对象来封装整个页面展示所需要的对象数据</td></tr><tr><td>PO</td><td>Persistant Object(持久层对象), 是ORM(Objevt Relational Mapping)框架中Entity，PO属性和数据库中表的字段形成一一对应关系</td></tr></tbody></table><div class=highlight><pre style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#a2f>@Data</span>
<span style=color:green;font-weight:700>public</span> <span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>DishDto</span> <span style=color:green;font-weight:700>extends</span> Dish <span style=color:#666>{</span>

    <span style=color:green;font-weight:700>private</span> List<span style=color:#666>&lt;</span>DishFlavor<span style=color:#666>&gt;</span> flavors <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> ArrayList<span style=color:#666>&lt;&gt;();</span>

    <span style=color:green;font-weight:700>private</span> String categoryName<span style=color:#666>;</span>

    <span style=color:green;font-weight:700>private</span> Integer copies<span style=color:#666>;</span>
<span style=color:#666>}</span>

<span style=color:#408080;font-style:italic>/**
</span><span style=color:#408080;font-style:italic> * @author yangxingyue0623
</span><span style=color:#408080;font-style:italic> * @date 2022/12/7 18:14
</span><span style=color:#408080;font-style:italic> */</span>
<span style=color:#a2f>@Data</span>
<span style=color:green;font-weight:700>public</span> <span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>OrderDto</span> <span style=color:green;font-weight:700>extends</span> Orders <span style=color:#666>{</span>
    <span style=color:green;font-weight:700>private</span> List<span style=color:#666>&lt;</span>OrderDetail<span style=color:#666>&gt;</span> orderDetails<span style=color:#666>;</span>
<span style=color:#666>}</span>

<span style=color:#a2f>@Data</span>
<span style=color:green;font-weight:700>public</span> <span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>SetmealDto</span> <span style=color:green;font-weight:700>extends</span> Setmeal <span style=color:#666>{</span>

    <span style=color:green;font-weight:700>private</span> List<span style=color:#666>&lt;</span>SetmealDish<span style=color:#666>&gt;</span> setmealDishes<span style=color:#666>;</span>

    <span style=color:green;font-weight:700>private</span> String categoryName<span style=color:#666>;</span>
<span style=color:#666>}</span>

</code></pre></div><h2 id=6controllermapperservice>6.controller,Mapper,Service<a href=#6controllermapperservice class=header-anchor arialabel=Anchor> #</a></h2><ul><li>1.首先在Application.class开启注解@MapperScan(&ldquo;com.yang.reggie.mapper&rdquo;)</li><li>结构类似，省略</li></ul><div class=highlight><pre style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span>#</span> controller
<span style=color:#a2f>@RestController</span>
<span style=color:#a2f>@RequestMapping</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;/user&#34;</span><span style=color:#666>)</span>
<span style=color:#a2f>@Slf4j</span>
<span style=color:green;font-weight:700>public</span> <span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>UserController</span> <span style=color:#666>{</span>
<span style=color:#666>}</span>
<span>#</span> Mapper
<span style=color:#a2f>@Mapper</span>
<span style=color:green;font-weight:700>public</span> <span style=color:green;font-weight:700>interface</span> <span style=color:#00f;font-weight:700>UserMapper</span> <span style=color:green;font-weight:700>extends</span> BaseMapper<span style=color:#666>&lt;</span>User<span style=color:#666>&gt;{</span>
<span style=color:#666>}</span>
<span>#</span> service包下
<span style=color:green;font-weight:700>public</span> <span style=color:green;font-weight:700>interface</span> <span style=color:#00f;font-weight:700>UserService</span> <span style=color:green;font-weight:700>extends</span> IService<span style=color:#666>&lt;</span>User<span style=color:#666>&gt;</span> <span style=color:#666>{</span>

<span style=color:#666>}</span>
<span>#</span>service层
<span style=color:#a2f>@Service</span>
<span style=color:#a2f>@Slf4j</span>
<span style=color:green;font-weight:700>public</span> <span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>UserServiceImpl</span> <span style=color:green;font-weight:700>extends</span> ServiceImpl<span style=color:#666>&lt;</span>UserMapper<span style=color:#666>,</span> User<span style=color:#666>&gt;</span> 
    <span style=color:green;font-weight:700>implements</span> UserService <span style=color:#666>{</span>
<span style=color:#666>}</span>
</code></pre></div><h2 id=7移动端验证码发送登录redis缓存邮件发送退出>7.移动端：验证码发送登录/redis缓存/邮件发送/退出<a href=#7移动端验证码发送登录redis缓存邮件发送退出 class=header-anchor arialabel=Anchor> #</a></h2><h4 id=1依赖注入>1.依赖注入<a href=#1依赖注入 class=header-anchor arialabel=Anchor> #</a></h4><div class=highlight><pre style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>        <span style=color:#666>&lt;!--</span> 邮件服务<span style=color:#666>,</span>用来做验证码的发送验证<span style=color:#666>--&gt;</span>
        <span style=color:#666>&lt;</span>dependency<span style=color:#666>&gt;</span>
            <span style=color:#666>&lt;</span>groupId<span style=color:#666>&gt;</span>org<span style=color:#666>.</span><span style=color:#7d9029>springframework</span><span style=color:#666>.</span><span style=color:#7d9029>boot</span><span style=color:#666>&lt;/</span>groupId<span style=color:#666>&gt;</span>
            <span style=color:#666>&lt;</span>artifactId<span style=color:#666>&gt;</span>spring<span style=color:#666>-</span>boot<span style=color:#666>-</span>starter<span style=color:#666>-</span>mail<span style=color:#666>&lt;/</span>artifactId<span style=color:#666>&gt;</span>
        <span style=color:#666>&lt;/</span>dependency<span style=color:#666>&gt;</span>
        <span style=color:#666>&lt;!--</span> Thymeleaf 模版<span>，</span>用于发送模版邮件 <span style=color:#666>--&gt;</span>
        <span style=color:#666>&lt;</span>dependency<span style=color:#666>&gt;</span>
            <span style=color:#666>&lt;</span>groupId<span style=color:#666>&gt;</span>org<span style=color:#666>.</span><span style=color:#7d9029>springframework</span><span style=color:#666>.</span><span style=color:#7d9029>boot</span><span style=color:#666>&lt;/</span>groupId<span style=color:#666>&gt;</span>
            <span style=color:#666>&lt;</span>artifactId<span style=color:#666>&gt;</span>spring<span style=color:#666>-</span>boot<span style=color:#666>-</span>starter<span style=color:#666>-</span>thymeleaf<span style=color:#666>&lt;/</span>artifactId<span style=color:#666>&gt;</span>
        <span style=color:#666>&lt;/</span>dependency<span style=color:#666>&gt;</span>
  <span style=color:#666>&lt;!--</span> redis <span style=color:#666>--&gt;</span>
        <span style=color:#666>&lt;</span>dependency<span style=color:#666>&gt;</span>
            <span style=color:#666>&lt;</span>groupId<span style=color:#666>&gt;</span>org<span style=color:#666>.</span><span style=color:#7d9029>springframework</span><span style=color:#666>.</span><span style=color:#7d9029>boot</span><span style=color:#666>&lt;/</span>groupId<span style=color:#666>&gt;</span>
            <span style=color:#666>&lt;</span>artifactId<span style=color:#666>&gt;</span>spring<span style=color:#666>-</span>boot<span style=color:#666>-</span>starter<span style=color:#666>-</span>data<span style=color:#666>-</span>redis<span style=color:#666>&lt;/</span>artifactId<span style=color:#666>&gt;</span>
        <span style=color:#666>&lt;/</span>dependency<span style=color:#666>&gt;</span>
</code></pre></div><h4 id=2利用qq邮箱开启foxmail功能实现邮件的代发>2.利用QQ邮箱开启Foxmail功能实现邮件的代发<a href=#2利用qq邮箱开启foxmail功能实现邮件的代发 class=header-anchor arialabel=Anchor> #</a></h4><p><img src=https://img-blog.csdnimg.cn/4e9dea07ebbe49f48cf0846c25172e54.png alt=img></p><h4 id=3配置yaml的邮箱>3.配置yaml的邮箱<a href=#3配置yaml的邮箱 class=header-anchor arialabel=Anchor> #</a></h4><div class=highlight><pre style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#408080;font-style:italic># 邮箱配置</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>mail</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>host</span>:<span style=color:#bbb> </span>smtp.qq.com <span style=color:#bbb> </span><span style=color:#408080;font-style:italic># 发送邮件的服务器地址</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>username</span>:<span style=color:#bbb> </span><span style=color:#666>1573478674</span>@qq.com<span style=color:#bbb> </span><span style=color:#408080;font-style:italic># 开启 IMAP/SMTP服务 的qq邮箱的账号</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>password</span>:<span style=color:#bbb> </span>aibzoigxgvfphjjg<span style=color:#bbb> </span><span style=color:#408080;font-style:italic># 开启 IMAP/SMTP服务 获得的授权码,而不是qq邮箱的登录密码</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>default-encoding</span>:<span style=color:#bbb> </span>UTF-8<span style=color:#bbb>
</span><span style=color:#bbb> </span><span style=color:#408080;font-style:italic>#redis配置</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>redis</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>host</span>:<span style=color:#bbb> </span><span style=color:#666>192.168.8.130</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>port</span>:<span style=color:#bbb> </span><span style=color:#666>6379</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>password</span>:<span style=color:#bbb> </span>yangroot<span style=color:#bbb>
</span></code></pre></div><h4 id=4-修改前端的代码>4 修改前端的代码<a href=#4-修改前端的代码 class=header-anchor arialabel=Anchor> #</a></h4><div class=highlight><pre style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#666>&lt;!</span>DOCTYPE html<span style=color:#666>&gt;</span>
<span style=color:#666>&lt;</span>html lang<span style=color:#666>=</span><span style=color:#ba2121>&#34;en&#34;</span><span style=color:#666>&gt;</span>
<span style=color:#666>&lt;</span>head<span style=color:#666>&gt;</span>
    <span style=color:#666>&lt;</span>meta charset<span style=color:#666>=</span><span style=color:#ba2121>&#34;utf-8&#34;</span><span style=color:#666>&gt;</span>
    <span style=color:#666>&lt;</span>meta http<span style=color:#666>-</span>equiv<span style=color:#666>=</span><span style=color:#ba2121>&#34;X-UA-Compatible&#34;</span> content<span style=color:#666>=</span><span style=color:#ba2121>&#34;IE=edge&#34;</span><span style=color:#666>&gt;</span>
    <span style=color:#666>&lt;!--</span> 上述3个meta标签<span style=color:#666>*</span>必须<span style=color:#666>*</span>放在最前面<span>，</span>任何其他内容都<span style=color:#666>*</span>必须<span style=color:#666>*</span>跟随其后<span>！</span> <span style=color:#666>--&gt;</span>
    <span style=color:#666>&lt;</span>meta name<span style=color:#666>=</span><span style=color:#ba2121>&#34;viewport&#34;</span>
          content<span style=color:#666>=</span><span style=color:#ba2121>&#34;width=device-width, initial-scale=1.0, maximum-scale=1.0,user-scalable=no,minimal-ui&#34;</span><span style=color:#666>&gt;</span>
    <span style=color:#666>&lt;</span>title<span style=color:#666>&gt;</span>菩提阁<span style=color:#666>&lt;/</span>title<span style=color:#666>&gt;</span>
    <span style=color:#666>&lt;</span>link rel<span style=color:#666>=</span><span style=color:#ba2121>&#34;icon&#34;</span> href<span style=color:#666>=</span><span style=color:#ba2121>&#34;./../images/favico.ico&#34;</span><span style=color:#666>&gt;</span>
    <span style=color:#666>&lt;!--</span>不同屏幕尺寸根字体设置<span style=color:#666>--&gt;</span>
    <span style=color:#666>&lt;</span>script src<span style=color:#666>=</span><span style=color:#ba2121>&#34;./../js/base.js&#34;</span><span style=color:#666>&gt;&lt;/</span>script<span style=color:#666>&gt;</span>
    <span style=color:#666>&lt;!--</span>element<span style=color:#666>-</span>ui的样式<span style=color:#666>--&gt;</span>
    <span style=color:#666>&lt;</span>link rel<span style=color:#666>=</span><span style=color:#ba2121>&#34;stylesheet&#34;</span> href<span style=color:#666>=</span><span style=color:#ba2121>&#34;../../backend/plugins/element-ui/index.css&#34;</span><span style=color:#666>/&gt;</span>
    <span style=color:#666>&lt;!--</span>引入vant样式<span style=color:#666>--&gt;</span>
    <span style=color:#666>&lt;</span>link rel<span style=color:#666>=</span><span style=color:#ba2121>&#34;stylesheet&#34;</span> href<span style=color:#666>=</span><span style=color:#ba2121>&#34;../styles/vant.min.css&#34;</span><span style=color:#666>/&gt;</span>
    <span style=color:#666>&lt;!--</span> 引入样式  <span style=color:#666>--&gt;</span>
    <span style=color:#666>&lt;</span>link rel<span style=color:#666>=</span><span style=color:#ba2121>&#34;stylesheet&#34;</span> href<span style=color:#666>=</span><span style=color:#ba2121>&#34;../styles/index.css&#34;</span><span style=color:#666>/&gt;</span>
    <span style=color:#666>&lt;!--</span>本页面内容的样式<span style=color:#666>--&gt;</span>
    <span style=color:#666>&lt;</span>link rel<span style=color:#666>=</span><span style=color:#ba2121>&#34;stylesheet&#34;</span> href<span style=color:#666>=</span><span style=color:#ba2121>&#34;./../styles/login.css&#34;</span><span style=color:#666>/&gt;</span>
<span style=color:#666>&lt;/</span>head<span style=color:#666>&gt;</span>
<span style=color:#666>&lt;</span>body<span style=color:#666>&gt;</span>
<span style=color:#666>&lt;</span>div id<span style=color:#666>=</span><span style=color:#ba2121>&#34;login&#34;</span> v<span style=color:#666>-</span>loading<span style=color:#666>=</span><span style=color:#ba2121>&#34;loading&#34;</span><span style=color:#666>&gt;</span>
    <span style=color:#666>&lt;</span>div class<span style=color:#666>=</span><span style=color:#ba2121>&#34;divHead&#34;</span><span style=color:#666>&gt;</span>登录<span style=color:#666>&lt;/</span>div<span style=color:#666>&gt;</span>
    <span style=color:#666>&lt;</span>div class<span style=color:#666>=</span><span style=color:#ba2121>&#34;divContainer&#34;</span><span style=color:#666>&gt;</span>
        <span style=color:#666>&lt;</span>el<span style=color:#666>-</span>input placeholder<span style=color:#666>=</span><span style=color:#ba2121>&#34; 请输入邮箱&#34;</span> v<span style=color:#666>-</span>model<span style=color:#666>=</span><span style=color:#ba2121>&#34;form.phone&#34;</span> maxlength<span style=color:#666>=</span><span>&#39;</span>20<span>&#39;</span><span style=color:#666>/&gt;</span>
        <span style=color:#666>&lt;/</span>el<span style=color:#666>-</span>input<span style=color:#666>&gt;</span>
        <span style=color:#666>&lt;</span>div class<span style=color:#666>=</span><span style=color:#ba2121>&#34;divSplit&#34;</span><span style=color:#666>&gt;&lt;/</span>div<span style=color:#666>&gt;</span>
        <span style=color:#666>&lt;</span>el<span style=color:#666>-</span>input placeholder<span style=color:#666>=</span><span style=color:#ba2121>&#34; 请输入验证码&#34;</span> v<span style=color:#666>-</span>model<span style=color:#666>=</span><span style=color:#ba2121>&#34;form.code&#34;</span> maxlength<span style=color:#666>=</span><span>&#39;</span>20<span>&#39;</span><span style=color:#666>/&gt;</span>
        <span style=color:#666>&lt;/</span>el<span style=color:#666>-</span>input<span style=color:#666>&gt;</span>
        <span style=color:#666>&lt;</span>span v<span style=color:#666>-</span><span style=color:green;font-weight:700>if</span><span style=color:#666>=</span><span style=color:#ba2121>&#34;second &gt; 0&#34;</span><span style=color:#666>&gt;{{</span>second<span style=color:#666>}}</span>s<span style=color:#666>&lt;/</span>span<span style=color:#666>&gt;</span>
        <span style=color:#666>&lt;</span>span v<span style=color:#666>-</span><span style=color:green;font-weight:700>if</span><span style=color:#666>=</span><span style=color:#ba2121>&#34;second &lt;= 0&#34;</span> <span style=color:#a2f>@click</span><span style=color:#666>=</span><span>&#39;</span>getCode<span>&#39;</span><span style=color:#666>&gt;</span>获取验证码<span style=color:#666>&lt;/</span>span<span style=color:#666>&gt;</span>
    <span style=color:#666>&lt;/</span>div<span style=color:#666>&gt;</span>
    <span style=color:#666>&lt;</span>div class<span style=color:#666>=</span><span style=color:#ba2121>&#34;divMsg&#34;</span> v<span style=color:#666>-</span><span style=color:green;font-weight:700>if</span><span style=color:#666>=</span><span style=color:#ba2121>&#34;msgFlag&#34;</span><span style=color:#666>&gt;</span>邮箱格式不正确<span>，</span>请重新输入<span style=color:#666>&lt;/</span>div<span style=color:#666>&gt;</span>
    <span style=color:#666>&lt;</span>el<span style=color:#666>-</span>button type<span style=color:#666>=</span><span style=color:#ba2121>&#34;primary&#34;</span> <span style=color:#666>:</span>class<span style=color:#666>=</span><span style=color:#ba2121>&#34;{btnSubmit:1===1,btnNoPhone:!form.phone,btnPhone:form.phone}&#34;</span> <span style=color:#a2f>@click</span><span style=color:#666>=</span><span style=color:#ba2121>&#34;btnLogin&#34;</span><span style=color:#666>&gt;</span>
        登录
    <span style=color:#666>&lt;/</span>el<span style=color:#666>-</span>button<span style=color:#666>&gt;</span>
<span style=color:#666>&lt;/</span>div<span style=color:#666>&gt;</span>
<span style=color:#666>&lt;!--</span> 开发环境版本<span>，</span>包含了有帮助的命令行警告 <span style=color:#666>--&gt;</span>
<span style=color:#666>&lt;</span>script src<span style=color:#666>=</span><span style=color:#ba2121>&#34;../../backend/plugins/vue/vue.js&#34;</span><span style=color:#666>&gt;&lt;/</span>script<span style=color:#666>&gt;</span>
<span style=color:#666>&lt;!--</span> 引入组件库 <span style=color:#666>--&gt;</span>
<span style=color:#666>&lt;</span>script src<span style=color:#666>=</span><span style=color:#ba2121>&#34;../../backend/plugins/element-ui/index.js&#34;</span><span style=color:#666>&gt;&lt;/</span>script<span style=color:#666>&gt;</span>
<span style=color:#666>&lt;!--</span> 引入vant样式 <span style=color:#666>--&gt;</span>
<span style=color:#666>&lt;</span>script src<span style=color:#666>=</span><span style=color:#ba2121>&#34;./../js/vant.min.js&#34;</span><span style=color:#666>&gt;&lt;/</span>script<span style=color:#666>&gt;</span>
<span style=color:#666>&lt;!--</span> 引入axios <span style=color:#666>--&gt;</span>
<span style=color:#666>&lt;</span>script src<span style=color:#666>=</span><span style=color:#ba2121>&#34;../../backend/plugins/axios/axios.min.js&#34;</span><span style=color:#666>&gt;&lt;/</span>script<span style=color:#666>&gt;</span>
<span style=color:#666>&lt;</span>script src<span style=color:#666>=</span><span style=color:#ba2121>&#34;./../js/request.js&#34;</span><span style=color:#666>&gt;&lt;/</span>script<span style=color:#666>&gt;</span>
<span style=color:#666>&lt;</span>script src<span style=color:#666>=</span><span style=color:#ba2121>&#34;./../api/login.js&#34;</span><span style=color:#666>&gt;&lt;/</span>script<span style=color:#666>&gt;</span>
<span style=color:#666>&lt;/</span>body<span style=color:#666>&gt;</span>
<span style=color:#666>&lt;</span>script<span style=color:#666>&gt;</span>
    <span style=color:green;font-weight:700>new</span> <span style=color:#00f>Vue</span><span style=color:#666>({</span>
        el<span style=color:#666>:</span> <span style=color:#ba2121>&#34;#login&#34;</span><span style=color:#666>,</span>
        data<span style=color:#666>()</span> <span style=color:#666>{</span>
            <span style=color:green;font-weight:700>return</span> <span style=color:#666>{</span>
                form<span style=color:#666>:</span> <span style=color:#666>{</span>
                    phone<span style=color:#666>:</span> <span>&#39;&#39;</span><span style=color:#666>,</span>
                    code<span style=color:#666>:</span> <span>&#39;&#39;</span>
                <span style=color:#666>},</span>
                <span style=color:#408080;font-style:italic>// 倒计时
</span><span style=color:#408080;font-style:italic></span>                second<span style=color:#666>:</span> <span style=color:#666>-</span>1<span style=color:#666>,</span>
                <span style=color:#408080;font-style:italic>// 判断邮箱格式
</span><span style=color:#408080;font-style:italic></span>                msgFlag<span style=color:#666>:</span> <span style=color:green;font-weight:700>false</span><span style=color:#666>,</span>
                <span style=color:#408080;font-style:italic>// 是否登陆中
</span><span style=color:#408080;font-style:italic></span>                loading<span style=color:#666>:</span> <span style=color:green;font-weight:700>false</span><span style=color:#666>,</span>
                <span style=color:#408080;font-style:italic>// 是否可以发送验证码
</span><span style=color:#408080;font-style:italic></span>                sending<span style=color:#666>:</span> <span style=color:green;font-weight:700>true</span><span style=color:#666>,</span>
                <span style=color:#408080;font-style:italic>// 倒计时定时任务引用 关闭登录层清除定时任务
</span><span style=color:#408080;font-style:italic></span>                clearSmsTime<span style=color:#666>:</span> <span style=color:green;font-weight:700>null</span>
            <span style=color:#666>}</span>
        <span style=color:#666>},</span>
        computed<span style=color:#666>:</span> <span style=color:#666>{},</span>
        created<span style=color:#666>()</span> <span style=color:#666>{</span>
        <span style=color:#666>},</span>
        mounted<span style=color:#666>()</span> <span style=color:#666>{</span>
        <span style=color:#666>},</span>
        methods<span style=color:#666>:</span> <span style=color:#666>{</span>
            getCode<span style=color:#666>()</span> <span style=color:#666>{</span>
                <span style=color:green;font-weight:700>this</span><span style=color:#666>.</span><span style=color:#7d9029>form</span><span style=color:#666>.</span><span style=color:#7d9029>code</span> <span style=color:#666>=</span> <span>&#39;&#39;</span>
                <span style=color:#408080;font-style:italic>// 手机号验证
</span><span style=color:#408080;font-style:italic></span>                <span style=color:#408080;font-style:italic>// const regex = /^(13[0-9]{9})|(15[0-9]{9})|(17[0-9]{9})|(18[0-9]{9})|(19[0-9]{9})$/;
</span><span style=color:#408080;font-style:italic></span>                <span style=color:#408080;font-style:italic>// 改为邮箱验证
</span><span style=color:#408080;font-style:italic></span>                <span style=color:green;font-weight:700>const</span> regex <span style=color:#666>=</span> <span style=color:#666>/^[</span>a<span style=color:#666>-</span>zA<span style=color:#666>-</span>Z0<span style=color:#666>-</span>9_<span style=color:#666>-]+</span><span>@</span><span style=color:#666>[</span>a<span style=color:#666>-</span>zA<span style=color:#666>-</span>Z0<span style=color:#666>-</span>9_<span style=color:#666>-]+(</span><span>\</span><span style=color:#666>.[</span>a<span style=color:#666>-</span>zA<span style=color:#666>-</span>Z0<span style=color:#666>-</span>9_<span style=color:#666>-]+)+</span>$<span style=color:#666>/;</span>
                <span style=color:green;font-weight:700>if</span> <span style=color:#666>(</span>regex<span style=color:#666>.</span><span style=color:#7d9029>test</span><span style=color:#666>(</span><span style=color:green;font-weight:700>this</span><span style=color:#666>.</span><span style=color:#7d9029>form</span><span style=color:#666>.</span><span style=color:#7d9029>phone</span><span style=color:#666>))</span> <span style=color:#666>{</span>
                    <span style=color:green;font-weight:700>this</span><span style=color:#666>.</span><span style=color:#7d9029>msgFlag</span> <span style=color:#666>=</span> <span style=color:green;font-weight:700>false</span>
                    <span style=color:#408080;font-style:italic>//this.form.code = (Math.random()*1000000).toFixed(0)
</span><span style=color:#408080;font-style:italic></span>                    sendMsgApi<span style=color:#666>({</span>phone<span style=color:#666>:</span> <span style=color:green;font-weight:700>this</span><span style=color:#666>.</span><span style=color:#7d9029>form</span><span style=color:#666>.</span><span style=color:#7d9029>phone</span><span style=color:#666>})</span>
                    <span style=color:#408080;font-style:italic>// 不可重复发送验证码
</span><span style=color:#408080;font-style:italic></span>                    <span style=color:green;font-weight:700>this</span><span style=color:#666>.</span><span style=color:#7d9029>sending</span> <span style=color:#666>=</span> <span style=color:green;font-weight:700>false</span>
                    <span style=color:#408080;font-style:italic>// 倒计时效果
</span><span style=color:#408080;font-style:italic></span>                    <span style=color:green;font-weight:700>this</span><span style=color:#666>.</span><span style=color:#7d9029>timeDown</span><span style=color:#666>()</span>
                <span style=color:#666>}</span> <span style=color:green;font-weight:700>else</span> <span style=color:#666>{</span>
                    <span style=color:green;font-weight:700>this</span><span style=color:#666>.</span><span style=color:#7d9029>msgFlag</span> <span style=color:#666>=</span> <span style=color:green;font-weight:700>true</span>
                <span style=color:#666>}</span>
            <span style=color:#666>},</span>
            <span style=color:#408080;font-style:italic>// 倒计时
</span><span style=color:#408080;font-style:italic></span>            timeDown<span style=color:#666>()</span> <span style=color:#666>{</span>
                <span style=color:green;font-weight:700>if</span> <span style=color:#666>(</span><span style=color:green;font-weight:700>this</span><span style=color:#666>.</span><span style=color:#7d9029>clearSmsTime</span><span style=color:#666>)</span> <span style=color:#666>{</span>
                    clearInterval<span style=color:#666>(</span><span style=color:green;font-weight:700>this</span><span style=color:#666>.</span><span style=color:#7d9029>clearSmsTime</span><span style=color:#666>)</span>
                <span style=color:#666>}</span>
                <span style=color:green;font-weight:700>this</span><span style=color:#666>.</span><span style=color:#7d9029>second</span> <span style=color:#666>=</span> 60
                <span style=color:green;font-weight:700>this</span><span style=color:#666>.</span><span style=color:#7d9029>clearSmsTime</span> <span style=color:#666>=</span> setInterval<span style=color:#666>(()</span> <span style=color:#666>=&gt;</span> <span style=color:#666>{</span>
                    <span style=color:#666>--</span><span style=color:green;font-weight:700>this</span><span style=color:#666>.</span><span style=color:#7d9029>second</span>
                    <span style=color:green;font-weight:700>if</span> <span style=color:#666>(</span><span style=color:green;font-weight:700>this</span><span style=color:#666>.</span><span style=color:#7d9029>second</span> <span style=color:#666>&lt;</span> 1<span style=color:#666>)</span> <span style=color:#666>{</span>
                        clearInterval<span style=color:#666>(</span><span style=color:green;font-weight:700>this</span><span style=color:#666>.</span><span style=color:#7d9029>clearSmsTime</span><span style=color:#666>)</span>
                        <span style=color:#408080;font-style:italic>// 可以重新发送验证码
</span><span style=color:#408080;font-style:italic></span>                        <span style=color:green;font-weight:700>this</span><span style=color:#666>.</span><span style=color:#7d9029>sending</span> <span style=color:#666>=</span> <span style=color:green;font-weight:700>true</span>
                        <span style=color:green;font-weight:700>this</span><span style=color:#666>.</span><span style=color:#7d9029>second</span> <span style=color:#666>=</span> 0
                    <span style=color:#666>}</span>
                <span style=color:#666>},</span> 1000<span style=color:#666>)</span>
            <span style=color:#666>},</span>
            async <span style=color:#00f>btnLogin</span><span style=color:#666>()</span> <span style=color:#666>{</span>
                <span style=color:green;font-weight:700>if</span> <span style=color:#666>(</span><span style=color:green;font-weight:700>this</span><span style=color:#666>.</span><span style=color:#7d9029>form</span><span style=color:#666>.</span><span style=color:#7d9029>phone</span> <span style=color:#666>&amp;&amp;</span> <span style=color:green;font-weight:700>this</span><span style=color:#666>.</span><span style=color:#7d9029>form</span><span style=color:#666>.</span><span style=color:#7d9029>code</span><span style=color:#666>)</span> <span style=color:#666>{</span>
                    <span style=color:green;font-weight:700>this</span><span style=color:#666>.</span><span style=color:#7d9029>loading</span> <span style=color:#666>=</span> <span style=color:green;font-weight:700>true</span>
                    <span style=color:green;font-weight:700>const</span> res <span style=color:#666>=</span> await <span style=color:#00f>loginApi</span><span style=color:#666>(</span><span style=color:green;font-weight:700>this</span><span style=color:#666>.</span><span style=color:#7d9029>form</span><span style=color:#666>)</span>
                    <span style=color:green;font-weight:700>this</span><span style=color:#666>.</span><span style=color:#7d9029>loading</span> <span style=color:#666>=</span> <span style=color:green;font-weight:700>false</span>
                    <span style=color:#00f>if</span> <span style=color:#666>(</span>res<span style=color:#666>.</span><span style=color:#7d9029>code</span> <span style=color:#666>===</span> 1<span style=color:#666>)</span> <span style=color:#666>{</span>
                        sessionStorage<span style=color:#666>.</span><span style=color:#7d9029>setItem</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;userPhone&#34;</span><span style=color:#666>,</span> <span style=color:green;font-weight:700>this</span><span style=color:#666>.</span><span style=color:#7d9029>form</span><span style=color:#666>.</span><span style=color:#7d9029>phone</span><span style=color:#666>)</span>
                        window<span style=color:#666>.</span><span style=color:#7d9029>requestAnimationFrame</span><span style=color:#666>(()</span> <span style=color:#666>=&gt;</span> <span style=color:#666>{</span>
                            window<span style=color:#666>.</span><span style=color:#7d9029>location</span><span style=color:#666>.</span><span style=color:#7d9029>href</span> <span style=color:#666>=</span> <span>&#39;</span><span style=color:#666>/</span>front<span style=color:#666>/</span>index<span style=color:#666>.</span><span style=color:#7d9029>html</span><span>&#39;</span>
                        <span style=color:#666>})</span>
                    <span style=color:#666>}</span> <span style=color:green;font-weight:700>else</span> <span style=color:#666>{</span>
                        <span style=color:green;font-weight:700>this</span><span style=color:#666>.</span><span style=color:#7d9029>$notify</span><span style=color:#666>({</span>type<span style=color:#666>:</span> <span>&#39;</span>warning<span>&#39;</span><span style=color:#666>,</span> message<span style=color:#666>:</span> res<span style=color:#666>.</span><span style=color:#7d9029>msg</span><span style=color:#666>});</span>
                    <span style=color:#666>}</span>
                <span style=color:#666>}</span> <span style=color:green;font-weight:700>else</span> <span style=color:#666>{</span>
                    <span style=color:green;font-weight:700>this</span><span style=color:#666>.</span><span style=color:#7d9029>$notify</span><span style=color:#666>({</span>type<span style=color:#666>:</span> <span>&#39;</span>warning<span>&#39;</span><span style=color:#666>,</span> message<span style=color:#666>:</span> <span>&#39;</span>请输入邮箱账号<span>&#39;</span><span style=color:#666>});</span>
                <span style=color:#666>}</span>
            <span style=color:#666>}</span>
        <span style=color:#666>}</span>
    <span style=color:#666>})</span>
<span style=color:#666>&lt;/</span>script<span style=color:#666>&gt;</span>
<span style=color:#666>&lt;/</span>html<span style=color:#666>&gt;</span>
</code></pre></div><h4 id=5usercontroller的sendmsgloginloginout>5.usercontroller的sendMsg/login/loginout<a href=#5usercontroller的sendmsgloginloginout class=header-anchor arialabel=Anchor> #</a></h4><div class=highlight><pre style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#a2f>@RestController</span>
<span style=color:#a2f>@RequestMapping</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;/user&#34;</span><span style=color:#666>)</span>
<span style=color:#a2f>@Slf4j</span>
<span style=color:green;font-weight:700>public</span> <span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>UserController</span> <span style=color:#666>{</span>
    <span style=color:#a2f>@Autowired</span>
    <span style=color:green;font-weight:700>private</span> UserService userService<span style=color:#666>;</span>
    <span style=color:#408080;font-style:italic>/**
</span><span style=color:#408080;font-style:italic>     * 发送手机短信验证码
</span><span style=color:#408080;font-style:italic>     * @param user
</span><span style=color:#408080;font-style:italic>     * @return
</span><span style=color:#408080;font-style:italic>     */</span>
    <span style=color:#a2f>@PostMapping</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;/sendMsg&#34;</span><span style=color:#666>)</span>
    <span style=color:green;font-weight:700>public</span> R<span style=color:#666>&lt;</span>String<span style=color:#666>&gt;</span> <span style=color:#00f>sendMsg</span><span style=color:#666>(</span><span style=color:#a2f>@RequestBody</span> User user<span style=color:#666>,</span> HttpSession session<span style=color:#666>){</span>
        <span style=color:green;font-weight:700>return</span> userService<span style=color:#666>.</span><span style=color:#7d9029>sendMsg</span><span style=color:#666>(</span>user<span style=color:#666>,</span>session<span style=color:#666>);</span>
    <span style=color:#666>}</span>
    <span style=color:#408080;font-style:italic>/**
</span><span style=color:#408080;font-style:italic>     * 移动端用户登录
</span><span style=color:#408080;font-style:italic>     * @param map
</span><span style=color:#408080;font-style:italic>     * @param session
</span><span style=color:#408080;font-style:italic>     * @return
</span><span style=color:#408080;font-style:italic>     */</span>
    <span style=color:#a2f>@PostMapping</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;/login&#34;</span><span style=color:#666>)</span>
    <span style=color:green;font-weight:700>public</span> R<span style=color:#666>&lt;</span>User<span style=color:#666>&gt;</span> <span style=color:#00f>login</span><span style=color:#666>(</span><span style=color:#a2f>@RequestBody</span> Map map<span style=color:#666>,</span> HttpSession session<span style=color:#666>){</span>
       <span style=color:green;font-weight:700>return</span> userService<span style=color:#666>.</span><span style=color:#7d9029>login</span><span style=color:#666>(</span>map<span style=color:#666>,</span>session<span style=color:#666>);</span>
    <span style=color:#666>}</span>
    <span style=color:#408080;font-style:italic>/**
</span><span style=color:#408080;font-style:italic>     * 退出登录
</span><span style=color:#408080;font-style:italic>     * @param request
</span><span style=color:#408080;font-style:italic>     * @return
</span><span style=color:#408080;font-style:italic>     */</span>
    <span style=color:#a2f>@PostMapping</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;/loginout&#34;</span><span style=color:#666>)</span>
    <span style=color:green;font-weight:700>public</span> R<span style=color:#666>&lt;</span>String<span style=color:#666>&gt;</span> <span style=color:#00f>loginout</span><span style=color:#666>(</span>HttpServletRequest request<span style=color:#666>){</span>
        <span style=color:#408080;font-style:italic>//清理session中的用户id
</span><span style=color:#408080;font-style:italic></span>        request<span style=color:#666>.</span><span style=color:#7d9029>getSession</span><span style=color:#666>().</span><span style=color:#7d9029>removeAttribute</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;user&#34;</span><span style=color:#666>);</span>
        <span style=color:green;font-weight:700>return</span> R<span style=color:#666>.</span><span style=color:#7d9029>success</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;退出成功&#34;</span><span style=color:#666>);</span>
    <span style=color:#666>}</span>
<span style=color:#666>}</span>

</code></pre></div><h4 id=6代码实现>6.代码实现<a href=#6代码实现 class=header-anchor arialabel=Anchor> #</a></h4><blockquote><p>1.发送验证码</p><p>利用邮件发送验证码，并且把验证码保存在redis里面</p><p>2.登录</p><p>把发送的验证码和redis中的验证码进行对比</p><p>如果存在且相等查询用户是否存在，不存在就创建</p><p>并且把用户存入session中</p><p>最后删除redis中的验证码</p><p>3.退出</p><p>根据session获得user，然后request.getSession().removeAttribute(&ldquo;user&rdquo;);</p></blockquote><div class=highlight><pre style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:green;font-weight:700>import static</span> <span style=color:#00f;font-weight:700>com.yang.reggie.utils.RedisConstans.LOGIN_CODE_KEY</span><span style=color:#666>;</span>

<span style=color:#a2f>@Service</span>
<span style=color:#a2f>@Slf4j</span>
<span style=color:green;font-weight:700>public</span> <span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>UserServiceImpl</span> <span style=color:green;font-weight:700>extends</span> ServiceImpl<span style=color:#666>&lt;</span>UserMapper<span style=color:#666>,</span> User<span style=color:#666>&gt;</span> <span style=color:green;font-weight:700>implements</span> UserService <span style=color:#666>{</span>
    <span style=color:#a2f>@Autowired</span>
    <span style=color:green;font-weight:700>private</span> OrderDetailService orderDetailService<span style=color:#666>;</span>
    <span style=color:#a2f>@Autowired</span>
    <span style=color:green;font-weight:700>private</span> RedisTemplate redisTemplate<span style=color:#666>;</span>
    <span style=color:#408080;font-style:italic>//把yml配置的邮箱号赋值到from
</span><span style=color:#408080;font-style:italic></span>
    <span style=color:#a2f>@Value</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;${spring.mail.username}&#34;</span><span style=color:#666>)</span>
    <span style=color:green;font-weight:700>private</span> String from<span style=color:#666>;</span>
    <span style=color:#408080;font-style:italic>//发送邮件需要的对象
</span><span style=color:#408080;font-style:italic></span>    <span style=color:#a2f>@Resource</span>
    <span style=color:green;font-weight:700>private</span> JavaMailSender javaMailSender<span style=color:#666>;</span>
    <span style=color:#408080;font-style:italic>//邮件发送人
</span><span style=color:#408080;font-style:italic></span>
    <span style=color:green;font-weight:700>public</span> <span style=color:#b00040>void</span> <span style=color:#00f>sendMsg1</span><span style=color:#666>(</span>String to<span style=color:#666>,</span> String subject<span style=color:#666>,</span> String text<span style=color:#666>)</span> <span style=color:#666>{</span>
        <span style=color:#408080;font-style:italic>//发送简单邮件，简单邮件不包括附件等别的
</span><span style=color:#408080;font-style:italic></span>        SimpleMailMessage message <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> SimpleMailMessage<span style=color:#666>();</span>
        message<span style=color:#666>.</span><span style=color:#7d9029>setFrom</span><span style=color:#666>(</span>from<span style=color:#666>);</span>
        message<span style=color:#666>.</span><span style=color:#7d9029>setTo</span><span style=color:#666>(</span>to<span style=color:#666>);</span>
        message<span style=color:#666>.</span><span style=color:#7d9029>setSubject</span><span style=color:#666>(</span>subject<span style=color:#666>);</span>
        message<span style=color:#666>.</span><span style=color:#7d9029>setText</span><span style=color:#666>(</span>text<span style=color:#666>);</span>
        <span style=color:#408080;font-style:italic>//发送邮件
</span><span style=color:#408080;font-style:italic></span>        javaMailSender<span style=color:#666>.</span><span style=color:#7d9029>send</span><span style=color:#666>(</span>message<span style=color:#666>);</span>
    <span style=color:#666>}</span>


    <span style=color:#a2f>@Override</span>
    <span style=color:green;font-weight:700>public</span> R<span style=color:#666>&lt;</span>String<span style=color:#666>&gt;</span> <span style=color:#00f>sendMsg</span><span style=color:#666>(</span>User user<span style=color:#666>,</span> HttpSession session<span style=color:#666>)</span> <span style=color:#666>{</span>

        <span style=color:#408080;font-style:italic>//1.获取邮箱号
</span><span style=color:#408080;font-style:italic></span>       String email <span style=color:#666>=</span> user<span style=color:#666>.</span><span style=color:#7d9029>getPhone</span><span style=color:#666>();</span>
        String subject <span style=color:#666>=</span> <span style=color:#ba2121>&#34;Eatting外卖&#34;</span><span style=color:#666>;</span>
        <span style=color:#408080;font-style:italic>//2.StringUtils.isNotEmpty字符串非空判断
</span><span style=color:#408080;font-style:italic></span>       <span style=color:green;font-weight:700>if</span> <span style=color:#666>(</span>StringUtils<span style=color:#666>.</span><span style=color:#7d9029>isNotEmpty</span><span style=color:#666>(</span>email<span style=color:#666>))</span> <span style=color:#666>{</span>
            <span style=color:#408080;font-style:italic>//3.发送验证码
</span><span style=color:#408080;font-style:italic></span>            String code <span style=color:#666>=</span> RandomUtil<span style=color:#666>.</span><span style=color:#7d9029>randomNumbers</span><span style=color:#666>(</span>6<span style=color:#666>);</span>
           <span style=color:#666>;</span>
           String text <span style=color:#666>=</span> <span style=color:#ba2121>&#34;【Eatting外卖】您好，您的登录验证码为：&#34;</span> <span style=color:#666>+</span> code <span style=color:#666>+</span> <span style=color:#ba2121>&#34;，请尽快登录，如非本人操作，请忽略此邮件。&#34;</span><span style=color:#666>;</span>
           log<span style=color:#666>.</span><span style=color:#7d9029>info</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;验证码为：&#34;</span> <span style=color:#666>+</span> code<span style=color:#666>);</span>
           <span style=color:#408080;font-style:italic>//4.发送邮件
</span><span style=color:#408080;font-style:italic></span>           <span style=color:green;font-weight:700>this</span><span style=color:#666>.</span><span style=color:#7d9029>sendMsg1</span><span style=color:#666>(</span>email<span style=color:#666>,</span> subject<span style=color:#666>,</span> text<span style=color:#666>);</span>
           <span style=color:#408080;font-style:italic>//将验证码保存到session当中
</span><span style=color:#408080;font-style:italic></span>           <span style=color:#408080;font-style:italic>//将邮箱作为key，将code最为value保存到session中,，因此邮箱和验证码可以一一对
</span><span style=color:#408080;font-style:italic></span>          <span style=color:#408080;font-style:italic>// 5.保存生成的验证码到redis,5分钟失效
</span><span style=color:#408080;font-style:italic></span>           redisTemplate<span style=color:#666>.</span><span style=color:#7d9029>opsForValue</span><span style=color:#666>().</span><span style=color:#7d9029>set</span><span style=color:#666>(</span>LOGIN_CODE_KEY <span style=color:#666>+</span> email<span style=color:#666>,</span> code<span style=color:#666>,</span> 5<span style=color:#666>,</span> TimeUnit<span style=color:#666>.</span><span style=color:#7d9029>MINUTES</span><span style=color:#666>);</span>
           <span style=color:green;font-weight:700>return</span> R<span style=color:#666>.</span><span style=color:#7d9029>success</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;验证码发送成功&#34;</span><span style=color:#666>);</span>
       <span style=color:#666>}</span>
        <span style=color:green;font-weight:700>return</span> R<span style=color:#666>.</span><span style=color:#7d9029>error</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;验证码发送异常，请重新发送&#34;</span><span style=color:#666>);</span>
    <span style=color:#666>}</span>

    <span style=color:#a2f>@Override</span>
    <span style=color:green;font-weight:700>public</span> R<span style=color:#666>&lt;</span>User<span style=color:#666>&gt;</span> <span style=color:#00f>login</span><span style=color:#666>(</span>Map map<span style=color:#666>,</span> HttpSession session<span style=color:#666>)</span> <span style=color:#666>{</span>
 

       log<span style=color:#666>.</span><span style=color:#7d9029>info</span><span style=color:#666>(</span>map<span style=color:#666>.</span><span style=color:#7d9029>toString</span><span style=color:#666>());</span>
       <span style=color:#408080;font-style:italic>//1.获取手机号（邮箱）
</span><span style=color:#408080;font-style:italic></span>       String phone <span style=color:#666>=</span> map<span style=color:#666>.</span><span style=color:#7d9029>get</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;phone&#34;</span><span style=color:#666>).</span><span style=color:#7d9029>toString</span><span style=color:#666>();</span>
       <span style=color:#408080;font-style:italic>//2.获取验证码.
</span><span style=color:#408080;font-style:italic></span>       String code <span style=color:#666>=</span> map<span style=color:#666>.</span><span style=color:#7d9029>get</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;code&#34;</span><span style=color:#666>).</span><span style=color:#7d9029>toString</span><span style=color:#666>();</span>
      <span style=color:#408080;font-style:italic>//3.从redis中获取保存的验证码
</span><span style=color:#408080;font-style:italic></span>        Object codeInSession <span style=color:#666>=</span>redisTemplate<span style=color:#666>.</span><span style=color:#7d9029>opsForValue</span><span style=color:#666>().</span><span style=color:#7d9029>get</span><span style=color:#666>(</span>LOGIN_CODE_KEY<span style=color:#666>+</span>phone<span style=color:#666>)</span> <span style=color:#666>;</span>
      <span style=color:#408080;font-style:italic>//进行验证码的比对（页面提交的验证码和Session中保存的验证码比对）
</span><span style=color:#408080;font-style:italic></span>   <span style=color:green;font-weight:700>if</span><span style=color:#666>(</span>codeInSession <span style=color:#666>!=</span> <span style=color:green;font-weight:700>null</span> <span style=color:#666>&amp;&amp;</span> codeInSession<span style=color:#666>.</span><span style=color:#7d9029>equals</span><span style=color:#666>(</span>code<span style=color:#666>)){</span>
            <span style=color:#408080;font-style:italic>//4.如果能够比对成功，说明登录成功
</span><span style=color:#408080;font-style:italic></span>           LambdaQueryWrapper<span style=color:#666>&lt;</span>User<span style=color:#666>&gt;</span> queryWrapper <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> LambdaQueryWrapper<span style=color:#666>&lt;&gt;();</span>
          queryWrapper<span style=color:#666>.</span><span style=color:#7d9029>eq</span><span style=color:#666>(</span>User<span style=color:#666>::</span>getPhone<span style=color:#666>,</span>phone<span style=color:#666>);</span>

           User user <span style=color:#666>=</span> <span style=color:green;font-weight:700>this</span><span style=color:#666>.</span><span style=color:#7d9029>getOne</span><span style=color:#666>(</span>queryWrapper<span style=color:#666>);</span>
            <span style=color:green;font-weight:700>if</span><span style=color:#666>(</span>user <span style=color:#666>==</span> <span style=color:green;font-weight:700>null</span><span style=color:#666>){</span>
               <span style=color:#408080;font-style:italic>//5.判断当前手机号对应的用户是否为新用户，如果是新用户就自动完成注册
</span><span style=color:#408080;font-style:italic></span>               user <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> User<span style=color:#666>();</span>
                user<span style=color:#666>.</span><span style=color:#7d9029>setPhone</span><span style=color:#666>(</span>phone<span style=color:#666>);</span>
               user<span style=color:#666>.</span><span style=color:#7d9029>setStatus</span><span style=color:#666>(</span>1<span style=color:#666>);</span>
                <span style=color:green;font-weight:700>this</span><span style=color:#666>.</span><span style=color:#7d9029>save</span><span style=color:#666>(</span>user<span style=color:#666>);</span>
            <span style=color:#666>}</span>
            <span style=color:#408080;font-style:italic>//6.登录成功之后把user写入session
</span><span style=color:#408080;font-style:italic></span>           session<span style=color:#666>.</span><span style=color:#7d9029>setAttribute</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;user&#34;</span><span style=color:#666>,</span>user<span style=color:#666>.</span><span style=color:#7d9029>getId</span><span style=color:#666>());</span>
           <span style=color:#408080;font-style:italic>//7.如果用户登录成功就可以删除redis中的验证码
</span><span style=color:#408080;font-style:italic></span>            redisTemplate<span style=color:#666>.</span><span style=color:#7d9029>delete</span><span style=color:#666>(</span>LOGIN_CODE_KEY<span style=color:#666>+</span>phone<span style=color:#666>);</span>
          <span style=color:green;font-weight:700>return</span> R<span style=color:#666>.</span><span style=color:#7d9029>success</span><span style=color:#666>(</span>user<span style=color:#666>);</span>
        <span style=color:#666>}</span>
       <span style=color:green;font-weight:700>return</span> R<span style=color:#666>.</span><span style=color:#7d9029>error</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;登录失败&#34;</span><span style=color:#666>);</span>

    <span style=color:#666>}</span>
    


<span style=color:#666>}</span>
</code></pre></div><h2 id=8后台登录和退出员工的新增和修改禁用启用>8.后台登录和退出，员工的新增和修改(禁用启用)<a href=#8后台登录和退出员工的新增和修改禁用启用 class=header-anchor arialabel=Anchor> #</a></h2><h4 id=1employeecontroller>1.employeecontroller<a href=#1employeecontroller class=header-anchor arialabel=Anchor> #</a></h4><div class=highlight><pre style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#a2f>@Slf4j</span>
<span style=color:#a2f>@RestController</span>
<span style=color:#a2f>@RequestMapping</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;/employee&#34;</span><span style=color:#666>)</span>
<span style=color:green;font-weight:700>public</span> <span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>EmyloyeeController</span> <span style=color:#666>{</span>
    <span style=color:#a2f>@Autowired</span>
    <span style=color:green;font-weight:700>private</span> EmployeeService employeeService<span style=color:#666>;</span>
    <span style=color:#408080;font-style:italic>/**
</span><span style=color:#408080;font-style:italic>     * 员工登录
</span><span style=color:#408080;font-style:italic>     * @param request
</span><span style=color:#408080;font-style:italic>     * @param employee
</span><span style=color:#408080;font-style:italic>     */</span>
    <span style=color:#a2f>@PostMapping</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;/login&#34;</span><span style=color:#666>)</span>
    <span style=color:green;font-weight:700>public</span> R<span style=color:#666>&lt;</span>Employee<span style=color:#666>&gt;</span> <span style=color:#00f>login</span><span style=color:#666>(</span>HttpServletRequest request<span style=color:#666>,</span> <span style=color:#a2f>@RequestBody</span> Employee employee<span style=color:#666>){</span>
        <span style=color:green;font-weight:700>return</span> employeeService<span style=color:#666>.</span><span style=color:#7d9029>login</span><span style=color:#666>(</span>request<span style=color:#666>,</span>employee<span style=color:#666>);</span>
    <span style=color:#666>}</span>

    <span style=color:#408080;font-style:italic>/**
</span><span style=color:#408080;font-style:italic>     * 员工退出
</span><span style=color:#408080;font-style:italic>     * @param request
</span><span style=color:#408080;font-style:italic>     * @return
</span><span style=color:#408080;font-style:italic>     */</span>
    <span style=color:#a2f>@PostMapping</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;/logout&#34;</span><span style=color:#666>)</span>
    <span style=color:green;font-weight:700>public</span> R<span style=color:#666>&lt;</span>String<span style=color:#666>&gt;</span> <span style=color:#00f>logout</span><span style=color:#666>(</span>HttpServletRequest request<span style=color:#666>){</span>
        <span style=color:#408080;font-style:italic>//②清理session中的用户id
</span><span style=color:#408080;font-style:italic></span>          request<span style=color:#666>.</span><span style=color:#7d9029>getSession</span><span style=color:#666>().</span><span style=color:#7d9029>removeAttribute</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;employee&#34;</span><span style=color:#666>);</span>
        <span style=color:#408080;font-style:italic>//③返回结果（前端页面会进行跳转到登录页面）
</span><span style=color:#408080;font-style:italic></span>        <span style=color:green;font-weight:700>return</span> R<span style=color:#666>.</span><span style=color:#7d9029>success</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;退出成功&#34;</span><span style=color:#666>);</span>
    <span style=color:#666>}</span>

    <span style=color:#408080;font-style:italic>/**
</span><span style=color:#408080;font-style:italic>     * 新增员工
</span><span style=color:#408080;font-style:italic>     * @param employee
</span><span style=color:#408080;font-style:italic>     * @return
</span><span style=color:#408080;font-style:italic>     */</span>
    <span style=color:#a2f>@PostMapping</span>
    <span style=color:green;font-weight:700>public</span> R<span style=color:#666>&lt;</span>String<span style=color:#666>&gt;</span> <span style=color:#00f>save</span><span style=color:#666>(</span>HttpServletRequest request<span style=color:#666>,</span><span style=color:#a2f>@RequestBody</span> Employee employee<span style=color:#666>){</span><span style=color:#408080;font-style:italic>//返回json格式用@RequestBodyLog
</span><span style=color:#408080;font-style:italic></span>      <span style=color:green;font-weight:700>return</span> employeeService<span style=color:#666>.</span><span style=color:#7d9029>saveemployee</span><span style=color:#666>(</span>request<span style=color:#666>,</span>employee<span style=color:#666>);</span>

    <span style=color:#666>}</span>
    <span style=color:#408080;font-style:italic>//返回需要recods和total所以可以用myp提供的page
</span><span style=color:#408080;font-style:italic></span>
    <span style=color:#408080;font-style:italic>/**
</span><span style=color:#408080;font-style:italic>     * 员工信息的分页查询
</span><span style=color:#408080;font-style:italic>     * @param page
</span><span style=color:#408080;font-style:italic>     * @param pageSize
</span><span style=color:#408080;font-style:italic>     * @param name
</span><span style=color:#408080;font-style:italic>     * @return
</span><span style=color:#408080;font-style:italic>     */</span>
    <span style=color:#a2f>@GetMapping</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;/page&#34;</span><span style=color:#666>)</span>
    <span style=color:green;font-weight:700>public</span> R<span style=color:#666>&lt;</span>Page<span style=color:#666>&gt;</span>  <span style=color:#00f>page</span><span style=color:#666>(</span><span style=color:#b00040>int</span> page<span style=color:#666>,</span><span style=color:#b00040>int</span> pageSize<span style=color:#666>,</span> String name<span style=color:#666>){</span>
        <span style=color:green;font-weight:700>return</span> employeeService<span style=color:#666>.</span><span style=color:#7d9029>pageemployees</span><span style=color:#666>(</span>page<span style=color:#666>,</span>pageSize<span style=color:#666>,</span>name<span style=color:#666>);</span>
    <span style=color:#666>}</span>

    <span style=color:#408080;font-style:italic>/**
</span><span style=color:#408080;font-style:italic>     * 根据id修改员工信息
</span><span style=color:#408080;font-style:italic>     * @param employee
</span><span style=color:#408080;font-style:italic>     * @return
</span><span style=color:#408080;font-style:italic>     */</span>
    <span style=color:#a2f>@PutMapping</span>
    <span style=color:green;font-weight:700>public</span> R<span style=color:#666>&lt;</span>String<span style=color:#666>&gt;</span> <span style=color:#00f>update</span><span style=color:#666>(</span>HttpServletRequest request<span style=color:#666>,</span>
                            <span style=color:#a2f>@RequestBody</span> Employee employee<span style=color:#666>){</span>
        <span style=color:#408080;font-style:italic>//传过来的数据格式是json所以用requestbody反序列化
</span><span style=color:#408080;font-style:italic></span>     <span style=color:green;font-weight:700>return</span> employeeService<span style=color:#666>.</span><span style=color:#7d9029>updateemployee</span><span style=color:#666>(</span>request<span style=color:#666>,</span>employee<span style=color:#666>);</span>
    <span style=color:#666>}</span>

    <span style=color:#408080;font-style:italic>/**
</span><span style=color:#408080;font-style:italic>     * 根据id查询信息
</span><span style=color:#408080;font-style:italic>     * @param id
</span><span style=color:#408080;font-style:italic>     * @return
</span><span style=color:#408080;font-style:italic>     */</span>
    <span style=color:#a2f>@GetMapping</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;/{id}&#34;</span><span style=color:#666>)</span>
    <span style=color:green;font-weight:700>public</span> R<span style=color:#666>&lt;</span>Employee<span style=color:#666>&gt;</span> <span style=color:#00f>getById</span><span style=color:#666>(</span><span style=color:#a2f>@PathVariable</span> Long id<span style=color:#666>){</span>
        log<span style=color:#666>.</span><span style=color:#7d9029>info</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;根据id查询信息&#34;</span><span style=color:#666>);</span>
        Employee employee <span style=color:#666>=</span> employeeService<span style=color:#666>.</span><span style=color:#7d9029>getById</span><span style=color:#666>(</span>id<span style=color:#666>);</span>
        <span style=color:green;font-weight:700>if</span> <span style=color:#666>(</span>employee<span style=color:#666>!=</span><span style=color:green;font-weight:700>null</span><span style=color:#666>){</span>
            <span style=color:green;font-weight:700>return</span> R<span style=color:#666>.</span><span style=color:#7d9029>success</span><span style=color:#666>(</span>employee<span style=color:#666>);</span>
        <span style=color:#666>}</span>
        <span style=color:green;font-weight:700>return</span> R<span style=color:#666>.</span><span style=color:#7d9029>error</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;没有对应的员工信息&#34;</span><span style=color:#666>);</span>
    <span style=color:#666>}</span>
    
<span style=color:#666>}</span>

</code></pre></div><h4 id=2代码实现>2.代码实现<a href=#2代码实现 class=header-anchor arialabel=Anchor> #</a></h4><div class=highlight><pre style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>
<span style=color:#a2f>@Service</span>
<span style=color:green;font-weight:700>public</span> <span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>EmployeeServiceImp</span> <span style=color:green;font-weight:700>extends</span>
        ServiceImpl<span style=color:#666>&lt;</span>EmployeeMapper<span style=color:#666>,</span> Employee<span style=color:#666>&gt;</span>
        <span style=color:green;font-weight:700>implements</span> EmployeeService <span style=color:#666>{</span>

    <span style=color:#a2f>@Override</span>
    <span style=color:green;font-weight:700>public</span> R<span style=color:#666>&lt;</span>Employee<span style=color:#666>&gt;</span> <span style=color:#00f>login</span><span style=color:#666>(</span>HttpServletRequest request<span style=color:#666>,</span> Employee employee<span style=color:#666>)</span> <span style=color:#666>{</span>
        <span style=color:#408080;font-style:italic>/**
</span><span style=color:#408080;font-style:italic>         * 1、将页面提交的密码password进行md5加密处理
</span><span style=color:#408080;font-style:italic>         * 2、根据页面提交的用户名username查询数据库
</span><span style=color:#408080;font-style:italic>         * 3、如果没有查询到则返回登录失败结果
</span><span style=color:#408080;font-style:italic>         * 4、密码比对，如果不一致则返回登录失败结果
</span><span style=color:#408080;font-style:italic>         * 5、查看员工状态，如果为已禁用状态，则返回员工已禁用结果
</span><span style=color:#408080;font-style:italic>         * 6、登录成功，将员工id存入Session并返回登录成功结果
</span><span style=color:#408080;font-style:italic>         */</span>
<span style=color:#408080;font-style:italic>//         * 1、将页面提交的密码password进行md5加密处理
</span><span style=color:#408080;font-style:italic></span>        String password <span style=color:#666>=</span> employee<span style=color:#666>.</span><span style=color:#7d9029>getPassword</span><span style=color:#666>();</span>
        password <span style=color:#666>=</span> DigestUtils<span style=color:#666>.</span><span style=color:#7d9029>md5DigestAsHex</span><span style=color:#666>(</span>password<span style=color:#666>.</span><span style=color:#7d9029>getBytes</span><span style=color:#666>());</span>
<span style=color:#408080;font-style:italic>//         * 2、根据页面提交的用户名username查询数据库
</span><span style=color:#408080;font-style:italic></span>        LambdaQueryWrapper<span style=color:#666>&lt;</span>Employee<span style=color:#666>&gt;</span> queryWrapper <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> LambdaQueryWrapper<span style=color:#666>&lt;&gt;();</span>
        queryWrapper<span style=color:#666>.</span><span style=color:#7d9029>eq</span><span style=color:#666>(</span>Employee<span style=color:#666>::</span>getUsername<span style=color:#666>,</span>employee<span style=color:#666>.</span><span style=color:#7d9029>getUsername</span><span style=color:#666>());</span>
        Employee emp <span style=color:#666>=</span> <span style=color:green;font-weight:700>this</span><span style=color:#666>.</span><span style=color:#7d9029>getOne</span><span style=color:#666>(</span>queryWrapper<span style=color:#666>);</span>
        <span style=color:#408080;font-style:italic>//之前表里对UserName作为unique约束
</span><span style=color:#408080;font-style:italic>//         * 3、如果没有查询到则返回登录失败结果
</span><span style=color:#408080;font-style:italic></span>        <span style=color:green;font-weight:700>if</span> <span style=color:#666>(</span>emp<span style=color:#666>==</span><span style=color:green;font-weight:700>null</span><span style=color:#666>){</span>
            <span style=color:green;font-weight:700>return</span>  R<span style=color:#666>.</span><span style=color:#7d9029>error</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;登录失败&#34;</span><span style=color:#666>);</span>
        <span style=color:#666>}</span>
<span style=color:#408080;font-style:italic>//         * 4、密码比对，如果不一致则返回登录失败结果
</span><span style=color:#408080;font-style:italic></span>        <span style=color:green;font-weight:700>if</span> <span style=color:#666>(!</span>emp<span style=color:#666>.</span><span style=color:#7d9029>getPassword</span><span style=color:#666>().</span><span style=color:#7d9029>equals</span><span style=color:#666>(</span>password<span style=color:#666>)){</span>
            <span style=color:green;font-weight:700>return</span>  R<span style=color:#666>.</span><span style=color:#7d9029>error</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;登录失败&#34;</span><span style=color:#666>);</span>
        <span style=color:#666>}</span>
<span style=color:#408080;font-style:italic>//         * 5、查看员工状态，如果为已禁用状态，则返回员工已禁用结果
</span><span style=color:#408080;font-style:italic></span>        <span style=color:green;font-weight:700>if</span> <span style=color:#666>(</span>emp<span style=color:#666>.</span><span style=color:#7d9029>getStatus</span><span style=color:#666>()==</span>0<span style=color:#666>){</span>
            <span style=color:green;font-weight:700>return</span>  R<span style=color:#666>.</span><span style=color:#7d9029>error</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;账号已经禁用&#34;</span><span style=color:#666>);</span>
        <span style=color:#666>}</span>
<span style=color:#408080;font-style:italic>//        * 6、登录成功，将员工id存入Session并返回登录成功结果
</span><span style=color:#408080;font-style:italic></span>        request<span style=color:#666>.</span><span style=color:#7d9029>getSession</span><span style=color:#666>().</span><span style=color:#7d9029>setAttribute</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;employee&#34;</span><span style=color:#666>,</span>emp<span style=color:#666>.</span><span style=color:#7d9029>getId</span><span style=color:#666>());</span>
        <span style=color:green;font-weight:700>return</span> R<span style=color:#666>.</span><span style=color:#7d9029>success</span><span style=color:#666>(</span>emp<span style=color:#666>);</span>

    <span style=color:#666>}</span>

    <span style=color:#a2f>@Override</span>
    <span style=color:green;font-weight:700>public</span> R<span style=color:#666>&lt;</span>String<span style=color:#666>&gt;</span> <span style=color:#00f>saveemployee</span><span style=color:#666>(</span>HttpServletRequest request<span style=color:#666>,</span> Employee employee<span style=color:#666>)</span> <span style=color:#666>{</span>
        <span style=color:#408080;font-style:italic>//设置一个初始密码md5加密
</span><span style=color:#408080;font-style:italic></span>
        employee<span style=color:#666>.</span><span style=color:#7d9029>setPassword</span><span style=color:#666>(</span>DigestUtils<span style=color:#666>.</span><span style=color:#7d9029>md5DigestAsHex</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;123456&#34;</span><span style=color:#666>.</span><span style=color:#7d9029>getBytes</span><span style=color:#666>()));</span>
        employee<span style=color:#666>.</span><span style=color:#7d9029>setCreateTime</span><span style=color:#666>(</span>LocalDateTime<span style=color:#666>.</span><span style=color:#7d9029>now</span><span style=color:#666>());</span>
        employee<span style=color:#666>.</span><span style=color:#7d9029>setUpdateTime</span><span style=color:#666>(</span>LocalDateTime<span style=color:#666>.</span><span style=color:#7d9029>now</span><span style=color:#666>());</span>
        <span style=color:#408080;font-style:italic>//获得当前登录用户的id
</span><span style=color:#408080;font-style:italic></span>        Long empId <span style=color:#666>=</span> <span style=color:#666>(</span>Long<span style=color:#666>)</span> request<span style=color:#666>.</span><span style=color:#7d9029>getSession</span><span style=color:#666>().</span><span style=color:#7d9029>getAttribute</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;employee&#34;</span><span style=color:#666>);</span>
        employee<span style=color:#666>.</span><span style=color:#7d9029>setCreateUser</span><span style=color:#666>(</span>empId<span style=color:#666>);</span>
        employee<span style=color:#666>.</span><span style=color:#7d9029>setUpdateUser</span><span style=color:#666>(</span>empId<span style=color:#666>);</span>

       <span style=color:green;font-weight:700>this</span><span style=color:#666>.</span><span style=color:#7d9029>save</span><span style=color:#666>(</span>employee<span style=color:#666>);</span>

        <span style=color:green;font-weight:700>return</span> R<span style=color:#666>.</span><span style=color:#7d9029>success</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;新增员工成功&#34;</span><span style=color:#666>);</span>
    <span style=color:#666>}</span>

    <span style=color:#a2f>@Override</span>
    <span style=color:green;font-weight:700>public</span> R<span style=color:#666>&lt;</span>Page<span style=color:#666>&gt;</span> <span style=color:#00f>pageemployees</span><span style=color:#666>(</span><span style=color:#b00040>int</span> page<span style=color:#666>,</span> <span style=color:#b00040>int</span> pageSize<span style=color:#666>,</span> String name<span style=color:#666>)</span> <span style=color:#666>{</span>

        <span style=color:#408080;font-style:italic>//1.创造分页构造器
</span><span style=color:#408080;font-style:italic></span>        Page pageInfo <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> Page<span style=color:#666>(</span>page<span style=color:#666>,</span> pageSize<span style=color:#666>);</span>
        <span style=color:#408080;font-style:italic>//2.创造条件构造器
</span><span style=color:#408080;font-style:italic></span>        LambdaQueryWrapper<span style=color:#666>&lt;</span>Employee<span style=color:#666>&gt;</span> qeryWrapper <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> LambdaQueryWrapper<span style=color:#666>();</span>
        <span style=color:#408080;font-style:italic>//添加一个条件查询
</span><span style=color:#408080;font-style:italic></span>        qeryWrapper<span style=color:#666>.</span><span style=color:#7d9029>like</span><span style=color:#666>(</span>StringUtils<span style=color:#666>.</span><span style=color:#7d9029>hasText</span><span style=color:#666>(</span>name<span style=color:#666>),</span>Employee<span style=color:#666>::</span>getName<span style=color:#666>,</span>name<span style=color:#666>);</span>
        <span style=color:#408080;font-style:italic>//添加排序条件
</span><span style=color:#408080;font-style:italic></span>        qeryWrapper<span style=color:#666>.</span><span style=color:#7d9029>orderByDesc</span><span style=color:#666>(</span>Employee<span style=color:#666>::</span>getCreateTime<span style=color:#666>);</span>
        <span style=color:#408080;font-style:italic>//3.执行查询
</span><span style=color:#408080;font-style:italic></span>        <span style=color:green;font-weight:700>this</span><span style=color:#666>.</span><span style=color:#7d9029>page</span><span style=color:#666>(</span>pageInfo<span style=color:#666>,</span>qeryWrapper<span style=color:#666>);</span>

        <span style=color:green;font-weight:700>return</span> R<span style=color:#666>.</span><span style=color:#7d9029>success</span><span style=color:#666>(</span>pageInfo<span style=color:#666>);</span>
    <span style=color:#666>}</span>

    <span style=color:#a2f>@Override</span>
    <span style=color:green;font-weight:700>public</span> R<span style=color:#666>&lt;</span>String<span style=color:#666>&gt;</span> <span style=color:#00f>updateemployee</span><span style=color:#666>(</span>HttpServletRequest request<span style=color:#666>,</span> Employee employee<span style=color:#666>)</span> <span style=color:#666>{</span>
        Long empId <span style=color:#666>=</span> <span style=color:#666>(</span>Long<span style=color:#666>)</span>request<span style=color:#666>.</span><span style=color:#7d9029>getSession</span><span style=color:#666>().</span><span style=color:#7d9029>getAttribute</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;employee&#34;</span><span style=color:#666>);</span>
        <span style=color:#408080;font-style:italic>//注意empid是自己登录的账号
</span><span style=color:#408080;font-style:italic></span>        employee<span style=color:#666>.</span><span style=color:#7d9029>setCreateTime</span><span style=color:#666>(</span>LocalDateTime<span style=color:#666>.</span><span style=color:#7d9029>now</span><span style=color:#666>());</span>
        employee<span style=color:#666>.</span><span style=color:#7d9029>setUpdateUser</span><span style=color:#666>(</span>empId<span style=color:#666>);</span>
        <span style=color:green;font-weight:700>this</span><span style=color:#666>.</span><span style=color:#7d9029>updateById</span><span style=color:#666>(</span>employee<span style=color:#666>);</span>
        <span style=color:green;font-weight:700>return</span> R<span style=color:#666>.</span><span style=color:#7d9029>success</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;员工信息修改成功&#34;</span><span style=color:#666>);</span>
    <span style=color:#666>}</span>
<span style=color:#666>}</span>
</code></pre></div><h4 id=3配置消息转换器>3.配置消息转换器<a href=#3配置消息转换器 class=header-anchor arialabel=Anchor> #</a></h4><div class=highlight><pre style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>更新失败，仔细观察id后，我们会发现后台的SQL语句使用的id和数据库中的id是不一样的！
原因是：mybatis-plus对id使用了雪花算法，所以存入数据库中的id是19为长度，但是前端的js只能保证数据的前16位的数据的精度，对我们id后面三位数据进行了四舍五入，所以就出现了精度丢失；就会出现前度传过来的id和数据里面的id不匹配，就没办法正确的修改到我们想要的数据；
当然另一种解决bug的方法是:关闭mybatis-plus的雪花算法来处理ID，我们使用自增ID的策略来往数据库添加id就行；
使用自定义消息转换器
代码bug修复：
思路：既然js对long型的数据会进行精度丢失，那么我们就对数据进行转型，我们可以在服务端（Java端）给页面响应json格式的数据时进行处理，将long型的数据统一转换为string字符串；

#即为前面配置的4.4.1对象转换器
#以及加入配置中的4.4.3静态资源映射
</code></pre></div><h2 id=9菜品分类管理新增删除修改>9.菜品分类管理（新增删除修改）<a href=#9菜品分类管理新增删除修改 class=header-anchor arialabel=Anchor> #</a></h2><h4 id=1catecategorycontroller>1.cateCategoryController<a href=#1catecategorycontroller class=header-anchor arialabel=Anchor> #</a></h4><div class=highlight><pre style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#408080;font-style:italic>/**
</span><span style=color:#408080;font-style:italic> * 分类管理
</span><span style=color:#408080;font-style:italic> */</span>
<span style=color:#a2f>@RestController</span>
<span style=color:#a2f>@RequestMapping</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;/category&#34;</span><span style=color:#666>)</span>
<span style=color:#a2f>@Slf4j</span>
<span style=color:green;font-weight:700>public</span> <span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>CategoryController</span> <span style=color:#666>{</span>
    <span style=color:#a2f>@Autowired</span>
    <span style=color:green;font-weight:700>private</span> CategoryService categoryService<span style=color:#666>;</span>

    <span style=color:#408080;font-style:italic>/**
</span><span style=color:#408080;font-style:italic>     * 新增分类
</span><span style=color:#408080;font-style:italic>     * @param category
</span><span style=color:#408080;font-style:italic>     * @return
</span><span style=color:#408080;font-style:italic>     */</span>
    <span style=color:#a2f>@PostMapping</span>
    <span style=color:green;font-weight:700>public</span> R<span style=color:#666>&lt;</span>String<span style=color:#666>&gt;</span> <span style=color:#00f>save</span><span style=color:#666>(</span><span style=color:#a2f>@RequestBody</span> Category category<span style=color:#666>){</span>
        log<span style=color:#666>.</span><span style=color:#7d9029>info</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;category:{}&#34;</span><span style=color:#666>,</span>category<span style=color:#666>);</span>
        categoryService<span style=color:#666>.</span><span style=color:#7d9029>save</span><span style=color:#666>(</span>category<span style=color:#666>);</span>
        <span style=color:green;font-weight:700>return</span> R<span style=color:#666>.</span><span style=color:#7d9029>success</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;新增分类成功&#34;</span><span style=color:#666>);</span>
    <span style=color:#666>}</span>

    <span style=color:#408080;font-style:italic>/**
</span><span style=color:#408080;font-style:italic>     * 分页查询
</span><span style=color:#408080;font-style:italic>     * @param page
</span><span style=color:#408080;font-style:italic>     * @param pageSize
</span><span style=color:#408080;font-style:italic>     * @return
</span><span style=color:#408080;font-style:italic>     */</span>
    <span style=color:#a2f>@GetMapping</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;/page&#34;</span><span style=color:#666>)</span>
    <span style=color:green;font-weight:700>public</span> R<span style=color:#666>&lt;</span>Page<span style=color:#666>&gt;</span> <span style=color:#00f>page</span><span style=color:#666>(</span><span style=color:#b00040>int</span> page<span style=color:#666>,</span><span style=color:#b00040>int</span> pageSize<span style=color:#666>){</span>
        <span style=color:#408080;font-style:italic>//分页构造器
</span><span style=color:#408080;font-style:italic></span>        Page<span style=color:#666>&lt;</span>Category<span style=color:#666>&gt;</span> pageInfo <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> Page<span style=color:#666>&lt;&gt;(</span>page<span style=color:#666>,</span>pageSize<span style=color:#666>);</span>
        <span style=color:#408080;font-style:italic>//条件构造器
</span><span style=color:#408080;font-style:italic></span>        LambdaQueryWrapper<span style=color:#666>&lt;</span>Category<span style=color:#666>&gt;</span> queryWrapper <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> LambdaQueryWrapper<span style=color:#666>&lt;&gt;();</span>
        <span style=color:#408080;font-style:italic>//添加排序条件，根据sort进行排序
</span><span style=color:#408080;font-style:italic></span>        queryWrapper<span style=color:#666>.</span><span style=color:#7d9029>orderByAsc</span><span style=color:#666>(</span>Category<span style=color:#666>::</span>getSort<span style=color:#666>);</span>

        <span style=color:#408080;font-style:italic>//分页查询
</span><span style=color:#408080;font-style:italic></span>        categoryService<span style=color:#666>.</span><span style=color:#7d9029>page</span><span style=color:#666>(</span>pageInfo<span style=color:#666>,</span>queryWrapper<span style=color:#666>);</span>
        <span style=color:green;font-weight:700>return</span> R<span style=color:#666>.</span><span style=color:#7d9029>success</span><span style=color:#666>(</span>pageInfo<span style=color:#666>);</span>
    <span style=color:#666>}</span>

    <span style=color:#408080;font-style:italic>/**
</span><span style=color:#408080;font-style:italic>     * 根据id删除分类
</span><span style=color:#408080;font-style:italic>     * @param id
</span><span style=color:#408080;font-style:italic>     * @return
</span><span style=color:#408080;font-style:italic>     */</span>
    <span style=color:#a2f>@DeleteMapping</span>
    <span style=color:green;font-weight:700>public</span> R<span style=color:#666>&lt;</span>String<span style=color:#666>&gt;</span> <span style=color:#00f>delete</span><span style=color:#666>(</span>Long id<span style=color:#666>){</span>
        log<span style=color:#666>.</span><span style=color:#7d9029>info</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;删除分类，id为：{}&#34;</span><span style=color:#666>,</span>id<span style=color:#666>);</span>

<span style=color:#408080;font-style:italic>//        categoryService.removeById(id);
</span><span style=color:#408080;font-style:italic></span>        categoryService<span style=color:#666>.</span><span style=color:#7d9029>remove</span><span style=color:#666>(</span>id<span style=color:#666>);</span>

        <span style=color:green;font-weight:700>return</span> R<span style=color:#666>.</span><span style=color:#7d9029>success</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;分类信息删除成功&#34;</span><span style=color:#666>);</span>
    <span style=color:#666>}</span>

    <span style=color:#408080;font-style:italic>/**
</span><span style=color:#408080;font-style:italic>     * 根据id修改分类信息
</span><span style=color:#408080;font-style:italic>     * @param category
</span><span style=color:#408080;font-style:italic>     * @return
</span><span style=color:#408080;font-style:italic>     */</span>
    <span style=color:#a2f>@PutMapping</span>
    <span style=color:green;font-weight:700>public</span> R<span style=color:#666>&lt;</span>String<span style=color:#666>&gt;</span> <span style=color:#00f>update</span><span style=color:#666>(</span><span style=color:#a2f>@RequestBody</span> Category category<span style=color:#666>){</span>
        log<span style=color:#666>.</span><span style=color:#7d9029>info</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;修改分类信息：{}&#34;</span><span style=color:#666>,</span>category<span style=color:#666>);</span>

        categoryService<span style=color:#666>.</span><span style=color:#7d9029>updateById</span><span style=color:#666>(</span>category<span style=color:#666>);</span>

        <span style=color:green;font-weight:700>return</span> R<span style=color:#666>.</span><span style=color:#7d9029>success</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;修改分类信息成功&#34;</span><span style=color:#666>);</span>
    <span style=color:#666>}</span>

    <span style=color:#408080;font-style:italic>/**
</span><span style=color:#408080;font-style:italic>     * 根据条件查询分类数据
</span><span style=color:#408080;font-style:italic>     * @param category
</span><span style=color:#408080;font-style:italic>     * @return
</span><span style=color:#408080;font-style:italic>     */</span>
    <span style=color:#a2f>@GetMapping</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;/list&#34;</span><span style=color:#666>)</span>
    <span style=color:green;font-weight:700>public</span> R<span style=color:#666>&lt;</span>List<span style=color:#666>&lt;</span>Category<span style=color:#666>&gt;&gt;</span> <span style=color:#00f>list</span><span style=color:#666>(</span>Category category<span style=color:#666>){</span>
        <span style=color:#408080;font-style:italic>//1条件构造器
</span><span style=color:#408080;font-style:italic></span>        LambdaQueryWrapper<span style=color:#666>&lt;</span>Category<span style=color:#666>&gt;</span> categoryLambdaQueryWrapper <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> LambdaQueryWrapper<span style=color:#666>&lt;&gt;();</span>
        <span style=color:#408080;font-style:italic>//2.添加条件
</span><span style=color:#408080;font-style:italic></span>        categoryLambdaQueryWrapper<span style=color:#666>.</span><span style=color:#7d9029>eq</span><span style=color:#666>(</span>category<span style=color:#666>.</span><span style=color:#7d9029>getType</span><span style=color:#666>()</span> <span style=color:#666>!=</span><span style=color:green;font-weight:700>null</span>
                <span style=color:#666>,</span>Category<span style=color:#666>::</span>getType<span style=color:#666>,</span>category<span style=color:#666>.</span><span style=color:#7d9029>getType</span><span style=color:#666>());</span>
        <span style=color:#408080;font-style:italic>//3.可以做一些排序条件
</span><span style=color:#408080;font-style:italic></span>        categoryLambdaQueryWrapper<span style=color:#666>.</span><span style=color:#7d9029>orderByAsc</span><span style=color:#666>(</span>Category<span style=color:#666>::</span>getSort<span style=color:#666>).</span>
                orderByDesc<span style=color:#666>(</span>Category<span style=color:#666>::</span>getCreateTime<span style=color:#666>);</span>
        List<span style=color:#666>&lt;</span>Category<span style=color:#666>&gt;</span> list <span style=color:#666>=</span> categoryService<span style=color:#666>.</span><span style=color:#7d9029>list</span><span style=color:#666>(</span>categoryLambdaQueryWrapper<span style=color:#666>);</span>

        <span style=color:green;font-weight:700>return</span> R<span style=color:#666>.</span><span style=color:#7d9029>success</span><span style=color:#666>(</span>list<span style=color:#666>);</span>
    <span style=color:#666>}</span>
<span style=color:#666>}</span>

</code></pre></div><h4 id=2删除套餐的思路涉及两张表>2.删除套餐的思路(涉及两张表)<a href=#2删除套餐的思路涉及两张表 class=header-anchor arialabel=Anchor> #</a></h4><blockquote><p>删除套餐还包括菜品表，所有还要查询关联的菜品，存在不能删除</p></blockquote><h4 id=3代码实现>3.代码实现<a href=#3代码实现 class=header-anchor arialabel=Anchor> #</a></h4><div class=highlight><pre style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#a2f>@Service</span>
<span style=color:green;font-weight:700>public</span> <span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>CategoryServiceImpl</span> <span style=color:green;font-weight:700>extends</span> ServiceImpl<span style=color:#666>&lt;</span>CategoryMapper<span style=color:#666>,</span>Category<span style=color:#666>&gt;</span>
        <span style=color:green;font-weight:700>implements</span> CategoryService <span style=color:#666>{</span>
    <span style=color:#408080;font-style:italic>//先注入菜品和套餐的service
</span><span style=color:#408080;font-style:italic></span>    <span style=color:#a2f>@Autowired</span>
    DishService dishService<span style=color:#666>;</span>
    <span style=color:#a2f>@Autowired</span>
    SetmealService setmealService<span style=color:#666>;</span>
    <span style=color:#a2f>@Override</span>
    <span style=color:green;font-weight:700>public</span> <span style=color:#b00040>void</span> <span style=color:#00f>remove</span><span style=color:#666>(</span>Long id<span style=color:#666>)</span> <span style=color:#666>{</span>
        <span style=color:#408080;font-style:italic>//查询当前分类是否关联了菜品，如果已经关联，抛出一个业务异常
</span><span style=color:#408080;font-style:italic></span>        <span style=color:#408080;font-style:italic>//然后去除
</span><span style=color:#408080;font-style:italic></span>        <span style=color:#408080;font-style:italic>//1.构造查询器
</span><span style=color:#408080;font-style:italic></span>        LambdaQueryWrapper<span style=color:#666>&lt;</span>Dish<span style=color:#666>&gt;</span> dishLambdaQueryWrapper <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> LambdaQueryWrapper<span style=color:#666>&lt;&gt;();</span>
        <span style=color:#408080;font-style:italic>//2.添加查询条件，根据条件
</span><span style=color:#408080;font-style:italic></span>        dishLambdaQueryWrapper<span style=color:#666>.</span><span style=color:#7d9029>eq</span><span style=color:#666>(</span>Dish<span style=color:#666>::</span>getCategoryId<span style=color:#666>,</span>id<span style=color:#666>);</span>
        <span style=color:#b00040>int</span> count1 <span style=color:#666>=</span> dishService<span style=color:#666>.</span><span style=color:#7d9029>count</span><span style=color:#666>(</span>dishLambdaQueryWrapper<span style=color:#666>);</span>
        <span style=color:green;font-weight:700>if</span><span style=color:#666>(</span>count1 <span style=color:#666>&gt;</span> 0<span style=color:#666>){</span>
            <span style=color:#408080;font-style:italic>//已经关联菜品，抛出一个业务异常
</span><span style=color:#408080;font-style:italic></span>            <span style=color:green;font-weight:700>throw</span> <span style=color:green;font-weight:700>new</span> CustomException<span style=color:#666>(</span><span style=color:#ba2121>&#34;当前分类下关联了菜品，不能删除&#34;</span><span style=color:#666>);</span>
        <span style=color:#666>}</span>
        <span style=color:#408080;font-style:italic>//1.构造查询器
</span><span style=color:#408080;font-style:italic></span>        LambdaQueryWrapper<span style=color:#666>&lt;</span>Setmeal<span style=color:#666>&gt;</span> setmealLambdaQueryWrapper <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> LambdaQueryWrapper<span style=color:#666>&lt;&gt;();</span>
        <span style=color:#408080;font-style:italic>//2.添加查询条件，根据条件
</span><span style=color:#408080;font-style:italic></span>        setmealLambdaQueryWrapper<span style=color:#666>.</span><span style=color:#7d9029>eq</span><span style=color:#666>(</span>Setmeal<span style=color:#666>::</span>getCategoryId<span style=color:#666>,</span>id<span style=color:#666>);</span>
        <span style=color:#b00040>int</span> count2 <span style=color:#666>=</span>setmealService<span style=color:#666>.</span><span style=color:#7d9029>count</span><span style=color:#666>(</span>setmealLambdaQueryWrapper<span style=color:#666>);</span>
        <span style=color:green;font-weight:700>if</span><span style=color:#666>(</span>count2 <span style=color:#666>&gt;</span> 0<span style=color:#666>){</span>
            <span style=color:#408080;font-style:italic>//已经关联套餐，抛出一个业务异常
</span><span style=color:#408080;font-style:italic></span>            <span style=color:green;font-weight:700>throw</span> <span style=color:green;font-weight:700>new</span> CustomException<span style=color:#666>(</span><span style=color:#ba2121>&#34;当前分类下关联了套餐，不能删除&#34;</span><span style=color:#666>);</span>
        <span style=color:#666>}</span>
        <span style=color:green;font-weight:700>super</span><span style=color:#666>.</span><span style=color:#7d9029>removeById</span><span style=color:#666>(</span>id<span style=color:#666>);</span>
    <span style=color:#666>}</span>
<span style=color:#666>}</span>

</code></pre></div><h2 id=10菜品管理redis缓存事务>10.菜品管理（redis缓存+事务）<a href=#10菜品管理redis缓存事务 class=header-anchor arialabel=Anchor> #</a></h2><h4 id=1文件的上传和下载>1.文件的上传和下载<a href=#1文件的上传和下载 class=header-anchor arialabel=Anchor> #</a></h4><h5 id=11配置applicationxml>1.1配置application.xml<a href=#11配置applicationxml class=header-anchor arialabel=Anchor> #</a></h5><div class=highlight><pre style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span>#</span>设置一个外部配置源<span>，</span>输出的地址
<span style=color:#a0a000>reggie:</span>
   path<span style=color:#666>:</span> <span style=color:#666>/</span>usr<span style=color:#666>/</span>local<span style=color:#666>/</span>img<span style=color:#666>/</span>
       
<span>#</span>还可以在yml设置上传信息
  spring<span style=color:#666>:</span>
  servlet<span style=color:#666>:</span>
    multipart<span style=color:#666>:</span>
      max<span style=color:#666>-</span>file<span style=color:#666>-</span>size<span style=color:#666>:</span> 10MB
      max<span style=color:#666>-</span>request<span style=color:#666>-</span>size<span style=color:#666>:</span> 100MB
</code></pre></div><h5 id=12代码>1.2代码<a href=#12代码 class=header-anchor arialabel=Anchor> #</a></h5><div class=highlight><pre style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>
<span style=color:#408080;font-style:italic>/**
</span><span style=color:#408080;font-style:italic> * 文件上传和下载
</span><span style=color:#408080;font-style:italic> */</span>
<span style=color:#a2f>@RestController</span>
<span style=color:#a2f>@RequestMapping</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;/common&#34;</span><span style=color:#666>)</span>
<span style=color:#a2f>@Slf4j</span>
<span style=color:green;font-weight:700>public</span> <span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>CommonController</span> <span style=color:#666>{</span>

    <span style=color:#a2f>@Value</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;${reggie.path}&#34;</span><span style=color:#666>)</span>
    <span style=color:green;font-weight:700>private</span> String basePath<span style=color:#666>;</span>

    <span style=color:#408080;font-style:italic>/**
</span><span style=color:#408080;font-style:italic>     * 文件上传
</span><span style=color:#408080;font-style:italic>     *
</span><span style=color:#408080;font-style:italic>     * @param file
</span><span style=color:#408080;font-style:italic>     * @return
</span><span style=color:#408080;font-style:italic>     */</span>
    <span style=color:#a2f>@PostMapping</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;/upload&#34;</span><span style=color:#666>)</span>
    <span style=color:green;font-weight:700>public</span> R<span style=color:#666>&lt;</span>String<span style=color:#666>&gt;</span> <span style=color:#00f>upload</span><span style=color:#666>(</span>MultipartFile file<span style=color:#666>)</span> <span style=color:#666>{</span>
        <span style=color:#408080;font-style:italic>//file是一个临时文件，需要转存到指定位置，否则本次请求完成后临时文件会删除
</span><span style=color:#408080;font-style:italic></span>        log<span style=color:#666>.</span><span style=color:#7d9029>info</span><span style=color:#666>(</span>file<span style=color:#666>.</span><span style=color:#7d9029>toString</span><span style=color:#666>());</span>
        <span style=color:#408080;font-style:italic>//获得原始的文件名
</span><span style=color:#408080;font-style:italic></span>        String originalFilename <span style=color:#666>=</span> file<span style=color:#666>.</span><span style=color:#7d9029>getOriginalFilename</span><span style=color:#666>();</span>

        <span style=color:#408080;font-style:italic>//动态拿后缀
</span><span style=color:#408080;font-style:italic></span>        String sufix <span style=color:#666>=</span> originalFilename<span style=color:#666>.</span><span style=color:#7d9029>substring</span><span style=color:#666>(</span>originalFilename<span style=color:#666>.</span><span style=color:#7d9029>lastIndexOf</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;.&#34;</span><span style=color:#666>));</span>
        <span style=color:#408080;font-style:italic>//或者用uuid防止名称重复
</span><span style=color:#408080;font-style:italic></span>        String fileName <span style=color:#666>=</span> UUID<span style=color:#666>.</span><span style=color:#7d9029>randomUUID</span><span style=color:#666>().</span><span style=color:#7d9029>toString</span><span style=color:#666>()</span> <span style=color:#666>+</span> sufix<span style=color:#666>;</span>
        <span style=color:#408080;font-style:italic>//创建一个目录
</span><span style=color:#408080;font-style:italic></span>        File dir <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> File<span style=color:#666>(</span>basePath<span style=color:#666>);</span>
        <span style=color:#408080;font-style:italic>//判断当前目录是否存在
</span><span style=color:#408080;font-style:italic></span>        <span style=color:green;font-weight:700>if</span> <span style=color:#666>(!</span>dir<span style=color:#666>.</span><span style=color:#7d9029>exists</span><span style=color:#666>())</span> <span style=color:#666>{</span>
            <span style=color:#408080;font-style:italic>//不存在就创建
</span><span style=color:#408080;font-style:italic></span>            dir<span style=color:#666>.</span><span style=color:#7d9029>mkdirs</span><span style=color:#666>();</span>
        <span style=color:#666>}</span>


        <span style=color:green;font-weight:700>try</span> <span style=color:#666>{</span>
            file<span style=color:#666>.</span><span style=color:#7d9029>transferTo</span><span style=color:#666>(</span><span style=color:green;font-weight:700>new</span> File<span style=color:#666>(</span>basePath<span style=color:#666>+</span><span style=color:green;font-weight:700>new</span> File<span style=color:#666>(</span>fileName<span style=color:#666>)));</span>
        <span style=color:#666>}</span> <span style=color:green;font-weight:700>catch</span> <span style=color:#666>(</span>IOException e<span style=color:#666>)</span> <span style=color:#666>{</span>
            e<span style=color:#666>.</span><span style=color:#7d9029>printStackTrace</span><span style=color:#666>();</span>
        <span style=color:#666>}</span>
        <span style=color:green;font-weight:700>return</span> R<span style=color:#666>.</span><span style=color:#7d9029>success</span><span style=color:#666>(</span>fileName<span style=color:#666>);</span>

<span style=color:#408080;font-style:italic>//        if(!headerImg.isEmpty()){
</span><span style=color:#408080;font-style:italic>//            //保存到文件服务器，OSS服务器
</span><span style=color:#408080;font-style:italic>//            String originalFilename = headerImg.getOriginalFilename();
</span><span style=color:#408080;font-style:italic>//            headerImg.transferTo(new File(&#34;H:\\cache\\&#34;+originalFilename));
</span><span style=color:#408080;font-style:italic>//        }
</span><span style=color:#408080;font-style:italic>//
</span><span style=color:#408080;font-style:italic>//        if(photos.length &gt; 0){
</span><span style=color:#408080;font-style:italic>//            for (MultipartFile photo : photos) {
</span><span style=color:#408080;font-style:italic>//                if(!photo.isEmpty()){
</span><span style=color:#408080;font-style:italic>//                    String originalFilename = photo.getOriginalFilename();
</span><span style=color:#408080;font-style:italic>//                    photo.transferTo(new File(&#34;H:\\cache\\&#34;+originalFilename));
</span><span style=color:#408080;font-style:italic>//                }
</span><span style=color:#408080;font-style:italic>//            }
</span><span style=color:#408080;font-style:italic>//        }
</span><span style=color:#408080;font-style:italic></span>
    <span style=color:#666>}</span>

    <span style=color:#408080;font-style:italic>/**
</span><span style=color:#408080;font-style:italic>     * 文件下载
</span><span style=color:#408080;font-style:italic>     *
</span><span style=color:#408080;font-style:italic>     * @param name
</span><span style=color:#408080;font-style:italic>     * @param response
</span><span style=color:#408080;font-style:italic>     */</span>
    <span style=color:#a2f>@GetMapping</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;/download&#34;</span><span style=color:#666>)</span>
    <span style=color:green;font-weight:700>public</span> <span style=color:#b00040>void</span> <span style=color:#00f>download</span><span style=color:#666>(</span>String name<span style=color:#666>,</span> HttpServletResponse response<span style=color:#666>)</span> <span style=color:#666>{</span>
            <span style=color:green;font-weight:700>try</span> <span style=color:#666>{</span>
                <span style=color:#408080;font-style:italic>//输入流，通过输入流读取文件内容
</span><span style=color:#408080;font-style:italic></span>                FileInputStream fileInputStream <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> FileInputStream<span style=color:#666>(</span><span style=color:green;font-weight:700>new</span> File<span style=color:#666>(</span>basePath <span style=color:#666>+</span> name<span style=color:#666>));</span>

                <span style=color:#408080;font-style:italic>//输出流，通过输出流将文件写回浏览器
</span><span style=color:#408080;font-style:italic></span>                ServletOutputStream outputStream <span style=color:#666>=</span> response<span style=color:#666>.</span><span style=color:#7d9029>getOutputStream</span><span style=color:#666>();</span>

                response<span style=color:#666>.</span><span style=color:#7d9029>setContentType</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;image/jpeg&#34;</span><span style=color:#666>);</span>
                <span style=color:#408080;font-style:italic>//代表的是图片文件
</span><span style=color:#408080;font-style:italic></span>                <span style=color:#b00040>int</span> len <span style=color:#666>=</span> 0<span style=color:#666>;</span>
                <span style=color:#b00040>byte</span><span style=color:#666>[]</span> bytes <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> <span style=color:#b00040>byte</span><span style=color:#666>[</span>1024<span style=color:#666>];</span>
                <span style=color:green;font-weight:700>while</span> <span style=color:#666>((</span>len<span style=color:#666>=</span>fileInputStream<span style=color:#666>.</span><span style=color:#7d9029>read</span><span style=color:#666>(</span>bytes<span style=color:#666>))</span> <span style=color:#666>!=</span> <span style=color:#666>-</span>1<span style=color:#666>){</span>
                    outputStream<span style=color:#666>.</span><span style=color:#7d9029>write</span><span style=color:#666>(</span>bytes<span style=color:#666>,</span> 0<span style=color:#666>,</span> len<span style=color:#666>);</span>
                    outputStream<span style=color:#666>.</span><span style=color:#7d9029>flush</span><span style=color:#666>();</span>
                <span style=color:#666>}</span>


            <span style=color:#408080;font-style:italic>//关闭资源
</span><span style=color:#408080;font-style:italic></span>            outputStream<span style=color:#666>.</span><span style=color:#7d9029>close</span><span style=color:#666>();</span>
            fileInputStream<span style=color:#666>.</span><span style=color:#7d9029>close</span><span style=color:#666>();</span>
        <span style=color:#666>}</span> <span style=color:green;font-weight:700>catch</span><span style=color:#666>(</span>Exception e<span style=color:#666>)</span> <span style=color:#666>{</span>
                e<span style=color:#666>.</span><span style=color:#7d9029>printStackTrace</span><span style=color:#666>();</span>
            <span style=color:#666>}</span>

    <span style=color:#666>}</span>
<span style=color:#666>}</span>

</code></pre></div><h4 id=1dishcontroller>1.dishcontroller<a href=#1dishcontroller class=header-anchor arialabel=Anchor> #</a></h4><div class=highlight><pre style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>
<span style=color:#408080;font-style:italic>/**
</span><span style=color:#408080;font-style:italic> * 菜品管理
</span><span style=color:#408080;font-style:italic> */</span>
<span style=color:#a2f>@RestController</span>
<span style=color:#a2f>@RequestMapping</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;/dish&#34;</span><span style=color:#666>)</span>
<span style=color:#a2f>@Slf4j</span>
<span style=color:green;font-weight:700>public</span> <span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>DishController</span> <span style=color:#666>{</span>
    <span style=color:#a2f>@Autowired</span>
    <span style=color:green;font-weight:700>private</span> DishService dishService<span style=color:#666>;</span>
    <span style=color:#a2f>@Autowired</span>
    <span style=color:green;font-weight:700>private</span> RedisTemplate redisTemplate<span style=color:#666>;</span>


    <span style=color:#408080;font-style:italic>/**
</span><span style=color:#408080;font-style:italic>     * 新增菜品
</span><span style=color:#408080;font-style:italic>     * @param dishDto
</span><span style=color:#408080;font-style:italic>     * @return
</span><span style=color:#408080;font-style:italic>     */</span>
   <span style=color:#a2f>@PostMapping</span>
   <span style=color:green;font-weight:700>public</span> R<span style=color:#666>&lt;</span>String<span style=color:#666>&gt;</span> <span style=color:#00f>save</span><span style=color:#666>(</span> <span style=color:#a2f>@RequestBody</span> DishDto dishDto<span style=color:#666>){</span>
       log<span style=color:#666>.</span><span style=color:#7d9029>info</span><span style=color:#666>(</span>dishDto<span style=color:#666>.</span><span style=color:#7d9029>toString</span><span style=color:#666>());</span>
      dishService<span style=color:#666>.</span><span style=color:#7d9029>saveWithFlavor</span><span style=color:#666>(</span>dishDto<span style=color:#666>);</span>
        <span style=color:green;font-weight:700>return</span> R<span style=color:#666>.</span><span style=color:#7d9029>success</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;新增菜品成功&#34;</span><span style=color:#666>);</span>
   <span style=color:#666>}</span>

    <span style=color:#408080;font-style:italic>/**
</span><span style=color:#408080;font-style:italic>     * 菜品信息分页查询
</span><span style=color:#408080;font-style:italic>     * @param page
</span><span style=color:#408080;font-style:italic>     * @param pageSize
</span><span style=color:#408080;font-style:italic>     * @param name
</span><span style=color:#408080;font-style:italic>     * @return
</span><span style=color:#408080;font-style:italic>     */</span>
    <span style=color:#a2f>@GetMapping</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;/page&#34;</span><span style=color:#666>)</span>
    <span style=color:green;font-weight:700>public</span> R<span style=color:#666>&lt;</span>Page<span style=color:#666>&gt;</span> <span style=color:#00f>page</span><span style=color:#666>(</span><span style=color:#b00040>int</span> page<span style=color:#666>,</span><span style=color:#b00040>int</span> pageSize<span style=color:#666>,</span>String name<span style=color:#666>){</span>
        <span style=color:green;font-weight:700>return</span> dishService<span style=color:#666>.</span><span style=color:#7d9029>pagedish</span><span style=color:#666>(</span>page<span style=color:#666>,</span>pageSize<span style=color:#666>,</span>name<span style=color:#666>);</span>

    <span style=color:#666>}</span>

    <span style=color:#408080;font-style:italic>/**
</span><span style=color:#408080;font-style:italic>     * 根据id查询菜品信息和对应的口味信息
</span><span style=color:#408080;font-style:italic>     * @param id
</span><span style=color:#408080;font-style:italic>     * @return
</span><span style=color:#408080;font-style:italic>     */</span>
    <span style=color:#a2f>@GetMapping</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;/{id}&#34;</span><span style=color:#666>)</span>
    <span style=color:green;font-weight:700>public</span> R<span style=color:#666>&lt;</span>DishDto<span style=color:#666>&gt;</span> <span style=color:#00f>get</span><span style=color:#666>(</span><span style=color:#a2f>@PathVariable</span> Long id<span style=color:#666>){</span>

        DishDto dishDto <span style=color:#666>=</span> dishService<span style=color:#666>.</span><span style=color:#7d9029>getByIdWithFlavor</span><span style=color:#666>(</span>id<span style=color:#666>);</span>

        <span style=color:green;font-weight:700>return</span> R<span style=color:#666>.</span><span style=color:#7d9029>success</span><span style=color:#666>(</span>dishDto<span style=color:#666>);</span>

    <span style=color:#666>}</span>
    <span style=color:#408080;font-style:italic>/**
</span><span style=color:#408080;font-style:italic>     * 修改菜品
</span><span style=color:#408080;font-style:italic>     * @param dishDto
</span><span style=color:#408080;font-style:italic>     * @return
</span><span style=color:#408080;font-style:italic>     */</span>
    <span style=color:#a2f>@PutMapping</span>
    <span style=color:green;font-weight:700>public</span> R<span style=color:#666>&lt;</span>String<span style=color:#666>&gt;</span> <span style=color:#00f>update</span><span style=color:#666>(</span> <span style=color:#a2f>@RequestBody</span> DishDto dishDto<span style=color:#666>){</span>
        <span style=color:#408080;font-style:italic>//设置dish和口味表
</span><span style=color:#408080;font-style:italic></span>        log<span style=color:#666>.</span><span style=color:#7d9029>info</span><span style=color:#666>(</span>dishDto<span style=color:#666>.</span><span style=color:#7d9029>toString</span><span style=color:#666>());</span>
        dishService<span style=color:#666>.</span><span style=color:#7d9029>updateWithFlavor</span><span style=color:#666>(</span>dishDto<span style=color:#666>);</span>
<span style=color:#408080;font-style:italic>//        //清理所有的菜品缓存
</span><span style=color:#408080;font-style:italic>//        Set keys = redisTemplate.keys(&#34;dish_*&#34;);
</span><span style=color:#408080;font-style:italic>//        redisTemplate.delete(keys);
</span><span style=color:#408080;font-style:italic></span>        <span style=color:#408080;font-style:italic>//精确清理
</span><span style=color:#408080;font-style:italic></span>        String key<span style=color:#666>=</span><span style=color:#ba2121>&#34;dish_&#34;</span><span style=color:#666>+</span>dishDto<span style=color:#666>.</span><span style=color:#7d9029>getCategoryId</span><span style=color:#666>()+</span><span style=color:#ba2121>&#34;_&#34;</span><span style=color:#666>;</span>
        redisTemplate<span style=color:#666>.</span><span style=color:#7d9029>delete</span><span style=color:#666>(</span>key<span style=color:#666>);</span>

        <span style=color:green;font-weight:700>return</span> R<span style=color:#666>.</span><span style=color:#7d9029>success</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;新增菜品成功&#34;</span><span style=color:#666>);</span>
    <span style=color:#666>}</span>

    <span style=color:#408080;font-style:italic>/**
</span><span style=color:#408080;font-style:italic>     * 利用dish接收更通用
</span><span style=color:#408080;font-style:italic>     * @param dish
</span><span style=color:#408080;font-style:italic>     * @return
</span><span style=color:#408080;font-style:italic>     */</span>
    <span style=color:#a2f>@GetMapping</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;/list&#34;</span><span style=color:#666>)</span>
    <span style=color:green;font-weight:700>public</span> R<span style=color:#666>&lt;</span>List<span style=color:#666>&lt;</span>DishDto<span style=color:#666>&gt;&gt;</span> <span style=color:#00f>list</span><span style=color:#666>(</span>Dish dish<span style=color:#666>){</span>
        <span style=color:green;font-weight:700>return</span> dishService<span style=color:#666>.</span><span style=color:#7d9029>listdish</span><span style=color:#666>(</span>dish<span style=color:#666>);</span>
    <span style=color:#666>}</span>

    <span style=color:#408080;font-style:italic>/**
</span><span style=color:#408080;font-style:italic>     * 对菜品批量或者是单个 进行停售或者是起售
</span><span style=color:#408080;font-style:italic>     * @return
</span><span style=color:#408080;font-style:italic>     */</span>
    <span style=color:#a2f>@PostMapping</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;/status/{status}&#34;</span><span style=color:#666>)</span>
    <span style=color:green;font-weight:700>public</span> R<span style=color:#666>&lt;</span>String<span style=color:#666>&gt;</span> <span style=color:#00f>status</span><span style=color:#666>(</span><span style=color:#a2f>@PathVariable</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;status&#34;</span><span style=color:#666>)</span> Integer status<span style=color:#666>,</span><span style=color:#a2f>@RequestParam</span> List<span style=color:#666>&lt;</span>Long<span style=color:#666>&gt;</span> ids<span style=color:#666>)</span> <span style=color:#666>{</span>
        <span style=color:green;font-weight:700>return</span> dishService<span style=color:#666>.</span><span style=color:#7d9029>status</span><span style=color:#666>(</span>status<span style=color:#666>,</span> ids<span style=color:#666>);</span>

    <span style=color:#666>}</span>
    <span style=color:#408080;font-style:italic>/**
</span><span style=color:#408080;font-style:italic>     * 删除菜品
</span><span style=color:#408080;font-style:italic>     */</span>
    <span style=color:#a2f>@DeleteMapping</span>
   <span style=color:green;font-weight:700>public</span> R<span style=color:#666>&lt;</span>String<span style=color:#666>&gt;</span> <span style=color:#00f>deletedish</span><span style=color:#666>(</span><span style=color:#a2f>@RequestParam</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;ids&#34;</span><span style=color:#666>)</span> List<span style=color:#666>&lt;</span>Long<span style=color:#666>&gt;</span> ids<span style=color:#666>){</span>

        <span style=color:green;font-weight:700>return</span> dishService<span style=color:#666>.</span><span style=color:#7d9029>deletedish</span><span style=color:#666>(</span>ids<span style=color:#666>);</span>
    <span style=color:#666>}</span>


<span style=color:#666>}</span>
</code></pre></div><h4 id=2代码思路>2.代码思路<a href=#2代码思路 class=header-anchor arialabel=Anchor> #</a></h4><blockquote><p>1.前端传过来的具体参数，我们需要相应参数类型来接收因为这里传过来的参数比较复杂。所以这里有两种方式进行封装，第一：创建与这些数据对应的实体类（dto)第二使用map来接收；</p><p>2.新增套餐</p><blockquote><p>1.用dto进行接收并且进行处理</p><p>2.@Transactional <em>//涉及到对多张表的数据进行操作,需要加事务，需要事务生效,需要在启动类加上事务注解生效</em>,并且在application启动类上开启@EnableTransactionManagement</p><p>3.用stream流进行处理口味，然后批量保存</p></blockquote><p>3.停售启售修该等代码如下（比较简单不写思路）</p><p>4.删除单个和批量删除</p><blockquote><p>1.判断要删除的菜品在不在售卖的套餐中，如果在那不能删除</p><p>2.要先判断要删除的菜品是否在售卖，如果在售卖也不能删除</p></blockquote><p>5.利用redis缓存展示菜品</p><blockquote><p>1.传过来是dish，先在redis中查询缓存</p><p>2.根据ids查询数据库，将dishDto通过BeanUtils.copyProperties(item,dishDto);复制dish基本信息</p><p>3.最后查询出来的信息缓存到redis中</p></blockquote><p>6.利用redis进行缓存pagedish参数</p><blockquote><p>1.利用redis和 BeanUtils.copyProperties（）</p><ol start=2><li>//copyProperties 拷贝属性，元，不拷集合（集合是显示在页面的，我们要处理） BeanUtils.copyProperties(pageInfo,dishDtoPage,&ldquo;records&rdquo;);</li></ol><p>3.忽略records之后再进行处理</p></blockquote></blockquote><h4 id=3代码实现-1>3.代码实现<a href=#3代码实现-1 class=header-anchor arialabel=Anchor> #</a></h4><div class=highlight><pre style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#a2f>@Service</span>
<span style=color:#a2f>@Slf4j</span>
<span style=color:#a2f>@Transactional</span>
<span style=color:green;font-weight:700>public</span> <span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>DishServiceImpl</span> <span style=color:green;font-weight:700>extends</span> ServiceImpl<span style=color:#666>&lt;</span>DishMapper<span style=color:#666>,</span> Dish<span style=color:#666>&gt;</span>
        <span style=color:green;font-weight:700>implements</span> DishService <span style=color:#666>{</span>

    <span style=color:#a2f>@Autowired</span>
    <span style=color:green;font-weight:700>private</span> DishFlavorService dishFlavorService<span style=color:#666>;</span>
    <span style=color:#a2f>@Autowired</span>
    <span style=color:green;font-weight:700>private</span> SetmealDishService setmealDishService<span style=color:#666>;</span>
    <span style=color:#a2f>@Autowired</span>
    <span style=color:green;font-weight:700>private</span> SetmealService setmealService<span style=color:#666>;</span>
    <span style=color:#a2f>@Autowired</span>
    <span style=color:#a2f>@Lazy</span>
    <span style=color:green;font-weight:700>private</span> CategoryService categoryService<span style=color:#666>;</span>
    <span style=color:#a2f>@Autowired</span>
    <span style=color:green;font-weight:700>private</span> RedisTemplate redisTemplate<span style=color:#666>;</span>

    <span style=color:#408080;font-style:italic>/**
</span><span style=color:#408080;font-style:italic>     * 新增菜品，同时保存对应的口味（两张表）
</span><span style=color:#408080;font-style:italic>     * @param dishDto
</span><span style=color:#408080;font-style:italic>     */</span>
    <span style=color:#a2f>@Transactional</span> <span style=color:#408080;font-style:italic>//两张表事务控制
</span><span style=color:#408080;font-style:italic></span>    <span style=color:green;font-weight:700>public</span> <span style=color:#b00040>void</span> <span style=color:#00f>saveWithFlavor</span> <span style=color:#666>(</span>DishDto dishDto<span style=color:#666>){</span>
        <span style=color:#408080;font-style:italic>//保存菜品的基本信息到菜品表dish
</span><span style=color:#408080;font-style:italic></span>        <span style=color:green;font-weight:700>this</span><span style=color:#666>.</span><span style=color:#7d9029>save</span><span style=color:#666>(</span>dishDto<span style=color:#666>);</span>
        <span style=color:#408080;font-style:italic>//保存菜品口味数据到菜品口味表，引入口味service
</span><span style=color:#408080;font-style:italic></span>        <span style=color:#408080;font-style:italic>//批量保存口味（但是存在问题）
</span><span style=color:#408080;font-style:italic></span>        <span style=color:#408080;font-style:italic>//因为保存的时候 private List&lt;DishFlavor&gt; flavors = new ArrayList&lt;&gt;();
</span><span style=color:#408080;font-style:italic></span>        <span style=color:#408080;font-style:italic>//封装的是.getFlavors含只有name和value(口味名称和数据），然而无菜品id)
</span><span style=color:#408080;font-style:italic></span>        <span style=color:#408080;font-style:italic>//1.所以在前面获得dishId
</span><span style=color:#408080;font-style:italic></span>        Long dishId <span style=color:#666>=</span> dishDto<span style=color:#666>.</span><span style=color:#7d9029>getId</span><span style=color:#666>();</span><span style=color:#408080;font-style:italic>//对应的菜品id
</span><span style=color:#408080;font-style:italic></span>        <span style=color:#408080;font-style:italic>//2.先对菜品口味进行处理
</span><span style=color:#408080;font-style:italic></span>        List<span style=color:#666>&lt;</span>DishFlavor<span style=color:#666>&gt;</span> flavors <span style=color:#666>=</span> dishDto<span style=color:#666>.</span><span style=color:#7d9029>getFlavors</span><span style=color:#666>();</span>
        <span style=color:#408080;font-style:italic>//3.遍历集合，将dishId给flavor赋值
</span><span style=color:#408080;font-style:italic></span>        flavors<span style=color:#666>=</span>flavors<span style=color:#666>.</span><span style=color:#7d9029>stream</span><span style=color:#666>().</span><span style=color:#7d9029>map</span><span style=color:#666>((</span>item<span style=color:#666>)</span> <span style=color:#666>-&gt;</span> <span style=color:#666>{</span>
            item<span style=color:#666>.</span><span style=color:#7d9029>setDishId</span><span style=color:#666>(</span>dishId<span style=color:#666>);</span>
            <span style=color:green;font-weight:700>return</span> item<span style=color:#666>;</span>
            <span style=color:#666>}</span>
        <span style=color:#666>).</span><span style=color:#7d9029>collect</span><span style=color:#666>(</span>Collectors<span style=color:#666>.</span><span style=color:#7d9029>toList</span><span style=color:#666>());</span>
        <span style=color:#408080;font-style:italic>//item是遍历出来的值，收集起来变成list ,赋值给原来的
</span><span style=color:#408080;font-style:italic></span>
        dishFlavorService<span style=color:#666>.</span><span style=color:#7d9029>saveBatch</span><span style=color:#666>(</span>dishDto<span style=color:#666>.</span><span style=color:#7d9029>getFlavors</span><span style=color:#666>());</span>

    <span style=color:#666>}</span>

    <span style=color:#a2f>@Override</span>
    <span style=color:green;font-weight:700>public</span> DishDto <span style=color:#00f>getByIdWithFlavor</span><span style=color:#666>(</span>Long id<span style=color:#666>)</span> <span style=color:#666>{</span>
        <span style=color:#408080;font-style:italic>//1.先查询基本信息
</span><span style=color:#408080;font-style:italic></span>        Dish dish <span style=color:#666>=</span> <span style=color:green;font-weight:700>this</span><span style=color:#666>.</span><span style=color:#7d9029>getById</span><span style=color:#666>(</span>id<span style=color:#666>);</span>
        <span style=color:#408080;font-style:italic>//2.查询口味信息，从dish_flavor
</span><span style=color:#408080;font-style:italic></span>        <span style=color:#408080;font-style:italic>//3.返回的sdto，所以需要拷贝
</span><span style=color:#408080;font-style:italic></span>        DishDto dishDto <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> DishDto<span style=color:#666>();</span>
        BeanUtils<span style=color:#666>.</span><span style=color:#7d9029>copyProperties</span><span style=color:#666>(</span>dish<span style=color:#666>,</span>dishDto<span style=color:#666>);</span>
        <span style=color:#408080;font-style:italic>//条件构造器
</span><span style=color:#408080;font-style:italic></span>        LambdaQueryWrapper<span style=color:#666>&lt;</span>DishFlavor<span style=color:#666>&gt;</span> queryWrapper <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> LambdaQueryWrapper<span style=color:#666>&lt;&gt;();</span>
        <span style=color:#408080;font-style:italic>//条件查询,根据菜品的id与口味表的id对应
</span><span style=color:#408080;font-style:italic></span>        queryWrapper<span style=color:#666>.</span><span style=color:#7d9029>eq</span><span style=color:#666>(</span>DishFlavor<span style=color:#666>::</span>getDishId<span style=color:#666>,</span>dish<span style=color:#666>.</span><span style=color:#7d9029>getId</span><span style=color:#666>());</span>
        List<span style=color:#666>&lt;</span>DishFlavor<span style=color:#666>&gt;</span> flavors <span style=color:#666>=</span> dishFlavorService<span style=color:#666>.</span><span style=color:#7d9029>list</span><span style=color:#666>(</span>queryWrapper<span style=color:#666>);</span>
        dishDto<span style=color:#666>.</span><span style=color:#7d9029>setFlavors</span><span style=color:#666>(</span>flavors<span style=color:#666>);</span>
        <span style=color:green;font-weight:700>return</span> dishDto<span style=color:#666>;</span>
    <span style=color:#666>}</span>

    <span style=color:#a2f>@Override</span>
    <span style=color:green;font-weight:700>public</span> <span style=color:#b00040>void</span> <span style=color:#00f>updateWithFlavor</span><span style=color:#666>(</span>DishDto dishDto<span style=color:#666>)</span> <span style=color:#666>{</span>

        <span style=color:#408080;font-style:italic>//更新dish表基本信息，清理当前菜品对应的口味，再添加当前的口味数据
</span><span style=color:#408080;font-style:italic></span>        <span style=color:green;font-weight:700>this</span><span style=color:#666>.</span><span style=color:#7d9029>updateById</span><span style=color:#666>(</span>dishDto<span style=color:#666>);</span>
        <span style=color:#408080;font-style:italic>//构造条件
</span><span style=color:#408080;font-style:italic></span>        LambdaQueryWrapper<span style=color:#666>&lt;</span>DishFlavor<span style=color:#666>&gt;</span> queryWrapper <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span>
                LambdaQueryWrapper<span style=color:#666>();</span>
        <span style=color:#408080;font-style:italic>//查询条件
</span><span style=color:#408080;font-style:italic></span>      queryWrapper<span style=color:#666>.</span><span style=color:#7d9029>eq</span><span style=color:#666>(</span>DishFlavor<span style=color:#666>::</span>getDishId<span style=color:#666>,</span> dishDto<span style=color:#666>.</span><span style=color:#7d9029>getId</span><span style=color:#666>());</span>
        dishFlavorService<span style=color:#666>.</span><span style=color:#7d9029>remove</span><span style=color:#666>(</span>queryWrapper<span style=color:#666>);</span>
        <span style=color:#408080;font-style:italic>//插入
</span><span style=color:#408080;font-style:italic></span>        List<span style=color:#666>&lt;</span>DishFlavor<span style=color:#666>&gt;</span> flavors <span style=color:#666>=</span> dishDto<span style=color:#666>.</span><span style=color:#7d9029>getFlavors</span><span style=color:#666>();</span>
        dishFlavorService<span style=color:#666>.</span><span style=color:#7d9029>saveBatch</span><span style=color:#666>(</span>flavors<span style=color:#666>);</span>
        <span style=color:#408080;font-style:italic>//注意此时disFlaor的dishid没有值，所以需要传入
</span><span style=color:#408080;font-style:italic></span>        <span style=color:#408080;font-style:italic>//3.遍历集合，将dishId给flavor赋值
</span><span style=color:#408080;font-style:italic></span>        flavors<span style=color:#666>=</span>flavors<span style=color:#666>.</span><span style=color:#7d9029>stream</span><span style=color:#666>().</span><span style=color:#7d9029>map</span><span style=color:#666>((</span>item<span style=color:#666>)</span> <span style=color:#666>-&gt;</span> <span style=color:#666>{</span>
                    item<span style=color:#666>.</span><span style=color:#7d9029>setDishId</span><span style=color:#666>(</span>dishDto<span style=color:#666>.</span><span style=color:#7d9029>getId</span><span style=color:#666>());</span>
                    <span style=color:green;font-weight:700>return</span> item<span style=color:#666>;</span>
                <span style=color:#666>}</span>
        <span style=color:#666>).</span><span style=color:#7d9029>collect</span><span style=color:#666>(</span>Collectors<span style=color:#666>.</span><span style=color:#7d9029>toList</span><span style=color:#666>());</span>


    <span style=color:#666>}</span>

    <span style=color:#a2f>@Override</span>
    <span style=color:green;font-weight:700>public</span> R<span style=color:#666>&lt;</span>String<span style=color:#666>&gt;</span> <span style=color:#00f>status</span><span style=color:#666>(</span>Integer status<span style=color:#666>,</span> List<span style=color:#666>&lt;</span>Long<span style=color:#666>&gt;</span> ids<span style=color:#666>)</span> <span style=color:#666>{</span>
        LambdaQueryWrapper<span style=color:#666>&lt;</span>Dish<span style=color:#666>&gt;</span> queryWrapper <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> LambdaQueryWrapper<span style=color:#666>();</span>
        queryWrapper<span style=color:#666>.</span><span style=color:#7d9029>in</span><span style=color:#666>(</span>ids <span style=color:#666>!=</span><span style=color:green;font-weight:700>null</span><span style=color:#666>,</span>Dish<span style=color:#666>::</span>getId<span style=color:#666>,</span>ids<span style=color:#666>);</span>
        <span style=color:#408080;font-style:italic>//根据数据进行批量查询
</span><span style=color:#408080;font-style:italic></span>        List<span style=color:#666>&lt;</span>Dish<span style=color:#666>&gt;</span> list <span style=color:#666>=</span> <span style=color:green;font-weight:700>this</span><span style=color:#666>.</span><span style=color:#7d9029>list</span><span style=color:#666>(</span>queryWrapper<span style=color:#666>);</span>

        <span style=color:green;font-weight:700>for</span> <span style=color:#666>(</span>Dish dish <span style=color:#666>:</span> list<span style=color:#666>)</span> <span style=color:#666>{</span>
            <span style=color:green;font-weight:700>if</span> <span style=color:#666>(</span>dish <span style=color:#666>!=</span> <span style=color:green;font-weight:700>null</span><span style=color:#666>){</span>
                dish<span style=color:#666>.</span><span style=color:#7d9029>setStatus</span><span style=color:#666>(</span>status<span style=color:#666>);</span>
               <span style=color:green;font-weight:700>this</span><span style=color:#666>.</span><span style=color:#7d9029>updateById</span><span style=color:#666>(</span>dish<span style=color:#666>);</span>
            <span style=color:#666>}</span>
        <span style=color:#666>}</span>
        <span style=color:green;font-weight:700>return</span> R<span style=color:#666>.</span><span style=color:#7d9029>success</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;售卖状态修改成功&#34;</span><span style=color:#666>);</span>
    <span style=color:#666>}</span>

    <span style=color:#408080;font-style:italic>/**
</span><span style=color:#408080;font-style:italic>     *套餐批量删除和单个删除
</span><span style=color:#408080;font-style:italic>     * @param ids
</span><span style=color:#408080;font-style:italic>     */</span>
    <span style=color:#a2f>@Override</span>
    <span style=color:#a2f>@Transactional</span>
    <span style=color:green;font-weight:700>public</span> <span style=color:#b00040>void</span> <span style=color:#00f>deleteByIds</span><span style=color:#666>(</span>List<span style=color:#666>&lt;</span>Long<span style=color:#666>&gt;</span> ids<span style=color:#666>)</span> <span style=color:#666>{</span>

        <span style=color:#408080;font-style:italic>//构造条件查询器
</span><span style=color:#408080;font-style:italic></span>        LambdaQueryWrapper<span style=color:#666>&lt;</span>Dish<span style=color:#666>&gt;</span> queryWrapper <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> LambdaQueryWrapper<span style=color:#666>&lt;&gt;();</span>
        <span style=color:#408080;font-style:italic>//先查询该菜品是否在售卖，如果是则抛出业务异常
</span><span style=color:#408080;font-style:italic></span>        queryWrapper<span style=color:#666>.</span><span style=color:#7d9029>in</span><span style=color:#666>(</span>ids<span style=color:#666>!=</span><span style=color:green;font-weight:700>null</span><span style=color:#666>,</span>Dish<span style=color:#666>::</span>getId<span style=color:#666>,</span>ids<span style=color:#666>);</span>
        List<span style=color:#666>&lt;</span>Dish<span style=color:#666>&gt;</span> list <span style=color:#666>=</span> <span style=color:green;font-weight:700>this</span><span style=color:#666>.</span><span style=color:#7d9029>list</span><span style=color:#666>(</span>queryWrapper<span style=color:#666>);</span>
        <span style=color:green;font-weight:700>for</span> <span style=color:#666>(</span>Dish dish <span style=color:#666>:</span> list<span style=color:#666>)</span> <span style=color:#666>{</span>
            Integer status <span style=color:#666>=</span> dish<span style=color:#666>.</span><span style=color:#7d9029>getStatus</span><span style=color:#666>();</span>
            <span style=color:#408080;font-style:italic>//如果不是在售卖,则可以删除
</span><span style=color:#408080;font-style:italic></span>            <span style=color:green;font-weight:700>if</span> <span style=color:#666>(</span>status <span style=color:#666>==</span> 0<span style=color:#666>){</span>
                <span style=color:green;font-weight:700>this</span><span style=color:#666>.</span><span style=color:#7d9029>removeById</span><span style=color:#666>(</span>dish<span style=color:#666>.</span><span style=color:#7d9029>getId</span><span style=color:#666>());</span>
            <span style=color:#666>}</span><span style=color:green;font-weight:700>else</span> <span style=color:#666>{</span>
                <span style=color:#408080;font-style:italic>//此时应该回滚,因为可能前面的删除了，但是后面的是正在售卖
</span><span style=color:#408080;font-style:italic></span>                <span style=color:green;font-weight:700>throw</span> <span style=color:green;font-weight:700>new</span> CustomException<span style=color:#666>(</span><span style=color:#ba2121>&#34;删除菜品中有正在售卖菜品,无法全部删除&#34;</span><span style=color:#666>);</span>
            <span style=color:#666>}</span>
        <span style=color:#666>}</span>

    <span style=color:#666>}</span>

    <span style=color:#408080;font-style:italic>/**
</span><span style=color:#408080;font-style:italic>     * 删除菜品
</span><span style=color:#408080;font-style:italic>     *  1.判断要删除的菜品在不在售卖的套餐中，如果在那不能删除
</span><span style=color:#408080;font-style:italic>     *  * 2.要先判断要删除的菜品是否在售卖，如果在售卖也不能删除
</span><span style=color:#408080;font-style:italic>     * @param ids
</span><span style=color:#408080;font-style:italic>     * @return
</span><span style=color:#408080;font-style:italic>     */</span>

    <span style=color:#a2f>@Override</span>
    <span style=color:green;font-weight:700>public</span> R<span style=color:#666>&lt;</span>String<span style=color:#666>&gt;</span> <span style=color:#00f>deletedish</span><span style=color:#666>(</span>List<span style=color:#666>&lt;</span>Long<span style=color:#666>&gt;</span> ids<span style=color:#666>)</span> <span style=color:#666>{</span>

        <span style=color:#408080;font-style:italic>//1.找到菜品是否关联套餐
</span><span style=color:#408080;font-style:italic></span>
        <span style=color:#408080;font-style:italic>//1.1不关联的直接删除菜品，删除口味
</span><span style=color:#408080;font-style:italic></span>        LambdaQueryWrapper<span style=color:#666>&lt;</span>SetmealDish<span style=color:#666>&gt;</span> queryWrapper <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> LambdaQueryWrapper<span style=color:#666>&lt;&gt;();</span>
        queryWrapper<span style=color:#666>.</span><span style=color:#7d9029>in</span><span style=color:#666>(</span>SetmealDish<span style=color:#666>::</span>getDishId<span style=color:#666>,</span>ids<span style=color:#666>);</span>
        List<span style=color:#666>&lt;</span>SetmealDish<span style=color:#666>&gt;</span> setmealDishes <span style=color:#666>=</span> setmealDishService<span style=color:#666>.</span><span style=color:#7d9029>list</span><span style=color:#666>(</span>queryWrapper<span style=color:#666>);</span>
        <span style=color:green;font-weight:700>if</span> <span style=color:#666>(</span>setmealDishes<span style=color:#666>.</span><span style=color:#7d9029>size</span><span style=color:#666>()==</span>0<span style=color:#666>){</span>
            <span style=color:#408080;font-style:italic>//不关联菜品，直接删除
</span><span style=color:#408080;font-style:italic></span>            <span style=color:green;font-weight:700>for</span> <span style=color:#666>(</span>Long id<span style=color:#666>:</span>ids<span style=color:#666>)</span> <span style=color:#666>{</span>
                <span style=color:green;font-weight:700>this</span><span style=color:#666>.</span><span style=color:#7d9029>deleteByIds</span><span style=color:#666>(</span>ids<span style=color:#666>);</span>
            <span style=color:#666>}</span>
            <span style=color:#408080;font-style:italic>//删除关联口味
</span><span style=color:#408080;font-style:italic></span>            LambdaQueryWrapper<span style=color:#666>&lt;</span>DishFlavor<span style=color:#666>&gt;</span> dishFlavorWrapper <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> LambdaQueryWrapper<span style=color:#666>&lt;&gt;();</span>
            dishFlavorWrapper<span style=color:#666>.</span><span style=color:#7d9029>in</span><span style=color:#666>(</span>DishFlavor<span style=color:#666>::</span>getDishId<span style=color:#666>,</span>ids<span style=color:#666>);</span>
            dishFlavorService<span style=color:#666>.</span><span style=color:#7d9029>remove</span><span style=color:#666>(</span>dishFlavorWrapper<span style=color:#666>);</span>
            <span style=color:green;font-weight:700>return</span> R<span style=color:#666>.</span><span style=color:#7d9029>success</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;菜品删除成功&#34;</span><span style=color:#666>);</span>

        <span style=color:#666>}</span>
        <span style=color:#408080;font-style:italic>//2.关联套餐
</span><span style=color:#408080;font-style:italic></span>        <span style=color:#408080;font-style:italic>//2.1套餐售
</span><span style=color:#408080;font-style:italic></span>        <span style=color:#408080;font-style:italic>//如果菜品有关联套餐，并且该套餐正在售卖，那么不能删除
</span><span style=color:#408080;font-style:italic></span>        <span style=color:#408080;font-style:italic>//得到与删除菜品关联的套餐id
</span><span style=color:#408080;font-style:italic></span>        ArrayList<span style=color:#666>&lt;</span>Long<span style=color:#666>&gt;</span> Setmeal_idList <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> ArrayList<span style=color:#666>&lt;&gt;();</span>
        <span style=color:green;font-weight:700>for</span> <span style=color:#666>(</span>SetmealDish setmealDish <span style=color:#666>:</span>setmealDishes <span style=color:#666>)</span> <span style=color:#666>{</span>
            Long setmealId <span style=color:#666>=</span> setmealDish<span style=color:#666>.</span><span style=color:#7d9029>getSetmealId</span><span style=color:#666>();</span>
            Setmeal_idList<span style=color:#666>.</span><span style=color:#7d9029>add</span><span style=color:#666>(</span>setmealId<span style=color:#666>);</span>
        <span style=color:#666>}</span>

        <span style=color:#408080;font-style:italic>//查询出与删除菜品相关联的套餐
</span><span style=color:#408080;font-style:italic></span>        LambdaQueryWrapper<span style=color:#666>&lt;</span>Setmeal<span style=color:#666>&gt;</span> setmealLambdaQueryWrapper <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> LambdaQueryWrapper<span style=color:#666>&lt;&gt;();</span>
        setmealLambdaQueryWrapper<span style=color:#666>.</span><span style=color:#7d9029>in</span><span style=color:#666>(</span>Setmeal<span style=color:#666>::</span>getId<span style=color:#666>,</span>Setmeal_idList<span style=color:#666>);</span>
        List<span style=color:#666>&lt;</span>Setmeal<span style=color:#666>&gt;</span> setmealList <span style=color:#666>=</span> setmealService<span style=color:#666>.</span><span style=color:#7d9029>list</span><span style=color:#666>(</span>setmealLambdaQueryWrapper<span style=color:#666>);</span>
        <span style=color:#408080;font-style:italic>//对拿到的所有套餐进行遍历，然后拿到套餐的售卖状态，如果有套餐正在售卖那么删除失败
</span><span style=color:#408080;font-style:italic></span>        <span style=color:green;font-weight:700>for</span> <span style=color:#666>(</span>Setmeal setmeal <span style=color:#666>:</span> setmealList<span style=color:#666>)</span> <span style=color:#666>{</span>
            Integer status <span style=color:#666>=</span> setmeal<span style=color:#666>.</span><span style=color:#7d9029>getStatus</span><span style=color:#666>();</span>
            <span style=color:green;font-weight:700>if</span> <span style=color:#666>(</span>status <span style=color:#666>==</span> 1<span style=color:#666>){</span>
                <span style=color:green;font-weight:700>return</span> R<span style=color:#666>.</span><span style=color:#7d9029>error</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;删除的菜品中有关联在售套餐,删除失败！&#34;</span><span style=color:#666>);</span>
            <span style=color:#666>}</span>
        <span style=color:#666>}</span>
        <span style=color:#408080;font-style:italic>//2.2套餐不售
</span><span style=color:#408080;font-style:italic></span>
        <span style=color:#408080;font-style:italic>//要删除的菜品关联的套餐没有在售，可以删除
</span><span style=color:#408080;font-style:italic></span>        <span style=color:#408080;font-style:italic>//这下面的代码并不一定会执行,因为如果前面的for循环中出现status == 1,那么下面的代码就不会再执行
</span><span style=color:#408080;font-style:italic></span>       <span style=color:green;font-weight:700>this</span><span style=color:#666>.</span><span style=color:#7d9029>deletedish</span><span style=color:#666>(</span>ids<span style=color:#666>);</span>
        LambdaQueryWrapper<span style=color:#666>&lt;</span>DishFlavor<span style=color:#666>&gt;</span> queryWrapperdishf <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> LambdaQueryWrapper<span style=color:#666>&lt;&gt;();</span>
        queryWrapperdishf<span style=color:#666>.</span><span style=color:#7d9029>in</span><span style=color:#666>(</span>DishFlavor<span style=color:#666>::</span>getDishId<span style=color:#666>,</span>ids<span style=color:#666>);</span>
        dishFlavorService<span style=color:#666>.</span><span style=color:#7d9029>remove</span><span style=color:#666>(</span>queryWrapperdishf<span style=color:#666>);</span>
        <span style=color:green;font-weight:700>return</span> R<span style=color:#666>.</span><span style=color:#7d9029>success</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;菜品删除成功&#34;</span><span style=color:#666>);</span>

    <span style=color:#666>}</span>

    <span style=color:#a2f>@Override</span>
    <span style=color:green;font-weight:700>public</span> R<span style=color:#666>&lt;</span>List<span style=color:#666>&lt;</span>DishDto<span style=color:#666>&gt;&gt;</span> <span style=color:#00f>listdish</span><span style=color:#666>(</span>Dish dish<span style=color:#666>)</span> <span style=color:#666>{</span>
        List<span style=color:#666>&lt;</span>DishDto<span style=color:#666>&gt;</span> dishDtoList<span style=color:#666>=</span><span style=color:green;font-weight:700>null</span><span style=color:#666>;</span>
        String key<span style=color:#666>=</span><span style=color:#ba2121>&#34;dish_&#34;</span><span style=color:#666>+</span>dish<span style=color:#666>.</span><span style=color:#7d9029>getCategoryId</span><span style=color:#666>()+</span><span style=color:#ba2121>&#34;_&#34;</span><span style=color:#666>+</span>dish<span style=color:#666>.</span><span style=color:#7d9029>getStatus</span><span style=color:#666>();</span>
        <span style=color:#408080;font-style:italic>//1.从redis中获得缓存数据
</span><span style=color:#408080;font-style:italic></span>        dishDtoList <span style=color:#666>=</span> <span style=color:#666>(</span>List<span style=color:#666>&lt;</span>DishDto<span style=color:#666>&gt;)</span>  redisTemplate<span style=color:#666>.</span><span style=color:#7d9029>opsForValue</span><span style=color:#666>().</span><span style=color:#7d9029>get</span><span style=color:#666>(</span>key<span style=color:#666>);</span>
        <span style=color:#408080;font-style:italic>//2.判断是否存在缓存
</span><span style=color:#408080;font-style:italic></span>        <span style=color:green;font-weight:700>if</span> <span style=color:#666>(</span>dishDtoList <span style=color:#666>!=</span><span style=color:green;font-weight:700>null</span><span style=color:#666>){</span>
            <span style=color:green;font-weight:700>return</span> R<span style=color:#666>.</span><span style=color:#7d9029>success</span><span style=color:#666>(</span>dishDtoList<span style=color:#666>);</span>
        <span style=color:#666>}</span>

        <span style=color:#408080;font-style:italic>//构造查询条件
</span><span style=color:#408080;font-style:italic></span>        LambdaQueryWrapper<span style=color:#666>&lt;</span>Dish<span style=color:#666>&gt;</span> queryWrapper <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> LambdaQueryWrapper<span style=color:#666>&lt;&gt;();</span>
        queryWrapper<span style=color:#666>.</span><span style=color:#7d9029>eq</span><span style=color:#666>(</span>dish<span style=color:#666>.</span><span style=color:#7d9029>getCategoryId</span><span style=color:#666>()</span> <span style=color:#666>!=</span> <span style=color:green;font-weight:700>null</span> <span style=color:#666>,</span>Dish<span style=color:#666>::</span>getCategoryId<span style=color:#666>,</span>dish<span style=color:#666>.</span><span style=color:#7d9029>getCategoryId</span><span style=color:#666>());</span>
        <span style=color:#408080;font-style:italic>//添加条件，查询状态为1（起售状态）的菜品
</span><span style=color:#408080;font-style:italic></span>        queryWrapper<span style=color:#666>.</span><span style=color:#7d9029>eq</span><span style=color:#666>(</span>Dish<span style=color:#666>::</span>getStatus<span style=color:#666>,</span>1<span style=color:#666>);</span>

        <span style=color:#408080;font-style:italic>//添加排序条件
</span><span style=color:#408080;font-style:italic></span>        queryWrapper<span style=color:#666>.</span><span style=color:#7d9029>orderByAsc</span><span style=color:#666>(</span>Dish<span style=color:#666>::</span>getSort<span style=color:#666>).</span><span style=color:#7d9029>orderByDesc</span><span style=color:#666>(</span>Dish<span style=color:#666>::</span>getUpdateTime<span style=color:#666>);</span>

        List<span style=color:#666>&lt;</span>Dish<span style=color:#666>&gt;</span> list <span style=color:#666>=</span> <span style=color:green;font-weight:700>this</span><span style=color:#666>.</span><span style=color:#7d9029>list</span><span style=color:#666>(</span>queryWrapper<span style=color:#666>);</span>

       dishDtoList <span style=color:#666>=</span> list<span style=color:#666>.</span><span style=color:#7d9029>stream</span><span style=color:#666>().</span><span style=color:#7d9029>map</span><span style=color:#666>((</span>item<span style=color:#666>)</span> <span style=color:#666>-&gt;</span> <span style=color:#666>{</span>
            DishDto dishDto <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> DishDto<span style=color:#666>();</span>

            BeanUtils<span style=color:#666>.</span><span style=color:#7d9029>copyProperties</span><span style=color:#666>(</span>item<span style=color:#666>,</span>dishDto<span style=color:#666>);</span>

            Long categoryId <span style=color:#666>=</span> item<span style=color:#666>.</span><span style=color:#7d9029>getCategoryId</span><span style=color:#666>();</span><span style=color:#408080;font-style:italic>//分类id
</span><span style=color:#408080;font-style:italic></span>            <span style=color:#408080;font-style:italic>//根据id查询分类对象
</span><span style=color:#408080;font-style:italic></span>            Category category <span style=color:#666>=</span> categoryService<span style=color:#666>.</span><span style=color:#7d9029>getById</span><span style=color:#666>(</span>categoryId<span style=color:#666>);</span>

            <span style=color:green;font-weight:700>if</span><span style=color:#666>(</span>category <span style=color:#666>!=</span> <span style=color:green;font-weight:700>null</span><span style=color:#666>){</span>
                String categoryName <span style=color:#666>=</span> category<span style=color:#666>.</span><span style=color:#7d9029>getName</span><span style=color:#666>();</span>
                dishDto<span style=color:#666>.</span><span style=color:#7d9029>setCategoryName</span><span style=color:#666>(</span>categoryName<span style=color:#666>);</span>
            <span style=color:#666>}</span>

            <span style=color:#408080;font-style:italic>//当前菜品的id
</span><span style=color:#408080;font-style:italic></span>            Long dishId <span style=color:#666>=</span> item<span style=color:#666>.</span><span style=color:#7d9029>getId</span><span style=color:#666>();</span>
            LambdaQueryWrapper<span style=color:#666>&lt;</span>DishFlavor<span style=color:#666>&gt;</span> lambdaQueryWrapper <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> LambdaQueryWrapper<span style=color:#666>&lt;&gt;();</span>
            lambdaQueryWrapper<span style=color:#666>.</span><span style=color:#7d9029>eq</span><span style=color:#666>(</span>DishFlavor<span style=color:#666>::</span>getDishId<span style=color:#666>,</span>dishId<span style=color:#666>);</span>
            <span style=color:#408080;font-style:italic>//SQL:select * from dish_flavor where dish_id = ?
</span><span style=color:#408080;font-style:italic></span>            List<span style=color:#666>&lt;</span>DishFlavor<span style=color:#666>&gt;</span> dishFlavorList <span style=color:#666>=</span> dishFlavorService<span style=color:#666>.</span><span style=color:#7d9029>list</span><span style=color:#666>(</span>lambdaQueryWrapper<span style=color:#666>);</span>
            dishDto<span style=color:#666>.</span><span style=color:#7d9029>setFlavors</span><span style=color:#666>(</span>dishFlavorList<span style=color:#666>);</span>
            <span style=color:green;font-weight:700>return</span> dishDto<span style=color:#666>;</span>
        <span style=color:#666>}).</span><span style=color:#7d9029>collect</span><span style=color:#666>(</span>Collectors<span style=color:#666>.</span><span style=color:#7d9029>toList</span><span style=color:#666>());</span>
       <span style=color:#408080;font-style:italic>//3.保存查询信息到缓存
</span><span style=color:#408080;font-style:italic></span>        redisTemplate<span style=color:#666>.</span><span style=color:#7d9029>opsForValue</span><span style=color:#666>().</span><span style=color:#7d9029>set</span><span style=color:#666>(</span>key<span style=color:#666>,</span>dishDtoList<span style=color:#666>,</span>60<span style=color:#666>,</span> TimeUnit<span style=color:#666>.</span><span style=color:#7d9029>MINUTES</span><span style=color:#666>);</span>

        <span style=color:green;font-weight:700>return</span> R<span style=color:#666>.</span><span style=color:#7d9029>success</span><span style=color:#666>(</span>dishDtoList<span style=color:#666>);</span>
    <span style=color:#666>}</span>

    <span style=color:#a2f>@Override</span>
    <span style=color:green;font-weight:700>public</span> R<span style=color:#666>&lt;</span>Page<span style=color:#666>&gt;</span> <span style=color:#00f>pagedish</span><span style=color:#666>(</span><span style=color:#b00040>int</span> page<span style=color:#666>,</span> <span style=color:#b00040>int</span> pageSize<span style=color:#666>,</span> String name<span style=color:#666>)</span> <span style=color:#666>{</span>

        <span style=color:#408080;font-style:italic>//构造分页构造器对象
</span><span style=color:#408080;font-style:italic></span>        Page<span style=color:#666>&lt;</span>Dish<span style=color:#666>&gt;</span> pageInfo <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> Page<span style=color:#666>&lt;&gt;(</span>page<span style=color:#666>,</span>pageSize<span style=color:#666>);</span>
        Page<span style=color:#666>&lt;</span>DishDto<span style=color:#666>&gt;</span> dishDtoPage <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> Page<span style=color:#666>&lt;&gt;();</span>
        <span style=color:#408080;font-style:italic>//此时也不能直接保存dishdto，因为没有值
</span><span style=color:#408080;font-style:italic></span>        <span style=color:#408080;font-style:italic>//所以将dish执行qw的值后拷贝到DishDto之中
</span><span style=color:#408080;font-style:italic></span>
        <span style=color:#408080;font-style:italic>//条件构造器
</span><span style=color:#408080;font-style:italic></span>        LambdaQueryWrapper<span style=color:#666>&lt;</span>Dish<span style=color:#666>&gt;</span> queryWrapper <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> LambdaQueryWrapper<span style=color:#666>&lt;&gt;();</span>
        <span style=color:#408080;font-style:italic>//添加过滤条件
</span><span style=color:#408080;font-style:italic></span>        queryWrapper<span style=color:#666>.</span><span style=color:#7d9029>like</span><span style=color:#666>(</span>name <span style=color:#666>!=</span> <span style=color:green;font-weight:700>null</span><span style=color:#666>,</span>Dish<span style=color:#666>::</span>getName<span style=color:#666>,</span>name<span style=color:#666>);</span>
        <span style=color:#408080;font-style:italic>//添加排序条件
</span><span style=color:#408080;font-style:italic></span>        queryWrapper<span style=color:#666>.</span><span style=color:#7d9029>orderByDesc</span><span style=color:#666>(</span>Dish<span style=color:#666>::</span>getUpdateTime<span style=color:#666>);</span>

        <span style=color:#408080;font-style:italic>//执行分页查询
</span><span style=color:#408080;font-style:italic></span>        <span style=color:green;font-weight:700>this</span><span style=color:#666>.</span><span style=color:#7d9029>page</span><span style=color:#666>(</span>pageInfo<span style=color:#666>,</span>queryWrapper<span style=color:#666>);</span>

        <span style=color:#408080;font-style:italic>//对象拷贝
</span><span style=color:#408080;font-style:italic></span>        <span style=color:#408080;font-style:italic>//copyProperties 拷贝属性，元，不拷集合（集合是显示在页面的，我们要处理）
</span><span style=color:#408080;font-style:italic></span>        BeanUtils<span style=color:#666>.</span><span style=color:#7d9029>copyProperties</span><span style=color:#666>(</span>pageInfo<span style=color:#666>,</span>dishDtoPage<span style=color:#666>,</span><span style=color:#ba2121>&#34;records&#34;</span><span style=color:#666>);</span>
        <span style=color:#408080;font-style:italic>//以下是处理list
</span><span style=color:#408080;font-style:italic></span>        List<span style=color:#666>&lt;</span>Dish<span style=color:#666>&gt;</span> records <span style=color:#666>=</span> pageInfo<span style=color:#666>.</span><span style=color:#7d9029>getRecords</span><span style=color:#666>();</span>
        List<span style=color:#666>&lt;</span>DishDto<span style=color:#666>&gt;</span> list<span style=color:#666>=</span> records<span style=color:#666>.</span><span style=color:#7d9029>stream</span><span style=color:#666>().</span><span style=color:#7d9029>map</span><span style=color:#666>((</span>item<span style=color:#666>)-&gt;{</span>
            DishDto dishDto <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> DishDto<span style=color:#666>();</span>
            BeanUtils<span style=color:#666>.</span><span style=color:#7d9029>copyProperties</span><span style=color:#666>(</span>item<span style=color:#666>,</span>dishDto<span style=color:#666>);</span>
            Long categoryId <span style=color:#666>=</span> item<span style=color:#666>.</span><span style=color:#7d9029>getCategoryId</span><span style=color:#666>();</span><span style=color:#408080;font-style:italic>//分类id
</span><span style=color:#408080;font-style:italic></span>            <span style=color:#408080;font-style:italic>//根据id查询分类对象
</span><span style=color:#408080;font-style:italic></span>            Category category <span style=color:#666>=</span> categoryService<span style=color:#666>.</span><span style=color:#7d9029>getById</span><span style=color:#666>(</span>categoryId<span style=color:#666>);</span>
            String categoryname <span style=color:#666>=</span> category<span style=color:#666>.</span><span style=color:#7d9029>getName</span><span style=color:#666>();</span>
            dishDto<span style=color:#666>.</span><span style=color:#7d9029>setCategoryName</span><span style=color:#666>(</span>categoryname<span style=color:#666>);</span>
            <span style=color:green;font-weight:700>return</span> dishDto<span style=color:#666>;</span>

        <span style=color:#666>}).</span><span style=color:#7d9029>collect</span><span style=color:#666>(</span>Collectors<span style=color:#666>.</span><span style=color:#7d9029>toList</span><span style=color:#666>());</span>

        dishDtoPage<span style=color:#666>.</span><span style=color:#7d9029>setRecords</span><span style=color:#666>(</span>list<span style=color:#666>);</span>
        <span style=color:green;font-weight:700>return</span> R<span style=color:#666>.</span><span style=color:#7d9029>success</span><span style=color:#666>(</span>dishDtoPage<span style=color:#666>);</span>
    <span style=color:#666>}</span>

<span style=color:#666>}</span>

</code></pre></div><h2 id=11套餐管理sringcache>11.套餐管理（sringcache)<a href=#11套餐管理sringcache class=header-anchor arialabel=Anchor> #</a></h2><h4 id=1-spring-cache的配置>1 .spring cache的配置<a href=#1-spring-cache的配置 class=header-anchor arialabel=Anchor> #</a></h4><div class=highlight><pre style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span>#</span> 1<span style=color:#666>.</span><span style=color:#7d9029>导入依赖</span>
    
 <span style=color:#666>&lt;</span>dependency<span style=color:#666>&gt;</span>
     <span style=color:#666>&lt;</span>groupId<span style=color:#666>&gt;</span>org<span style=color:#666>.</span><span style=color:#7d9029>springframework</span><span style=color:#666>.</span><span style=color:#7d9029>boot</span><span style=color:#666>&lt;/</span>groupId<span style=color:#666>&gt;</span>
     <span style=color:#666>&lt;</span>artifactId<span style=color:#666>&gt;</span>spring<span style=color:#666>-</span>boot<span style=color:#666>-</span>starter<span style=color:#666>-</span>cache<span style=color:#666>&lt;/</span>artifactId<span style=color:#666>&gt;</span>
 <span style=color:#666>&lt;/</span>dependency<span style=color:#666>&gt;</span>

 <span style=color:#666>&lt;</span>dependency<span style=color:#666>&gt;</span>
     <span style=color:#666>&lt;</span>groupId<span style=color:#666>&gt;</span>org<span style=color:#666>.</span><span style=color:#7d9029>springframework</span><span style=color:#666>.</span><span style=color:#7d9029>boot</span><span style=color:#666>&lt;/</span>groupId<span style=color:#666>&gt;</span>
     <span style=color:#666>&lt;</span>artifactId<span style=color:#666>&gt;</span>spring<span style=color:#666>-</span>boot<span style=color:#666>-</span>starter<span style=color:#666>-</span>data<span style=color:#666>-</span>redis<span style=color:#666>&lt;/</span>artifactId<span style=color:#666>&gt;</span>
 <span style=color:#666>&lt;/</span>dependency<span style=color:#666>&gt;</span>
    
<span>#</span>2<span style=color:#666>.</span> yaml配置
spring <span style=color:#666>:</span> 
     cache<span style=color:#666>:</span>
        redis<span style=color:#666>:</span>
             time<span style=color:#666>-</span>to<span style=color:#666>-</span>live<span style=color:#666>:</span> 1800000 <span>#</span>设置缓存有效期


<span>#</span>3<span style=color:#666>.</span><span style=color:#7d9029>项目上加入注解</span><span style=color:#a2f>@EnableCaching</span>
<span>#</span>4<span style=color:#666>.</span><span style=color:#7d9029>在controller方法上加入cacheabl</span><span style=color:#666>,</span>方法<span style=color:#a2f>@cacheEvict</span><span>，</span>进行缓存操作

</code></pre></div><h4 id=2setmealcontroller>2.SetmealController<a href=#2setmealcontroller class=header-anchor arialabel=Anchor> #</a></h4><div class=highlight><pre style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#408080;font-style:italic>/**
</span><span style=color:#408080;font-style:italic> * 套餐管理
</span><span style=color:#408080;font-style:italic> */</span>

<span style=color:#a2f>@RestController</span>
<span style=color:#a2f>@RequestMapping</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;/setmeal&#34;</span><span style=color:#666>)</span>
<span style=color:#a2f>@Slf4j</span>
<span style=color:green;font-weight:700>public</span> <span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>SetmealController</span> <span style=color:#666>{</span>

    <span style=color:#a2f>@Autowired</span>
    <span style=color:green;font-weight:700>private</span> SetmealService setmealService<span style=color:#666>;</span>

    <span style=color:#408080;font-style:italic>/**
</span><span style=color:#408080;font-style:italic>     * 新增套餐
</span><span style=color:#408080;font-style:italic>     * @param setmealDto
</span><span style=color:#408080;font-style:italic>     * @return
</span><span style=color:#408080;font-style:italic>     */</span>
    <span style=color:#a2f>@PostMapping</span>
    <span style=color:#a2f>@CacheEvict</span><span style=color:#666>(</span>value <span style=color:#666>=</span> <span style=color:#ba2121>&#34;setmealCache&#34;</span><span style=color:#666>,</span>allEntries <span style=color:#666>=</span> <span style=color:green;font-weight:700>true</span><span style=color:#666>)</span>
    <span style=color:green;font-weight:700>public</span> R<span style=color:#666>&lt;</span>String<span style=color:#666>&gt;</span> <span style=color:#00f>save</span><span style=color:#666>(</span><span style=color:#a2f>@RequestBody</span> SetmealDto setmealDto<span style=color:#666>){</span>
        log<span style=color:#666>.</span><span style=color:#7d9029>info</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;套餐信息：{}&#34;</span><span style=color:#666>,</span>setmealDto<span style=color:#666>);</span>

        setmealService<span style=color:#666>.</span><span style=color:#7d9029>saveWithDish</span><span style=color:#666>(</span>setmealDto<span style=color:#666>);</span>

        <span style=color:green;font-weight:700>return</span> R<span style=color:#666>.</span><span style=color:#7d9029>success</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;新增套餐成功&#34;</span><span style=color:#666>);</span>
    <span style=color:#666>}</span>

    <span style=color:#408080;font-style:italic>/**
</span><span style=color:#408080;font-style:italic>     * 套餐分页查询
</span><span style=color:#408080;font-style:italic>     * @param page
</span><span style=color:#408080;font-style:italic>     * @param pageSize
</span><span style=color:#408080;font-style:italic>     * @param name
</span><span style=color:#408080;font-style:italic>     * @return
</span><span style=color:#408080;font-style:italic>     */</span>
    <span style=color:#a2f>@GetMapping</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;/page&#34;</span><span style=color:#666>)</span>
    <span style=color:green;font-weight:700>public</span> R<span style=color:#666>&lt;</span>Page<span style=color:#666>&gt;</span> <span style=color:#00f>page</span><span style=color:#666>(</span><span style=color:#b00040>int</span> page<span style=color:#666>,</span><span style=color:#b00040>int</span> pageSize<span style=color:#666>,</span>String name<span style=color:#666>){</span>
      <span style=color:green;font-weight:700>return</span> setmealService<span style=color:#666>.</span><span style=color:#7d9029>pagesetmeal</span><span style=color:#666>(</span>page<span style=color:#666>,</span>pageSize<span style=color:#666>,</span>name<span style=color:#666>);</span>
    <span style=color:#666>}</span>

    <span style=color:#408080;font-style:italic>/**
</span><span style=color:#408080;font-style:italic>     * 删除套餐
</span><span style=color:#408080;font-style:italic>     * @param ids
</span><span style=color:#408080;font-style:italic>     * @return
</span><span style=color:#408080;font-style:italic>     */</span>
    <span style=color:#a2f>@DeleteMapping</span>
    <span style=color:#a2f>@CacheEvict</span><span style=color:#666>(</span>value <span style=color:#666>=</span> <span style=color:#ba2121>&#34;setmealCache&#34;</span><span style=color:#666>,</span>allEntries <span style=color:#666>=</span> <span style=color:green;font-weight:700>true</span><span style=color:#666>)</span>
    <span style=color:green;font-weight:700>public</span> R<span style=color:#666>&lt;</span>String<span style=color:#666>&gt;</span> <span style=color:#00f>delete</span><span style=color:#666>(</span><span style=color:#a2f>@RequestParam</span> List<span style=color:#666>&lt;</span>Long<span style=color:#666>&gt;</span> ids<span style=color:#666>){</span>
        log<span style=color:#666>.</span><span style=color:#7d9029>info</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;ids:{}&#34;</span><span style=color:#666>,</span>ids<span style=color:#666>);</span>

        setmealService<span style=color:#666>.</span><span style=color:#7d9029>removeWithDish</span><span style=color:#666>(</span>ids<span style=color:#666>);</span>

        <span style=color:green;font-weight:700>return</span> R<span style=color:#666>.</span><span style=color:#7d9029>success</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;套餐数据删除成功&#34;</span><span style=color:#666>);</span>
    <span style=color:#666>}</span>


    <span style=color:#a2f>@GetMapping</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;/list&#34;</span><span style=color:#666>)</span>
    <span style=color:#a2f>@CacheEvict</span><span style=color:#666>(</span>value<span style=color:#666>=</span><span style=color:#ba2121>&#34;setmealCache&#34;</span><span style=color:#666>,</span>key<span style=color:#666>=</span><span style=color:#ba2121>&#34;#setmeal.categoryId+&#39;_&#39;+#setmeal.status&#34;</span><span style=color:#666>)</span>
    <span style=color:green;font-weight:700>public</span> R<span style=color:#666>&lt;</span>List<span style=color:#666>&lt;</span>Setmeal<span style=color:#666>&gt;&gt;</span> <span style=color:#00f>list</span><span style=color:#666>(</span>Setmeal setmeal<span style=color:#666>)</span> <span style=color:#666>{</span>
        log<span style=color:#666>.</span><span style=color:#7d9029>info</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;setmeal:{}&#34;</span><span style=color:#666>,</span> setmeal<span style=color:#666>);</span>
        <span style=color:#408080;font-style:italic>//条件构造器
</span><span style=color:#408080;font-style:italic></span>        LambdaQueryWrapper<span style=color:#666>&lt;</span>Setmeal<span style=color:#666>&gt;</span> queryWrapper <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> LambdaQueryWrapper<span style=color:#666>&lt;&gt;();</span>
        queryWrapper<span style=color:#666>.</span><span style=color:#7d9029>like</span><span style=color:#666>(</span>StringUtils<span style=color:#666>.</span><span style=color:#7d9029>isNotEmpty</span><span style=color:#666>(</span>setmeal<span style=color:#666>.</span><span style=color:#7d9029>getName</span><span style=color:#666>()),</span> Setmeal<span style=color:#666>::</span>getName<span style=color:#666>,</span> setmeal<span style=color:#666>.</span><span style=color:#7d9029>getName</span><span style=color:#666>());</span>
        queryWrapper<span style=color:#666>.</span><span style=color:#7d9029>eq</span><span style=color:#666>(</span><span style=color:green;font-weight:700>null</span> <span style=color:#666>!=</span> setmeal<span style=color:#666>.</span><span style=color:#7d9029>getCategoryId</span><span style=color:#666>(),</span> Setmeal<span style=color:#666>::</span>getCategoryId<span style=color:#666>,</span> setmeal<span style=color:#666>.</span><span style=color:#7d9029>getCategoryId</span><span style=color:#666>());</span>
        queryWrapper<span style=color:#666>.</span><span style=color:#7d9029>eq</span><span style=color:#666>(</span><span style=color:green;font-weight:700>null</span> <span style=color:#666>!=</span> setmeal<span style=color:#666>.</span><span style=color:#7d9029>getStatus</span><span style=color:#666>(),</span> Setmeal<span style=color:#666>::</span>getStatus<span style=color:#666>,</span> setmeal<span style=color:#666>.</span><span style=color:#7d9029>getStatus</span><span style=color:#666>());</span>
        queryWrapper<span style=color:#666>.</span><span style=color:#7d9029>orderByDesc</span><span style=color:#666>(</span>Setmeal<span style=color:#666>::</span>getUpdateTime<span style=color:#666>);</span>
        List<span style=color:#666>&lt;</span>Setmeal<span style=color:#666>&gt;</span> list<span style=color:#666>=</span>setmealService<span style=color:#666>.</span><span style=color:#7d9029>list</span><span style=color:#666>(</span>queryWrapper<span style=color:#666>);</span>

        <span style=color:green;font-weight:700>return</span> R<span style=color:#666>.</span><span style=color:#7d9029>success</span><span style=color:#666>(</span>list<span style=color:#666>);</span>
    <span style=color:#666>}</span>
    <span style=color:#408080;font-style:italic>/**
</span><span style=color:#408080;font-style:italic>     单个/批量修改套餐状态
</span><span style=color:#408080;font-style:italic>     */</span>
    <span style=color:#a2f>@PostMapping</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;/status/{status}&#34;</span><span style=color:#666>)</span>
    <span style=color:green;font-weight:700>public</span> R<span style=color:#666>&lt;</span>String<span style=color:#666>&gt;</span> <span style=color:#00f>steamlstatuschange</span><span style=color:#666>(</span><span style=color:#a2f>@PathVariable</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;status&#34;</span><span style=color:#666>)</span> Integer status<span style=color:#666>,</span><span style=color:#a2f>@RequestParam</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;ids&#34;</span><span style=color:#666>)</span> List<span style=color:#666>&lt;</span>Long<span style=color:#666>&gt;</span> ids<span style=color:#666>){</span>

        setmealService<span style=color:#666>.</span><span style=color:#7d9029>statuschange</span><span style=color:#666>(</span>status<span style=color:#666>,</span>ids<span style=color:#666>);</span>
        <span style=color:green;font-weight:700>return</span> R<span style=color:#666>.</span><span style=color:#7d9029>success</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;修改套餐状态成功&#34;</span><span style=color:#666>);</span>
    <span style=color:#666>}</span>
    <span style=color:#a2f>@GetMapping</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;/{id}&#34;</span><span style=color:#666>)</span>
    <span style=color:green;font-weight:700>public</span> R<span style=color:#666>&lt;</span>SetmealDto<span style=color:#666>&gt;</span> <span style=color:#00f>listid</span><span style=color:#666>(</span><span style=color:#a2f>@PathVariable</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;id&#34;</span><span style=color:#666>)</span> Long id<span style=color:#666>)</span> <span style=color:#666>{</span>
       SetmealDto setmealDto<span style=color:#666>=</span> setmealService<span style=color:#666>.</span><span style=color:#7d9029>getDate</span><span style=color:#666>(</span>id<span style=color:#666>);</span>
        <span style=color:green;font-weight:700>return</span> R<span style=color:#666>.</span><span style=color:#7d9029>success</span><span style=color:#666>(</span>setmealDto<span style=color:#666>);</span>

    <span style=color:#666>}</span>

<span style=color:#666>}</span>

</code></pre></div><h4 id=3思路>3.思路<a href=#3思路 class=header-anchor arialabel=Anchor> #</a></h4><blockquote><p>修改删除停售启售</p></blockquote><h4 id=4代码实现-1>4.代码实现<a href=#4代码实现-1 class=header-anchor arialabel=Anchor> #</a></h4><div class=highlight><pre style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>
<span style=color:#a2f>@Service</span>
<span style=color:#a2f>@Slf4j</span>

<span style=color:green;font-weight:700>public</span> <span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>SetmealServiceImpl</span> <span style=color:green;font-weight:700>extends</span> ServiceImpl<span style=color:#666>&lt;</span>SetmealMapper<span style=color:#666>,</span>
        Setmeal<span style=color:#666>&gt;</span> <span style=color:green;font-weight:700>implements</span> SetmealService <span style=color:#666>{</span>
    <span style=color:#a2f>@Autowired</span>
    <span style=color:green;font-weight:700>private</span> SetmealDishService setmealDishService<span style=color:#666>;</span>
     <span style=color:#a2f>@Autowired</span>
      <span style=color:#a2f>@lazy</span>
    <span style=color:green;font-weight:700>private</span> CategoryService categoryService<span style=color:#666>;</span>

    <span style=color:#408080;font-style:italic>/**
</span><span style=color:#408080;font-style:italic>     * 新增套餐，同时需要保存套餐和菜品发关系
</span><span style=color:#408080;font-style:italic>     * @param setmealDto
</span><span style=color:#408080;font-style:italic>     */</span>
    <span style=color:#a2f>@Transactional</span>
    <span style=color:green;font-weight:700>public</span> <span style=color:#b00040>void</span> <span style=color:#00f>saveWithDish</span><span style=color:#666>(</span>SetmealDto setmealDto<span style=color:#666>){</span>
        <span style=color:#408080;font-style:italic>//保存stteaml基本信息，操作steaml，执行inset操作
</span><span style=color:#408080;font-style:italic></span>        <span style=color:green;font-weight:700>this</span><span style=color:#666>.</span><span style=color:#7d9029>save</span><span style=color:#666>(</span>setmealDto<span style=color:#666>);</span>
        List<span style=color:#666>&lt;</span>SetmealDish<span style=color:#666>&gt;</span> setmealDishes <span style=color:#666>=</span> setmealDto<span style=color:#666>.</span><span style=color:#7d9029>getSetmealDishes</span><span style=color:#666>();</span>
        <span style=color:#408080;font-style:italic>//注意此时的setmealDishes的属性setMealId没有值，dishId存在值
</span><span style=color:#408080;font-style:italic></span>        setmealDishes<span style=color:#666>.</span><span style=color:#7d9029>stream</span><span style=color:#666>().</span><span style=color:#7d9029>map</span><span style=color:#666>((</span>item<span style=color:#666>)-&gt;{</span>
            item<span style=color:#666>.</span><span style=color:#7d9029>setSetmealId</span><span style=color:#666>(</span>setmealDto<span style=color:#666>.</span><span style=color:#7d9029>getId</span><span style=color:#666>());</span>
            <span style=color:green;font-weight:700>return</span> item<span style=color:#666>;</span>
        <span style=color:#666>}).</span><span style=color:#7d9029>collect</span><span style=color:#666>(</span>Collectors<span style=color:#666>.</span><span style=color:#7d9029>toList</span><span style=color:#666>());</span>
        <span style=color:#408080;font-style:italic>//保存套餐和菜品的关联信息，执行sttmeal dish的inset;
</span><span style=color:#408080;font-style:italic></span>        setmealDishService<span style=color:#666>.</span><span style=color:#7d9029>saveBatch</span><span style=color:#666>(</span>setmealDishes<span style=color:#666>);</span>
    <span style=color:#666>}</span>

    <span style=color:#408080;font-style:italic>/**
</span><span style=color:#408080;font-style:italic>     * 删除菜单也需要从删除关系表
</span><span style=color:#408080;font-style:italic>     * 还要先判断状态
</span><span style=color:#408080;font-style:italic>     * @param ids
</span><span style=color:#408080;font-style:italic>     */</span>

    <span style=color:#a2f>@Override</span>
    <span style=color:#a2f>@Transactional</span>
    <span style=color:green;font-weight:700>public</span> <span style=color:#b00040>void</span> <span style=color:#00f>removeWithDish</span><span style=color:#666>(</span>List<span style=color:#666>&lt;</span>Long<span style=color:#666>&gt;</span> ids<span style=color:#666>)</span> <span style=color:#666>{</span>
        <span style=color:#408080;font-style:italic>//select count(*) from setmeal where id in (1,2,3) and status = 1
</span><span style=color:#408080;font-style:italic></span>        <span style=color:#408080;font-style:italic>//查询套餐状态，确定是否可用删除
</span><span style=color:#408080;font-style:italic></span>        LambdaQueryWrapper<span style=color:#666>&lt;</span>Setmeal<span style=color:#666>&gt;</span> queryWrapper <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> LambdaQueryWrapper<span style=color:#666>();</span>
        queryWrapper<span style=color:#666>.</span><span style=color:#7d9029>in</span><span style=color:#666>(</span>Setmeal<span style=color:#666>::</span>getId<span style=color:#666>,</span>ids<span style=color:#666>);</span>
        queryWrapper<span style=color:#666>.</span><span style=color:#7d9029>eq</span><span style=color:#666>(</span>Setmeal<span style=color:#666>::</span>getStatus<span style=color:#666>,</span>1<span style=color:#666>);</span>

        <span style=color:#b00040>int</span> count <span style=color:#666>=</span> <span style=color:green;font-weight:700>this</span><span style=color:#666>.</span><span style=color:#7d9029>count</span><span style=color:#666>(</span>queryWrapper<span style=color:#666>);</span>
        <span style=color:green;font-weight:700>if</span><span style=color:#666>(</span>count <span style=color:#666>&gt;</span> 0<span style=color:#666>){</span>
            <span style=color:#408080;font-style:italic>//如果不能删除，抛出一个业务异常
</span><span style=color:#408080;font-style:italic></span>            <span style=color:green;font-weight:700>throw</span> <span style=color:green;font-weight:700>new</span> CustomException<span style=color:#666>(</span><span style=color:#ba2121>&#34;套餐正在售卖中，不能删除&#34;</span><span style=color:#666>);</span>
        <span style=color:#666>}</span>

        <span style=color:#408080;font-style:italic>//如果可以删除，先删除套餐表中的数据---setmeal
</span><span style=color:#408080;font-style:italic></span>        <span style=color:green;font-weight:700>this</span><span style=color:#666>.</span><span style=color:#7d9029>removeByIds</span><span style=color:#666>(</span>ids<span style=color:#666>);</span>

        <span style=color:#408080;font-style:italic>//delete from setmeal_dish where setmeal_id in (1,2,3)
</span><span style=color:#408080;font-style:italic></span>        <span style=color:#408080;font-style:italic>//找到套餐关系表的id然后删除
</span><span style=color:#408080;font-style:italic></span>        LambdaQueryWrapper<span style=color:#666>&lt;</span>SetmealDish<span style=color:#666>&gt;</span> lambdaQueryWrapper <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> LambdaQueryWrapper<span style=color:#666>&lt;&gt;();</span>
        lambdaQueryWrapper<span style=color:#666>.</span><span style=color:#7d9029>in</span><span style=color:#666>(</span>SetmealDish<span style=color:#666>::</span>getSetmealId<span style=color:#666>,</span>ids<span style=color:#666>);</span>
        <span style=color:#408080;font-style:italic>//删除关系表中的数据----setmeal_dish
</span><span style=color:#408080;font-style:italic></span>        setmealDishService<span style=color:#666>.</span><span style=color:#7d9029>remove</span><span style=color:#666>(</span>lambdaQueryWrapper<span style=color:#666>);</span>

    <span style=color:#666>}</span>

    <span style=color:#a2f>@Override</span>
    <span style=color:green;font-weight:700>public</span> <span style=color:#b00040>void</span> <span style=color:#00f>statuschange</span><span style=color:#666>(</span>Integer status<span style=color:#666>,</span> List<span style=color:#666>&lt;</span>Long<span style=color:#666>&gt;</span> ids<span style=color:#666>)</span> <span style=color:#666>{</span>
        <span style=color:#408080;font-style:italic>//1.根据ids找到对应的套餐
</span><span style=color:#408080;font-style:italic></span>        LambdaQueryWrapper<span style=color:#666>&lt;</span>Setmeal<span style=color:#666>&gt;</span> queryWrapper <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> LambdaQueryWrapper<span style=color:#666>&lt;&gt;();</span>
        queryWrapper<span style=color:#666>.</span><span style=color:#7d9029>in</span><span style=color:#666>(</span>ids <span style=color:#666>!=</span><span style=color:green;font-weight:700>null</span><span style=color:#666>,</span>Setmeal<span style=color:#666>::</span>getId<span style=color:#666>,</span>ids<span style=color:#666>);</span>
        List<span style=color:#666>&lt;</span>Setmeal<span style=color:#666>&gt;</span> list <span style=color:#666>=</span> <span style=color:green;font-weight:700>this</span><span style=color:#666>.</span><span style=color:#7d9029>list</span><span style=color:#666>(</span>queryWrapper<span style=color:#666>);</span>
        <span style=color:green;font-weight:700>for</span> <span style=color:#666>(</span>Setmeal setmeal<span style=color:#666>:</span>list<span style=color:#666>)</span> <span style=color:#666>{</span>
            <span style=color:green;font-weight:700>if</span> <span style=color:#666>(</span>setmeal<span style=color:#666>!=</span><span style=color:green;font-weight:700>null</span><span style=color:#666>){</span>
               setmeal<span style=color:#666>.</span><span style=color:#7d9029>setStatus</span><span style=color:#666>(</span>status<span style=color:#666>);</span>
               <span style=color:green;font-weight:700>this</span><span style=color:#666>.</span><span style=color:#7d9029>updateById</span><span style=color:#666>(</span>setmeal<span style=color:#666>);</span>
            <span style=color:#666>}</span>
        <span style=color:#666>}</span>

    <span style=color:#666>}</span>

    <span style=color:#a2f>@Override</span>
    <span style=color:green;font-weight:700>public</span> SetmealDto <span style=color:#00f>getDate</span><span style=color:#666>(</span>Long id<span style=color:#666>)</span> <span style=color:#666>{</span>
        <span style=color:#408080;font-style:italic>//1.根据传给的套餐id进行数据的回显
</span><span style=color:#408080;font-style:italic></span>        Setmeal setmeal <span style=color:#666>=</span> <span style=color:green;font-weight:700>this</span><span style=color:#666>.</span><span style=color:#7d9029>getById</span><span style=color:#666>(</span>id<span style=color:#666>);</span>
        SetmealDto setmealDto <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> SetmealDto<span style=color:#666>();</span>
        BeanUtil<span style=color:#666>.</span><span style=color:#7d9029>copyProperties</span><span style=color:#666>(</span>setmeal<span style=color:#666>,</span>setmealDto<span style=color:#666>);</span>
        LambdaQueryWrapper<span style=color:#666>&lt;</span>SetmealDish<span style=color:#666>&gt;</span> queryWrapper <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> LambdaQueryWrapper<span style=color:#666>&lt;&gt;();</span>
        queryWrapper<span style=color:#666>.</span><span style=color:#7d9029>eq</span><span style=color:#666>(</span>SetmealDish<span style=color:#666>::</span>getSetmealId<span style=color:#666>,</span>id<span style=color:#666>);</span>
        List<span style=color:#666>&lt;</span>SetmealDish<span style=color:#666>&gt;</span> list <span style=color:#666>=</span> setmealDishService<span style=color:#666>.</span><span style=color:#7d9029>list</span><span style=color:#666>(</span>queryWrapper<span style=color:#666>);</span>
        setmealDto<span style=color:#666>.</span><span style=color:#7d9029>setSetmealDishes</span><span style=color:#666>(</span>list<span style=color:#666>);</span>
        <span style=color:green;font-weight:700>return</span> setmealDto<span style=color:#666>;</span>
    <span style=color:#666>}</span>

    <span style=color:#a2f>@Override</span>
    <span style=color:green;font-weight:700>public</span> R<span style=color:#666>&lt;</span>Page<span style=color:#666>&gt;</span> <span style=color:#00f>pagesetmeal</span><span style=color:#666>(</span><span style=color:#b00040>int</span> page<span style=color:#666>,</span> <span style=color:#b00040>int</span> pageSize<span style=color:#666>,</span> String name<span style=color:#666>)</span> <span style=color:#666>{</span>
        <span style=color:#408080;font-style:italic>//分页构造器对象
</span><span style=color:#408080;font-style:italic></span>        Page<span style=color:#666>&lt;</span>Setmeal<span style=color:#666>&gt;</span> pageInfo <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> Page<span style=color:#666>&lt;&gt;(</span>page<span style=color:#666>,</span>pageSize<span style=color:#666>);</span>
        Page<span style=color:#666>&lt;</span>SetmealDto<span style=color:#666>&gt;</span> dtoPage <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> Page<span style=color:#666>&lt;&gt;();</span>

        LambdaQueryWrapper<span style=color:#666>&lt;</span>Setmeal<span style=color:#666>&gt;</span> queryWrapper <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> LambdaQueryWrapper<span style=color:#666>&lt;&gt;();</span>
        <span style=color:#408080;font-style:italic>//添加查询条件，根据name进行like模糊查询
</span><span style=color:#408080;font-style:italic></span>        queryWrapper<span style=color:#666>.</span><span style=color:#7d9029>like</span><span style=color:#666>(</span>name <span style=color:#666>!=</span> <span style=color:green;font-weight:700>null</span><span style=color:#666>,</span>Setmeal<span style=color:#666>::</span>getName<span style=color:#666>,</span>name<span style=color:#666>);</span>
        <span style=color:#408080;font-style:italic>//添加排序条件，根据更新时间降序排列
</span><span style=color:#408080;font-style:italic></span>        queryWrapper<span style=color:#666>.</span><span style=color:#7d9029>orderByDesc</span><span style=color:#666>(</span>Setmeal<span style=color:#666>::</span>getUpdateTime<span style=color:#666>);</span>

        <span style=color:green;font-weight:700>this</span><span style=color:#666>.</span><span style=color:#7d9029>page</span><span style=color:#666>(</span>pageInfo<span style=color:#666>,</span>queryWrapper<span style=color:#666>);</span>

        <span style=color:#408080;font-style:italic>//对象拷贝
</span><span style=color:#408080;font-style:italic></span>        BeanUtils<span style=color:#666>.</span><span style=color:#7d9029>copyProperties</span><span style=color:#666>(</span>pageInfo<span style=color:#666>,</span>dtoPage<span style=color:#666>,</span><span style=color:#ba2121>&#34;records&#34;</span><span style=color:#666>);</span>
        List<span style=color:#666>&lt;</span>Setmeal<span style=color:#666>&gt;</span> records <span style=color:#666>=</span> pageInfo<span style=color:#666>.</span><span style=color:#7d9029>getRecords</span><span style=color:#666>();</span>

        List<span style=color:#666>&lt;</span>SetmealDto<span style=color:#666>&gt;</span> list <span style=color:#666>=</span> records<span style=color:#666>.</span><span style=color:#7d9029>stream</span><span style=color:#666>().</span><span style=color:#7d9029>map</span><span style=color:#666>((</span>item<span style=color:#666>)</span> <span style=color:#666>-&gt;</span> <span style=color:#666>{</span>
            SetmealDto setmealDto <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> SetmealDto<span style=color:#666>();</span>
            <span style=color:#408080;font-style:italic>//对象拷贝
</span><span style=color:#408080;font-style:italic></span>            BeanUtils<span style=color:#666>.</span><span style=color:#7d9029>copyProperties</span><span style=color:#666>(</span>item<span style=color:#666>,</span>setmealDto<span style=color:#666>);</span>
            <span style=color:#408080;font-style:italic>//分类id
</span><span style=color:#408080;font-style:italic></span>            Long categoryId <span style=color:#666>=</span> item<span style=color:#666>.</span><span style=color:#7d9029>getCategoryId</span><span style=color:#666>();</span>
            <span style=color:#408080;font-style:italic>//根据分类id查询分类对象
</span><span style=color:#408080;font-style:italic></span>            Category category <span style=color:#666>=</span> categoryService<span style=color:#666>.</span><span style=color:#7d9029>getById</span><span style=color:#666>(</span>categoryId<span style=color:#666>);</span>
            <span style=color:green;font-weight:700>if</span><span style=color:#666>(</span>category <span style=color:#666>!=</span> <span style=color:green;font-weight:700>null</span><span style=color:#666>){</span>
                <span style=color:#408080;font-style:italic>//分类名称
</span><span style=color:#408080;font-style:italic></span>                String categoryName <span style=color:#666>=</span> category<span style=color:#666>.</span><span style=color:#7d9029>getName</span><span style=color:#666>();</span>
                setmealDto<span style=color:#666>.</span><span style=color:#7d9029>setCategoryName</span><span style=color:#666>(</span>categoryName<span style=color:#666>);</span>
            <span style=color:#666>}</span>
            <span style=color:green;font-weight:700>return</span> setmealDto<span style=color:#666>;</span>
        <span style=color:#666>}).</span><span style=color:#7d9029>collect</span><span style=color:#666>(</span>Collectors<span style=color:#666>.</span><span style=color:#7d9029>toList</span><span style=color:#666>());</span>

        dtoPage<span style=color:#666>.</span><span style=color:#7d9029>setRecords</span><span style=color:#666>(</span>list<span style=color:#666>);</span>
        <span style=color:green;font-weight:700>return</span> R<span style=color:#666>.</span><span style=color:#7d9029>success</span><span style=color:#666>(</span>dtoPage<span style=color:#666>);</span>
    <span style=color:#666>}</span>
<span style=color:#666>}</span>

</code></pre></div><h2 id=12移动端地址>12.移动端地址<a href=#12移动端地址 class=header-anchor arialabel=Anchor> #</a></h2><h4 id=1addressbookcontroller>1.AddressBookController<a href=#1addressbookcontroller class=header-anchor arialabel=Anchor> #</a></h4><div class=highlight><pre style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#408080;font-style:italic>/**
</span><span style=color:#408080;font-style:italic> * 地址簿管理
</span><span style=color:#408080;font-style:italic> */</span>
<span style=color:#a2f>@Slf4j</span>
<span style=color:#a2f>@RestController</span>
<span style=color:#a2f>@RequestMapping</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;/addressBook&#34;</span><span style=color:#666>)</span>
<span style=color:green;font-weight:700>public</span> <span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>AddressBookController</span> <span style=color:#666>{</span>

    <span style=color:#a2f>@Autowired</span>
    <span style=color:green;font-weight:700>private</span> AddressBookService addressBookService<span style=color:#666>;</span>

    <span style=color:#408080;font-style:italic>/**
</span><span style=color:#408080;font-style:italic>     * 新增
</span><span style=color:#408080;font-style:italic>     */</span>
    <span style=color:#a2f>@PostMapping</span>
    <span style=color:green;font-weight:700>public</span> R<span style=color:#666>&lt;</span>AddressBook<span style=color:#666>&gt;</span> <span style=color:#00f>save</span><span style=color:#666>(</span><span style=color:#a2f>@RequestBody</span> AddressBook addressBook<span style=color:#666>)</span> <span style=color:#666>{</span>
        addressBook<span style=color:#666>.</span><span style=color:#7d9029>setUserId</span><span style=color:#666>(</span>BaseContext<span style=color:#666>.</span><span style=color:#7d9029>getCurrentId</span><span style=color:#666>());</span>
        log<span style=color:#666>.</span><span style=color:#7d9029>info</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;addressBook:{}&#34;</span><span style=color:#666>,</span> addressBook<span style=color:#666>);</span>
        addressBookService<span style=color:#666>.</span><span style=color:#7d9029>save</span><span style=color:#666>(</span>addressBook<span style=color:#666>);</span>
        <span style=color:green;font-weight:700>return</span> R<span style=color:#666>.</span><span style=color:#7d9029>success</span><span style=color:#666>(</span>addressBook<span style=color:#666>);</span>
    <span style=color:#666>}</span>

    <span style=color:#408080;font-style:italic>/**
</span><span style=color:#408080;font-style:italic>     * 设置默认地址
</span><span style=color:#408080;font-style:italic>     */</span>
    <span style=color:#a2f>@PutMapping</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;default&#34;</span><span style=color:#666>)</span>
    <span style=color:green;font-weight:700>public</span> R<span style=color:#666>&lt;</span>AddressBook<span style=color:#666>&gt;</span> <span style=color:#00f>setDefault</span><span style=color:#666>(</span><span style=color:#a2f>@RequestBody</span> AddressBook addressBook<span style=color:#666>)</span> <span style=color:#666>{</span>
        log<span style=color:#666>.</span><span style=color:#7d9029>info</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;addressBook:{}&#34;</span><span style=color:#666>,</span> addressBook<span style=color:#666>);</span>
        LambdaUpdateWrapper<span style=color:#666>&lt;</span>AddressBook<span style=color:#666>&gt;</span> wrapper <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> LambdaUpdateWrapper<span style=color:#666>&lt;&gt;();</span>
        wrapper<span style=color:#666>.</span><span style=color:#7d9029>eq</span><span style=color:#666>(</span>AddressBook<span style=color:#666>::</span>getUserId<span style=color:#666>,</span> BaseContext<span style=color:#666>.</span><span style=color:#7d9029>getCurrentId</span><span style=color:#666>());</span>
        wrapper<span style=color:#666>.</span><span style=color:#7d9029>set</span><span style=color:#666>(</span>AddressBook<span style=color:#666>::</span>getIsDefault<span style=color:#666>,</span> 0<span style=color:#666>);</span>
        <span style=color:#408080;font-style:italic>//SQL:update address_book set is_default = 0 where user_id = ?
</span><span style=color:#408080;font-style:italic></span>        addressBookService<span style=color:#666>.</span><span style=color:#7d9029>update</span><span style=color:#666>(</span>wrapper<span style=color:#666>);</span>

        addressBook<span style=color:#666>.</span><span style=color:#7d9029>setIsDefault</span><span style=color:#666>(</span>1<span style=color:#666>);</span>
        <span style=color:#408080;font-style:italic>//SQL:update address_book set is_default = 1 where id = ?
</span><span style=color:#408080;font-style:italic></span>        addressBookService<span style=color:#666>.</span><span style=color:#7d9029>updateById</span><span style=color:#666>(</span>addressBook<span style=color:#666>);</span>
        <span style=color:green;font-weight:700>return</span> R<span style=color:#666>.</span><span style=color:#7d9029>success</span><span style=color:#666>(</span>addressBook<span style=color:#666>);</span>
    <span style=color:#666>}</span>

    <span style=color:#408080;font-style:italic>/**
</span><span style=color:#408080;font-style:italic>     * 根据id查询地址
</span><span style=color:#408080;font-style:italic>     */</span>
    <span style=color:#a2f>@GetMapping</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;/{id}&#34;</span><span style=color:#666>)</span>
    <span style=color:green;font-weight:700>public</span> R <span style=color:#00f>get</span><span style=color:#666>(</span><span style=color:#a2f>@PathVariable</span> Long id<span style=color:#666>)</span> <span style=color:#666>{</span>
        AddressBook addressBook <span style=color:#666>=</span> addressBookService<span style=color:#666>.</span><span style=color:#7d9029>getById</span><span style=color:#666>(</span>id<span style=color:#666>);</span>
        <span style=color:green;font-weight:700>if</span> <span style=color:#666>(</span>addressBook <span style=color:#666>!=</span> <span style=color:green;font-weight:700>null</span><span style=color:#666>)</span> <span style=color:#666>{</span>
            <span style=color:green;font-weight:700>return</span> R<span style=color:#666>.</span><span style=color:#7d9029>success</span><span style=color:#666>(</span>addressBook<span style=color:#666>);</span>
        <span style=color:#666>}</span> <span style=color:green;font-weight:700>else</span> <span style=color:#666>{</span>
            <span style=color:green;font-weight:700>return</span> R<span style=color:#666>.</span><span style=color:#7d9029>error</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;没有找到该对象&#34;</span><span style=color:#666>);</span>
        <span style=color:#666>}</span>
    <span style=color:#666>}</span>

    <span style=color:#408080;font-style:italic>/**
</span><span style=color:#408080;font-style:italic>     * 查询默认地址
</span><span style=color:#408080;font-style:italic>     */</span>
    <span style=color:#a2f>@GetMapping</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;default&#34;</span><span style=color:#666>)</span>
    <span style=color:green;font-weight:700>public</span> R<span style=color:#666>&lt;</span>AddressBook<span style=color:#666>&gt;</span> <span style=color:#00f>getDefault</span><span style=color:#666>()</span> <span style=color:#666>{</span>
        LambdaQueryWrapper<span style=color:#666>&lt;</span>AddressBook<span style=color:#666>&gt;</span> queryWrapper <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> LambdaQueryWrapper<span style=color:#666>&lt;&gt;();</span>
        queryWrapper<span style=color:#666>.</span><span style=color:#7d9029>eq</span><span style=color:#666>(</span>AddressBook<span style=color:#666>::</span>getUserId<span style=color:#666>,</span> BaseContext<span style=color:#666>.</span><span style=color:#7d9029>getCurrentId</span><span style=color:#666>());</span>
        queryWrapper<span style=color:#666>.</span><span style=color:#7d9029>eq</span><span style=color:#666>(</span>AddressBook<span style=color:#666>::</span>getIsDefault<span style=color:#666>,</span> 1<span style=color:#666>);</span>

        <span style=color:#408080;font-style:italic>//SQL:select * from address_book where user_id = ? and is_default = 1
</span><span style=color:#408080;font-style:italic></span>        AddressBook addressBook <span style=color:#666>=</span> addressBookService<span style=color:#666>.</span><span style=color:#7d9029>getOne</span><span style=color:#666>(</span>queryWrapper<span style=color:#666>);</span>

        <span style=color:green;font-weight:700>if</span> <span style=color:#666>(</span><span style=color:green;font-weight:700>null</span> <span style=color:#666>==</span> addressBook<span style=color:#666>)</span> <span style=color:#666>{</span>
            <span style=color:green;font-weight:700>return</span> R<span style=color:#666>.</span><span style=color:#7d9029>error</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;没有找到该对象&#34;</span><span style=color:#666>);</span>
        <span style=color:#666>}</span> <span style=color:green;font-weight:700>else</span> <span style=color:#666>{</span>
            <span style=color:green;font-weight:700>return</span> R<span style=color:#666>.</span><span style=color:#7d9029>success</span><span style=color:#666>(</span>addressBook<span style=color:#666>);</span>
        <span style=color:#666>}</span>
    <span style=color:#666>}</span>

    <span style=color:#408080;font-style:italic>/**
</span><span style=color:#408080;font-style:italic>     * 查询指定用户的全部地址
</span><span style=color:#408080;font-style:italic>     */</span>
    <span style=color:#a2f>@GetMapping</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;/list&#34;</span><span style=color:#666>)</span>
    <span style=color:green;font-weight:700>public</span> R<span style=color:#666>&lt;</span>List<span style=color:#666>&lt;</span>AddressBook<span style=color:#666>&gt;&gt;</span> <span style=color:#00f>list</span><span style=color:#666>(</span>AddressBook addressBook<span style=color:#666>)</span> <span style=color:#666>{</span>
        addressBook<span style=color:#666>.</span><span style=color:#7d9029>setUserId</span><span style=color:#666>(</span>BaseContext<span style=color:#666>.</span><span style=color:#7d9029>getCurrentId</span><span style=color:#666>());</span>
        log<span style=color:#666>.</span><span style=color:#7d9029>info</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;addressBook:{}&#34;</span><span style=color:#666>,</span> addressBook<span style=color:#666>);</span>

        <span style=color:#408080;font-style:italic>//条件构造器
</span><span style=color:#408080;font-style:italic></span>        LambdaQueryWrapper<span style=color:#666>&lt;</span>AddressBook<span style=color:#666>&gt;</span> queryWrapper <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> LambdaQueryWrapper<span style=color:#666>&lt;&gt;();</span>
        queryWrapper<span style=color:#666>.</span><span style=color:#7d9029>eq</span><span style=color:#666>(</span><span style=color:green;font-weight:700>null</span> <span style=color:#666>!=</span> addressBook<span style=color:#666>.</span><span style=color:#7d9029>getUserId</span><span style=color:#666>(),</span> AddressBook<span style=color:#666>::</span>getUserId<span style=color:#666>,</span> addressBook<span style=color:#666>.</span><span style=color:#7d9029>getUserId</span><span style=color:#666>());</span>
        queryWrapper<span style=color:#666>.</span><span style=color:#7d9029>orderByDesc</span><span style=color:#666>(</span>AddressBook<span style=color:#666>::</span>getUpdateTime<span style=color:#666>);</span>

        <span style=color:#408080;font-style:italic>//SQL:select * from address_book where user_id = ? order by update_time desc
</span><span style=color:#408080;font-style:italic></span>        <span style=color:green;font-weight:700>return</span> R<span style=color:#666>.</span><span style=color:#7d9029>success</span><span style=color:#666>(</span>addressBookService<span style=color:#666>.</span><span style=color:#7d9029>list</span><span style=color:#666>(</span>queryWrapper<span style=color:#666>));</span>
    <span style=color:#666>}</span>

    <span style=color:#408080;font-style:italic>/**
</span><span style=color:#408080;font-style:italic>     * 删除地址
</span><span style=color:#408080;font-style:italic>     * @param ids
</span><span style=color:#408080;font-style:italic>     * @return
</span><span style=color:#408080;font-style:italic>     */</span>
    <span style=color:#a2f>@DeleteMapping</span>
    <span style=color:green;font-weight:700>public</span> R<span style=color:#666>&lt;</span>String<span style=color:#666>&gt;</span> <span style=color:#00f>delete</span><span style=color:#666>(</span><span style=color:#a2f>@RequestParam</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;ids&#34;</span><span style=color:#666>)</span> Long ids<span style=color:#666>){</span>
        <span style=color:green;font-weight:700>return</span> addressBookService<span style=color:#666>.</span><span style=color:#7d9029>deletad</span><span style=color:#666>(</span>ids<span style=color:#666>);</span>
    <span style=color:#666>}</span>

    <span style=color:#408080;font-style:italic>/**
</span><span style=color:#408080;font-style:italic>     * 修改地址
</span><span style=color:#408080;font-style:italic>     * @param addressBook
</span><span style=color:#408080;font-style:italic>     * @return
</span><span style=color:#408080;font-style:italic>     */</span>
    <span style=color:#a2f>@PutMapping</span>
    <span style=color:green;font-weight:700>public</span> R<span style=color:#666>&lt;</span>String<span style=color:#666>&gt;</span> <span style=color:#00f>edit</span><span style=color:#666>(</span><span style=color:#a2f>@RequestBody</span> AddressBook addressBook<span style=color:#666>){</span>
        <span style=color:green;font-weight:700>if</span> <span style=color:#666>(</span>addressBook <span style=color:#666>==</span><span style=color:green;font-weight:700>null</span><span style=color:#666>){</span>
            <span style=color:green;font-weight:700>return</span> R<span style=color:#666>.</span><span style=color:#7d9029>error</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;请求异常&#34;</span><span style=color:#666>);</span>
        <span style=color:#666>}</span>
        addressBookService<span style=color:#666>.</span><span style=color:#7d9029>updateById</span><span style=color:#666>(</span>addressBook<span style=color:#666>);</span>
        <span style=color:green;font-weight:700>return</span> R<span style=color:#666>.</span><span style=color:#7d9029>success</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;地址修改成功&#34;</span><span style=color:#666>);</span>

    <span style=color:#666>}</span>


<span style=color:#666>}</span>

</code></pre></div><h4 id=2addressbookserviceimpl>2.AddressBookServiceImpl<a href=#2addressbookserviceimpl class=header-anchor arialabel=Anchor> #</a></h4><div class=highlight><pre style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#a2f>@Service</span>
<span style=color:green;font-weight:700>public</span> <span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>AddressBookServiceImpl</span> <span style=color:green;font-weight:700>extends</span> ServiceImpl
        <span style=color:#666>&lt;</span>AddressBookMapper<span style=color:#666>,</span> AddressBook<span style=color:#666>&gt;</span> <span style=color:green;font-weight:700>implements</span> AddressBookService <span style=color:#666>{</span>

    <span style=color:#a2f>@Override</span>
    <span style=color:green;font-weight:700>public</span> R<span style=color:#666>&lt;</span>String<span style=color:#666>&gt;</span> <span style=color:#00f>deletad</span><span style=color:#666>(</span>Long ids<span style=color:#666>)</span> <span style=color:#666>{</span>
        <span style=color:#408080;font-style:italic>//1.得到ids，删除地址
</span><span style=color:#408080;font-style:italic></span>        <span style=color:green;font-weight:700>if</span> <span style=color:#666>(</span>ids <span style=color:#666>==</span> <span style=color:green;font-weight:700>null</span><span style=color:#666>){</span>
            <span style=color:green;font-weight:700>return</span> R<span style=color:#666>.</span><span style=color:#7d9029>error</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;请求异常&#34;</span><span style=color:#666>);</span>
        <span style=color:#666>}</span>
        LambdaQueryWrapper<span style=color:#666>&lt;</span>AddressBook<span style=color:#666>&gt;</span> queryWrapper <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> LambdaQueryWrapper<span style=color:#666>&lt;&gt;();</span>
        queryWrapper<span style=color:#666>.</span><span style=color:#7d9029>eq</span><span style=color:#666>(</span>AddressBook<span style=color:#666>::</span>getId<span style=color:#666>,</span>ids<span style=color:#666>).</span><span style=color:#7d9029>eq</span><span style=color:#666>(</span>AddressBook<span style=color:#666>::</span>getUserId<span style=color:#666>,</span> BaseContext<span style=color:#666>.</span><span style=color:#7d9029>getCurrentId</span><span style=color:#666>());</span>
        <span style=color:green;font-weight:700>this</span><span style=color:#666>.</span><span style=color:#7d9029>remove</span><span style=color:#666>(</span>queryWrapper<span style=color:#666>);</span>
        <span style=color:green;font-weight:700>return</span> R<span style=color:#666>.</span><span style=color:#7d9029>success</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;删除地址成功&#34;</span><span style=color:#666>);</span>


    <span style=color:#666>}</span>
<span style=color:#666>}</span>

</code></pre></div><h2 id=13购物车开发>13.购物车开发<a href=#13购物车开发 class=header-anchor arialabel=Anchor> #</a></h2><h4 id=1shoppingcartcontroller>1.ShoppingCartController<a href=#1shoppingcartcontroller class=header-anchor arialabel=Anchor> #</a></h4><div class=highlight><pre style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>
<span style=color:#408080;font-style:italic>/**
</span><span style=color:#408080;font-style:italic> * 购物车
</span><span style=color:#408080;font-style:italic> */</span>
<span style=color:#a2f>@Slf4j</span>
<span style=color:#a2f>@RestController</span>
<span style=color:#a2f>@RequestMapping</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;/shoppingCart&#34;</span><span style=color:#666>)</span>
<span style=color:green;font-weight:700>public</span> <span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>ShoppingCartController</span> <span style=color:#666>{</span>

    <span style=color:#a2f>@Autowired</span>
    <span style=color:green;font-weight:700>private</span> ShoppingCartService shoppingCartService<span style=color:#666>;</span>

    <span style=color:#408080;font-style:italic>/**
</span><span style=color:#408080;font-style:italic>     * 添加购物车
</span><span style=color:#408080;font-style:italic>     * @param shoppingCart
</span><span style=color:#408080;font-style:italic>     * @return
</span><span style=color:#408080;font-style:italic>     */</span>
    <span style=color:#a2f>@PostMapping</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;/add&#34;</span><span style=color:#666>)</span>
    <span style=color:green;font-weight:700>public</span> R<span style=color:#666>&lt;</span>ShoppingCart<span style=color:#666>&gt;</span> <span style=color:#00f>add</span><span style=color:#666>(</span><span style=color:#a2f>@RequestBody</span> ShoppingCart shoppingCart<span style=color:#666>){</span>
        log<span style=color:#666>.</span><span style=color:#7d9029>info</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;购物车数据:{}&#34;</span><span style=color:#666>,</span>shoppingCart<span style=color:#666>);</span>

        <span style=color:green;font-weight:700>return</span> shoppingCartService<span style=color:#666>.</span><span style=color:#7d9029>addcart</span><span style=color:#666>(</span>shoppingCart<span style=color:#666>);</span>
    <span style=color:#666>}</span>

    <span style=color:#408080;font-style:italic>/**
</span><span style=color:#408080;font-style:italic>     * 查看购物车
</span><span style=color:#408080;font-style:italic>     * @return
</span><span style=color:#408080;font-style:italic>     */</span>
    <span style=color:#a2f>@GetMapping</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;/list&#34;</span><span style=color:#666>)</span>
    <span style=color:green;font-weight:700>public</span> R<span style=color:#666>&lt;</span>List<span style=color:#666>&lt;</span>ShoppingCart<span style=color:#666>&gt;&gt;</span> <span style=color:#00f>list</span><span style=color:#666>(){</span>
        log<span style=color:#666>.</span><span style=color:#7d9029>info</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;查看购物车...&#34;</span><span style=color:#666>);</span>

        LambdaQueryWrapper<span style=color:#666>&lt;</span>ShoppingCart<span style=color:#666>&gt;</span> queryWrapper <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> LambdaQueryWrapper<span style=color:#666>&lt;&gt;();</span>
        queryWrapper<span style=color:#666>.</span><span style=color:#7d9029>eq</span><span style=color:#666>(</span>ShoppingCart<span style=color:#666>::</span>getUserId<span style=color:#666>,</span>BaseContext<span style=color:#666>.</span><span style=color:#7d9029>getCurrentId</span><span style=color:#666>());</span>
        queryWrapper<span style=color:#666>.</span><span style=color:#7d9029>orderByAsc</span><span style=color:#666>(</span>ShoppingCart<span style=color:#666>::</span>getCreateTime<span style=color:#666>);</span>

        List<span style=color:#666>&lt;</span>ShoppingCart<span style=color:#666>&gt;</span> list <span style=color:#666>=</span> shoppingCartService<span style=color:#666>.</span><span style=color:#7d9029>list</span><span style=color:#666>(</span>queryWrapper<span style=color:#666>);</span>

        <span style=color:green;font-weight:700>return</span> R<span style=color:#666>.</span><span style=color:#7d9029>success</span><span style=color:#666>(</span>list<span style=color:#666>);</span>
    <span style=color:#666>}</span>

    <span style=color:#408080;font-style:italic>/**
</span><span style=color:#408080;font-style:italic>     * 清空购物车
</span><span style=color:#408080;font-style:italic>     * @return
</span><span style=color:#408080;font-style:italic>     */</span>
    <span style=color:#a2f>@DeleteMapping</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;/clean&#34;</span><span style=color:#666>)</span>
    <span style=color:green;font-weight:700>public</span> R<span style=color:#666>&lt;</span>String<span style=color:#666>&gt;</span> <span style=color:#00f>clean</span><span style=color:#666>(){</span>
        <span style=color:#408080;font-style:italic>//SQL:delete from shopping_cart where user_id = ?
</span><span style=color:#408080;font-style:italic></span>        shoppingCartService<span style=color:#666>.</span><span style=color:#7d9029>clean</span><span style=color:#666>();</span>


        <span style=color:green;font-weight:700>return</span> R<span style=color:#666>.</span><span style=color:#7d9029>success</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;清空购物车成功&#34;</span><span style=color:#666>);</span>
    <span style=color:#666>}</span>
    
    <span style=color:#a2f>@PostMapping</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;/sub&#34;</span><span style=color:#666>)</span>
    <span style=color:green;font-weight:700>public</span> R<span style=color:#666>&lt;</span>ShoppingCart<span style=color:#666>&gt;</span> <span style=color:#00f>sub</span><span style=color:#666>(</span><span style=color:#a2f>@RequestBody</span> ShoppingCart shoppingCart<span style=color:#666>){</span>

        <span style=color:green;font-weight:700>return</span> shoppingCartService<span style=color:#666>.</span><span style=color:#7d9029>sub</span><span style=color:#666>(</span>shoppingCart<span style=color:#666>);</span>

    <span style=color:#666>}</span>

<span style=color:#666>}</span>
</code></pre></div><h4 id=2代码实现-1>2.代码实现<a href=#2代码实现-1 class=header-anchor arialabel=Anchor> #</a></h4><div class=highlight><pre style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#a2f>@Service</span>
<span style=color:green;font-weight:700>public</span> <span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>ShoppingCartServiceImpl</span> <span style=color:green;font-weight:700>extends</span> ServiceImpl<span style=color:#666>&lt;</span>ShoppingCartMapper<span style=color:#666>,</span> ShoppingCart<span style=color:#666>&gt;</span> <span style=color:green;font-weight:700>implements</span> ShoppingCartService <span style=color:#666>{</span>
    
    <span style=color:#a2f>@Override</span>
    <span style=color:green;font-weight:700>public</span> R<span style=color:#666>&lt;</span>ShoppingCart<span style=color:#666>&gt;</span> <span style=color:#00f>sub</span><span style=color:#666>(</span>ShoppingCart shoppingCart<span style=color:#666>)</span> <span style=color:#666>{</span>
        <span style=color:#408080;font-style:italic>//找到购物车的id,根据购物车找到
</span><span style=color:#408080;font-style:italic></span>        Long shoppingCartId <span style=color:#666>=</span> shoppingCart<span style=color:#666>.</span><span style=color:#7d9029>getId</span><span style=color:#666>();</span>
        LambdaQueryWrapper<span style=color:#666>&lt;</span>ShoppingCart<span style=color:#666>&gt;</span> queryWrapper <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> LambdaQueryWrapper<span style=color:#666>&lt;&gt;();</span>
        <span style=color:green;font-weight:700>if</span> <span style=color:#666>(</span>shoppingCart<span style=color:#666>.</span><span style=color:#7d9029>getDishId</span><span style=color:#666>()</span> <span style=color:#666>!=</span><span style=color:green;font-weight:700>null</span><span style=color:#666>)</span> <span style=color:#666>{</span>

            <span style=color:#408080;font-style:italic>//查询条件
</span><span style=color:#408080;font-style:italic></span>            queryWrapper<span style=color:#666>.</span><span style=color:#7d9029>eq</span><span style=color:#666>(</span>ShoppingCart<span style=color:#666>::</span>getDishId<span style=color:#666>,</span> shoppingCart<span style=color:#666>.</span><span style=color:#7d9029>getDishId</span><span style=color:#666>())</span>
                    <span style=color:#666>.</span><span style=color:#7d9029>eq</span><span style=color:#666>(</span>ShoppingCart<span style=color:#666>::</span>getUserId<span style=color:#666>,</span> BaseContext<span style=color:#666>.</span><span style=color:#7d9029>getCurrentId</span><span style=color:#666>());</span>
            <span style=color:#408080;font-style:italic>//这里必须要加两个条件，否则会出现用户互相修改对方与自己购物车中相同套餐或者是菜品的数量
</span><span style=color:#408080;font-style:italic></span>            ShoppingCart cart1 <span style=color:#666>=</span> <span style=color:green;font-weight:700>this</span><span style=color:#666>.</span><span style=color:#7d9029>getOne</span><span style=color:#666>(</span>queryWrapper<span style=color:#666>);</span>
            cart1<span style=color:#666>.</span><span style=color:#7d9029>setNumber</span><span style=color:#666>(</span>cart1<span style=color:#666>.</span><span style=color:#7d9029>getNumber</span><span style=color:#666>()-</span>1<span style=color:#666>);</span>
            Integer number <span style=color:#666>=</span> cart1<span style=color:#666>.</span><span style=color:#7d9029>getNumber</span><span style=color:#666>();</span>
            <span style=color:green;font-weight:700>if</span> <span style=color:#666>(</span>number <span style=color:#666>&gt;</span>0<span style=color:#666>){</span>
                <span style=color:#408080;font-style:italic>//更新
</span><span style=color:#408080;font-style:italic></span>                <span style=color:green;font-weight:700>this</span><span style=color:#666>.</span><span style=color:#7d9029>updateById</span><span style=color:#666>(</span>cart1<span style=color:#666>);</span>
            <span style=color:#666>}</span><span style=color:green;font-weight:700>else</span> <span style=color:green;font-weight:700>if</span> <span style=color:#666>(</span>number<span style=color:#666>==</span>0<span style=color:#666>){</span>
                <span style=color:green;font-weight:700>this</span><span style=color:#666>.</span><span style=color:#7d9029>removeById</span><span style=color:#666>(</span>cart1<span style=color:#666>.</span><span style=color:#7d9029>getId</span><span style=color:#666>());</span>
            <span style=color:#666>}</span><span style=color:green;font-weight:700>else</span> <span style=color:#666>{</span>
                R<span style=color:#666>.</span><span style=color:#7d9029>error</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;操作异常&#34;</span><span style=color:#666>);</span>
            <span style=color:#666>}</span>
            <span style=color:green;font-weight:700>return</span> R<span style=color:#666>.</span><span style=color:#7d9029>success</span><span style=color:#666>(</span>cart1<span style=color:#666>);</span>

        <span style=color:#666>}</span>

        Long setmealId <span style=color:#666>=</span> shoppingCart<span style=color:#666>.</span><span style=color:#7d9029>getSetmealId</span><span style=color:#666>();</span>
        <span style=color:green;font-weight:700>if</span> <span style=color:#666>(</span>setmealId <span style=color:#666>!=</span> <span style=color:green;font-weight:700>null</span><span style=color:#666>){</span>
            <span style=color:#408080;font-style:italic>//代表是套餐数量减少
</span><span style=color:#408080;font-style:italic></span>            queryWrapper<span style=color:#666>.</span><span style=color:#7d9029>eq</span><span style=color:#666>(</span>ShoppingCart<span style=color:#666>::</span>getSetmealId<span style=color:#666>,</span>setmealId<span style=color:#666>).</span><span style=color:#7d9029>eq</span><span style=color:#666>(</span>ShoppingCart<span style=color:#666>::</span>getUserId<span style=color:#666>,</span>BaseContext<span style=color:#666>.</span><span style=color:#7d9029>getCurrentId</span><span style=color:#666>());</span>
            ShoppingCart cart2 <span style=color:#666>=</span> <span style=color:green;font-weight:700>this</span><span style=color:#666>.</span><span style=color:#7d9029>getOne</span><span style=color:#666>(</span>queryWrapper<span style=color:#666>);</span>
            cart2<span style=color:#666>.</span><span style=color:#7d9029>setNumber</span><span style=color:#666>(</span>cart2<span style=color:#666>.</span><span style=color:#7d9029>getNumber</span><span style=color:#666>()-</span>1<span style=color:#666>);</span>
            Integer LatestNumber <span style=color:#666>=</span> cart2<span style=color:#666>.</span><span style=color:#7d9029>getNumber</span><span style=color:#666>();</span>
            <span style=color:green;font-weight:700>if</span> <span style=color:#666>(</span>LatestNumber <span style=color:#666>&gt;</span> 0<span style=color:#666>){</span>
                <span style=color:#408080;font-style:italic>//对数据进行更新操作
</span><span style=color:#408080;font-style:italic></span>                <span style=color:green;font-weight:700>this</span><span style=color:#666>.</span><span style=color:#7d9029>updateById</span><span style=color:#666>(</span>cart2<span style=color:#666>);</span>
            <span style=color:#666>}</span><span style=color:green;font-weight:700>else</span> <span style=color:green;font-weight:700>if</span><span style=color:#666>(</span>LatestNumber <span style=color:#666>==</span> 0<span style=color:#666>){</span>
                <span style=color:#408080;font-style:italic>//如果购物车的套餐数量减为0，那么就把套餐从购物车删除
</span><span style=color:#408080;font-style:italic></span>                <span style=color:green;font-weight:700>this</span><span style=color:#666>.</span><span style=color:#7d9029>removeById</span><span style=color:#666>(</span>cart2<span style=color:#666>.</span><span style=color:#7d9029>getId</span><span style=color:#666>());</span>
            <span style=color:#666>}</span><span style=color:green;font-weight:700>else</span> <span style=color:green;font-weight:700>if</span> <span style=color:#666>(</span>LatestNumber <span style=color:#666>&lt;</span> 0<span style=color:#666>){</span>
                <span style=color:green;font-weight:700>return</span> R<span style=color:#666>.</span><span style=color:#7d9029>error</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;操作异常&#34;</span><span style=color:#666>);</span>
            <span style=color:#666>}</span>
            <span style=color:green;font-weight:700>return</span> R<span style=color:#666>.</span><span style=color:#7d9029>success</span><span style=color:#666>(</span>cart2<span style=color:#666>);</span>
        <span style=color:#666>}</span>
        <span style=color:#408080;font-style:italic>//如果两个大if判断都进不去
</span><span style=color:#408080;font-style:italic></span>        <span style=color:green;font-weight:700>return</span> R<span style=color:#666>.</span><span style=color:#7d9029>error</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;操作异常&#34;</span><span style=color:#666>);</span>

    <span style=color:#666>}</span>

    <span style=color:#408080;font-style:italic>/**
</span><span style=color:#408080;font-style:italic>     * 清空购物车
</span><span style=color:#408080;font-style:italic>     */</span>
    <span style=color:#a2f>@Override</span>
    <span style=color:green;font-weight:700>public</span> <span style=color:#b00040>void</span> <span style=color:#00f>clean</span><span style=color:#666>()</span> <span style=color:#666>{</span>


        LambdaQueryWrapper<span style=color:#666>&lt;</span>ShoppingCart<span style=color:#666>&gt;</span> queryWrapper <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> LambdaQueryWrapper<span style=color:#666>&lt;&gt;();</span>
        queryWrapper<span style=color:#666>.</span><span style=color:#7d9029>eq</span><span style=color:#666>(</span>ShoppingCart<span style=color:#666>::</span>getUserId<span style=color:#666>,</span>BaseContext<span style=color:#666>.</span><span style=color:#7d9029>getCurrentId</span><span style=color:#666>());</span>
        <span style=color:green;font-weight:700>this</span><span style=color:#666>.</span><span style=color:#7d9029>remove</span><span style=color:#666>(</span>queryWrapper<span style=color:#666>);</span>
    <span style=color:#666>}</span>

    <span style=color:#a2f>@Override</span>
    <span style=color:green;font-weight:700>public</span> R<span style=color:#666>&lt;</span>ShoppingCart<span style=color:#666>&gt;</span> <span style=color:#00f>addcart</span><span style=color:#666>(</span>ShoppingCart shoppingCart<span style=color:#666>)</span> <span style=color:#666>{</span>


        <span style=color:#408080;font-style:italic>//设置用户id，指定当前是哪个用户的购物车数据
</span><span style=color:#408080;font-style:italic></span>        Long currentId <span style=color:#666>=</span> BaseContext<span style=color:#666>.</span><span style=color:#7d9029>getCurrentId</span><span style=color:#666>();</span>
        shoppingCart<span style=color:#666>.</span><span style=color:#7d9029>setUserId</span><span style=color:#666>(</span>currentId<span style=color:#666>);</span>

        Long dishId <span style=color:#666>=</span> shoppingCart<span style=color:#666>.</span><span style=color:#7d9029>getDishId</span><span style=color:#666>();</span>

        LambdaQueryWrapper<span style=color:#666>&lt;</span>ShoppingCart<span style=color:#666>&gt;</span> queryWrapper <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> LambdaQueryWrapper<span style=color:#666>&lt;&gt;();</span>
        queryWrapper<span style=color:#666>.</span><span style=color:#7d9029>eq</span><span style=color:#666>(</span>ShoppingCart<span style=color:#666>::</span>getUserId<span style=color:#666>,</span>currentId<span style=color:#666>);</span>

        <span style=color:green;font-weight:700>if</span><span style=color:#666>(</span>dishId <span style=color:#666>!=</span> <span style=color:green;font-weight:700>null</span><span style=color:#666>){</span>
            <span style=color:#408080;font-style:italic>//添加到购物车的是菜品
</span><span style=color:#408080;font-style:italic></span>            queryWrapper<span style=color:#666>.</span><span style=color:#7d9029>eq</span><span style=color:#666>(</span>ShoppingCart<span style=color:#666>::</span>getDishId<span style=color:#666>,</span>dishId<span style=color:#666>);</span>

        <span style=color:#666>}</span><span style=color:green;font-weight:700>else</span><span style=color:#666>{</span>
            <span style=color:#408080;font-style:italic>//添加到购物车的是套餐
</span><span style=color:#408080;font-style:italic></span>            queryWrapper<span style=color:#666>.</span><span style=color:#7d9029>eq</span><span style=color:#666>(</span>ShoppingCart<span style=color:#666>::</span>getSetmealId<span style=color:#666>,</span>shoppingCart<span style=color:#666>.</span><span style=color:#7d9029>getSetmealId</span><span style=color:#666>());</span>
        <span style=color:#666>}</span>

        <span style=color:#408080;font-style:italic>//查询当前菜品或者套餐是否在购物车中
</span><span style=color:#408080;font-style:italic></span>        <span style=color:#408080;font-style:italic>//SQL:select * from shopping_cart where user_id = ? and dish_id/setmeal_id = ?
</span><span style=color:#408080;font-style:italic></span>        ShoppingCart cartServiceOne <span style=color:#666>=</span> <span style=color:green;font-weight:700>this</span><span style=color:#666>.</span><span style=color:#7d9029>getOne</span><span style=color:#666>(</span>queryWrapper<span style=color:#666>);</span>

        <span style=color:green;font-weight:700>if</span><span style=color:#666>(</span>cartServiceOne <span style=color:#666>!=</span> <span style=color:green;font-weight:700>null</span><span style=color:#666>){</span>
            <span style=color:#408080;font-style:italic>//如果已经存在，就在原来数量基础上加一
</span><span style=color:#408080;font-style:italic></span>            Integer number <span style=color:#666>=</span> cartServiceOne<span style=color:#666>.</span><span style=color:#7d9029>getNumber</span><span style=color:#666>();</span>
            cartServiceOne<span style=color:#666>.</span><span style=color:#7d9029>setNumber</span><span style=color:#666>(</span>number <span style=color:#666>+</span> 1<span style=color:#666>);</span>
            <span style=color:green;font-weight:700>this</span><span style=color:#666>.</span><span style=color:#7d9029>updateById</span><span style=color:#666>(</span>cartServiceOne<span style=color:#666>);</span>
        <span style=color:#666>}</span><span style=color:green;font-weight:700>else</span><span style=color:#666>{</span>
            <span style=color:#408080;font-style:italic>//如果不存在，则添加到购物车，数量默认就是一
</span><span style=color:#408080;font-style:italic></span>            shoppingCart<span style=color:#666>.</span><span style=color:#7d9029>setNumber</span><span style=color:#666>(</span>1<span style=color:#666>);</span>
            shoppingCart<span style=color:#666>.</span><span style=color:#7d9029>setCreateTime</span><span style=color:#666>(</span>LocalDateTime<span style=color:#666>.</span><span style=color:#7d9029>now</span><span style=color:#666>());</span>
            <span style=color:green;font-weight:700>this</span><span style=color:#666>.</span><span style=color:#7d9029>save</span><span style=color:#666>(</span>shoppingCart<span style=color:#666>);</span>
            cartServiceOne <span style=color:#666>=</span> shoppingCart<span style=color:#666>;</span>
        <span style=color:#666>}</span>
        <span style=color:green;font-weight:700>return</span> R<span style=color:#666>.</span><span style=color:#7d9029>success</span><span style=color:#666>(</span>cartServiceOne<span style=color:#666>);</span>
    <span style=color:#666>}</span>
<span style=color:#666>}</span>

</code></pre></div><h2 id=14订单明细自写>14.订单明细（自写）<a href=#14订单明细自写 class=header-anchor arialabel=Anchor> #</a></h2><blockquote><p>数据库中的consignee是可以为null的，所以在后台代码中帮订单添加该属性的时候要判断是否null！然后就是去修改前端代码就行:
把72行的userName改成consignee就行</p></blockquote><h4 id=1-ordercontroller>1. OrderController<a href=#1-ordercontroller class=header-anchor arialabel=Anchor> #</a></h4><div class=highlight><pre style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#a2f>@Slf4j</span>
<span style=color:#a2f>@RestController</span>
<span style=color:#a2f>@RequestMapping</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;/order&#34;</span><span style=color:#666>)</span>
<span style=color:green;font-weight:700>public</span> <span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>OrderController</span> <span style=color:#666>{</span>

    <span style=color:#a2f>@Autowired</span>
    <span style=color:green;font-weight:700>private</span> OrderService orderService<span style=color:#666>;</span>

    <span style=color:#408080;font-style:italic>/**
</span><span style=color:#408080;font-style:italic>     * 用户下单
</span><span style=color:#408080;font-style:italic>     * @param orders
</span><span style=color:#408080;font-style:italic>     * @return
</span><span style=color:#408080;font-style:italic>     */</span>
    <span style=color:#a2f>@PostMapping</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;/submit&#34;</span><span style=color:#666>)</span>
    <span style=color:green;font-weight:700>public</span> R<span style=color:#666>&lt;</span>String<span style=color:#666>&gt;</span> <span style=color:#00f>submit</span><span style=color:#666>(</span><span style=color:#a2f>@RequestBody</span> Orders orders<span style=color:#666>){</span>
        log<span style=color:#666>.</span><span style=color:#7d9029>info</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;订单数据：{}&#34;</span><span style=color:#666>,</span>orders<span style=color:#666>);</span>
        orderService<span style=color:#666>.</span><span style=color:#7d9029>submit</span><span style=color:#666>(</span>orders<span style=color:#666>);</span>
        <span style=color:green;font-weight:700>return</span> R<span style=color:#666>.</span><span style=color:#7d9029>success</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;下单成功&#34;</span><span style=color:#666>);</span>
    <span style=color:#666>}</span>

    <span style=color:#408080;font-style:italic>/**
</span><span style=color:#408080;font-style:italic>     * 查询订单
</span><span style=color:#408080;font-style:italic>     * @param page
</span><span style=color:#408080;font-style:italic>     * @param pageSize
</span><span style=color:#408080;font-style:italic>     * @param number
</span><span style=color:#408080;font-style:italic>     * @param beginTime
</span><span style=color:#408080;font-style:italic>     * @param endTime
</span><span style=color:#408080;font-style:italic>     * @return
</span><span style=color:#408080;font-style:italic>     */</span>
    <span style=color:#a2f>@GetMapping</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;/page&#34;</span><span style=color:#666>)</span>
    <span style=color:green;font-weight:700>public</span> R<span style=color:#666>&lt;</span>Page<span style=color:#666>&gt;</span>  <span style=color:#00f>orderPage</span><span style=color:#666>(</span><span style=color:#b00040>int</span> page<span style=color:#666>,</span><span style=color:#b00040>int</span> pageSize<span style=color:#666>,</span>String number<span style=color:#666>,</span>String beginTime<span style=color:#666>,</span>String endTime <span style=color:#666>){</span>
        <span style=color:#408080;font-style:italic>//分页构造器对象
</span><span style=color:#408080;font-style:italic></span>       Page<span style=color:#666>&lt;</span>Orders<span style=color:#666>&gt;</span> pageInfo <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> Page<span style=color:#666>&lt;&gt;(</span>page<span style=color:#666>,</span> pageSize<span style=color:#666>);</span>
        <span style=color:#408080;font-style:italic>//构造条件查询对象
</span><span style=color:#408080;font-style:italic></span>        LambdaQueryWrapper<span style=color:#666>&lt;</span>Orders<span style=color:#666>&gt;</span> queryWrapper <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> LambdaQueryWrapper<span style=color:#666>&lt;&gt;();</span>
        <span style=color:#408080;font-style:italic>//查询条件
</span><span style=color:#408080;font-style:italic></span>        queryWrapper<span style=color:#666>.</span><span style=color:#7d9029>like</span><span style=color:#666>(</span>number<span style=color:#666>!=</span><span style=color:green;font-weight:700>null</span><span style=color:#666>,</span>Orders<span style=color:#666>::</span>getNumber<span style=color:#666>,</span>number<span style=color:#666>)</span>
                <span style=color:#666>.</span><span style=color:#7d9029>gt</span><span style=color:#666>(</span> StringUtils<span style=color:#666>.</span><span style=color:#7d9029>isNotBlank</span><span style=color:#666>(</span>beginTime<span style=color:#666>),</span>Orders<span style=color:#666>::</span>getOrderTime<span style=color:#666>,</span>beginTime<span style=color:#666>)</span>
                <span style=color:#666>.</span><span style=color:#7d9029>lt</span><span style=color:#666>(</span> StringUtils<span style=color:#666>.</span><span style=color:#7d9029>isNotBlank</span><span style=color:#666>(</span>endTime<span style=color:#666>),</span>Orders<span style=color:#666>::</span>getOrderTime<span style=color:#666>,</span>endTime<span style=color:#666>);</span>
        orderService<span style=color:#666>.</span><span style=color:#7d9029>page</span><span style=color:#666>(</span>pageInfo<span style=color:#666>,</span>queryWrapper<span style=color:#666>);</span>
        <span style=color:green;font-weight:700>return</span> R<span style=color:#666>.</span><span style=color:#7d9029>success</span><span style=color:#666>(</span>pageInfo<span style=color:#666>);</span>
    <span style=color:#666>}</span>
    <span style=color:#408080;font-style:italic>/**
</span><span style=color:#408080;font-style:italic>     * 订单派送状态的更改
</span><span style=color:#408080;font-style:italic>     * @param orders
</span><span style=color:#408080;font-style:italic>     * @return
</span><span style=color:#408080;font-style:italic>     */</span>
    <span style=color:#a2f>@PutMapping</span>
    <span style=color:green;font-weight:700>public</span> R<span style=color:#666>&lt;</span>Orders<span style=color:#666>&gt;</span> <span style=color:#00f>dispatch</span><span style=color:#666>(</span><span style=color:#a2f>@RequestBody</span> Orders orders<span style=color:#666>){</span>
        <span style=color:#408080;font-style:italic>//构造查询对象
</span><span style=color:#408080;font-style:italic></span>        LambdaQueryWrapper<span style=color:#666>&lt;</span>Orders<span style=color:#666>&gt;</span> queryWrapper <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> LambdaQueryWrapper<span style=color:#666>&lt;&gt;();</span>
        <span style=color:#408080;font-style:italic>//构造查询条件
</span><span style=color:#408080;font-style:italic></span>        queryWrapper<span style=color:#666>.</span><span style=color:#7d9029>eq</span><span style=color:#666>(</span>orders<span style=color:#666>.</span><span style=color:#7d9029>getId</span><span style=color:#666>()!=</span><span style=color:green;font-weight:700>null</span><span style=color:#666>,</span>Orders<span style=color:#666>::</span>getId<span style=color:#666>,</span>orders<span style=color:#666>.</span><span style=color:#7d9029>getId</span><span style=color:#666>());</span>
        Orders orderone <span style=color:#666>=</span> orderService<span style=color:#666>.</span><span style=color:#7d9029>getOne</span><span style=color:#666>(</span>queryWrapper<span style=color:#666>);</span>
        orderone<span style=color:#666>.</span><span style=color:#7d9029>setStatus</span><span style=color:#666>(</span>orders<span style=color:#666>.</span><span style=color:#7d9029>getStatus</span><span style=color:#666>());</span>
        orderService<span style=color:#666>.</span><span style=color:#7d9029>updateById</span><span style=color:#666>(</span>orderone<span style=color:#666>);</span>

        <span style=color:green;font-weight:700>return</span> R<span style=color:#666>.</span><span style=color:#7d9029>success</span><span style=color:#666>(</span>orderone<span style=color:#666>);</span>

    <span style=color:#666>}</span>

    <span style=color:#a2f>@GetMapping</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;/userPage&#34;</span><span style=color:#666>)</span>
    <span style=color:green;font-weight:700>public</span> R<span style=color:#666>&lt;</span>Page<span style=color:#666>&gt;</span> <span style=color:#00f>userpage</span><span style=color:#666>(</span><span style=color:#b00040>int</span> page<span style=color:#666>,</span><span style=color:#b00040>int</span> pageSize<span style=color:#666>){</span>
        <span style=color:green;font-weight:700>return</span> orderService<span style=color:#666>.</span><span style=color:#7d9029>userPage</span><span style=color:#666>(</span>page<span style=color:#666>,</span>pageSize<span style=color:#666>);</span>
    <span style=color:#666>}</span>
    <span style=color:#408080;font-style:italic>//客户端点击再来一单
</span><span style=color:#408080;font-style:italic></span>    <span style=color:#408080;font-style:italic>/**
</span><span style=color:#408080;font-style:italic>     * 前端点击再来一单是直接跳转到购物车的，所以为了避免数据有问题，再跳转之前我们需要把购物车的数据给清除
</span><span style=color:#408080;font-style:italic>     * ①通过orderId获取订单明细
</span><span style=color:#408080;font-style:italic>     * ②把订单明细的数据的数据塞到购物车表中，不过在此之前要先把购物车表中的数据给清除(清除的是当前登录用户的购物车表中的数据)，
</span><span style=color:#408080;font-style:italic>     * 不然就会导致再来一单的数据有问题；
</span><span style=color:#408080;font-style:italic>     * (这样可能会影响用户体验，但是对于外卖来说，用户体验的影响不是很大，电商项目就不能这么干了)
</span><span style=color:#408080;font-style:italic>     */</span>
    <span style=color:#a2f>@PostMapping</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;/again&#34;</span><span style=color:#666>)</span>
    <span style=color:green;font-weight:700>public</span> R<span style=color:#666>&lt;</span>String<span style=color:#666>&gt;</span> <span style=color:#00f>againSubmit</span><span style=color:#666>(</span><span style=color:#a2f>@RequestBody</span> Map<span style=color:#666>&lt;</span>String<span style=color:#666>,</span>String<span style=color:#666>&gt;</span> map<span style=color:#666>){</span>
        <span style=color:green;font-weight:700>return</span> orderService<span style=color:#666>.</span><span style=color:#7d9029>again</span><span style=color:#666>(</span>map<span style=color:#666>);</span>
    <span style=color:#666>}</span>
    
<span style=color:#666>}</span>


</code></pre></div><h4 id=2代码思路-1>2.代码思路<a href=#2代码思路-1 class=header-anchor arialabel=Anchor> #</a></h4><blockquote><p>1.用户下单的两个工具 /IdWorker是mybatis-plus提供的一个ID生成工具，可以生成一个全局唯一的长整形ID
//AtomicInteger是一个Java concurrent包提供的一个原子类，通过这个类可以对Integer进行一些原子操作。//原子整型数，保证线程安全</p><ol start=2><li></li></ol></blockquote><h4 id=3代码实现-2>3.代码实现<a href=#3代码实现-2 class=header-anchor arialabel=Anchor> #</a></h4><div class=highlight><pre style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#a2f>@Service</span>
<span style=color:#a2f>@Slf4j</span>
<span style=color:green;font-weight:700>public</span> <span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>OrderServiceImpl</span> <span style=color:green;font-weight:700>extends</span> ServiceImpl<span style=color:#666>&lt;</span>OrderMapper<span style=color:#666>,</span> Orders<span style=color:#666>&gt;</span> <span style=color:green;font-weight:700>implements</span> OrderService <span style=color:#666>{</span>

    <span style=color:#a2f>@Autowired</span>
    <span style=color:green;font-weight:700>private</span> ShoppingCartService shoppingCartService<span style=color:#666>;</span>

    <span style=color:#a2f>@Autowired</span>
    <span style=color:green;font-weight:700>private</span> UserService userService<span style=color:#666>;</span>

    <span style=color:#a2f>@Autowired</span>
    <span style=color:green;font-weight:700>private</span> AddressBookService addressBookService<span style=color:#666>;</span>

    <span style=color:#a2f>@Autowired</span>
    <span style=color:green;font-weight:700>private</span> OrderDetailService orderDetailService<span style=color:#666>;</span>

    <span style=color:#408080;font-style:italic>/**
</span><span style=color:#408080;font-style:italic>     * 用户下单
</span><span style=color:#408080;font-style:italic>     * @param orders
</span><span style=color:#408080;font-style:italic>     */</span>
    <span style=color:#a2f>@Transactional</span>
    <span style=color:green;font-weight:700>public</span> <span style=color:#b00040>void</span> <span style=color:#00f>submit</span><span style=color:#666>(</span>Orders orders<span style=color:#666>)</span> <span style=color:#666>{</span>
        <span style=color:#408080;font-style:italic>//获得当前用户id
</span><span style=color:#408080;font-style:italic></span>        Long userId <span style=color:#666>=</span> BaseContext<span style=color:#666>.</span><span style=color:#7d9029>getCurrentId</span><span style=color:#666>();</span>

        <span style=color:#408080;font-style:italic>//查询当前用户的购物车数据
</span><span style=color:#408080;font-style:italic></span>        LambdaQueryWrapper<span style=color:#666>&lt;</span>ShoppingCart<span style=color:#666>&gt;</span> wrapper <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> LambdaQueryWrapper<span style=color:#666>&lt;&gt;();</span>
        wrapper<span style=color:#666>.</span><span style=color:#7d9029>eq</span><span style=color:#666>(</span>ShoppingCart<span style=color:#666>::</span>getUserId<span style=color:#666>,</span>userId<span style=color:#666>);</span>
        List<span style=color:#666>&lt;</span>ShoppingCart<span style=color:#666>&gt;</span> shoppingCarts <span style=color:#666>=</span> shoppingCartService<span style=color:#666>.</span><span style=color:#7d9029>list</span><span style=color:#666>(</span>wrapper<span style=color:#666>);</span>

        <span style=color:green;font-weight:700>if</span><span style=color:#666>(</span>shoppingCarts <span style=color:#666>==</span> <span style=color:green;font-weight:700>null</span> <span style=color:#666>||</span> shoppingCarts<span style=color:#666>.</span><span style=color:#7d9029>size</span><span style=color:#666>()</span> <span style=color:#666>==</span> 0<span style=color:#666>){</span>
            <span style=color:green;font-weight:700>throw</span> <span style=color:green;font-weight:700>new</span> CustomException<span style=color:#666>(</span><span style=color:#ba2121>&#34;购物车为空，不能下单&#34;</span><span style=color:#666>);</span>
        <span style=color:#666>}</span>

        <span style=color:#408080;font-style:italic>//查询用户数据
</span><span style=color:#408080;font-style:italic></span>        User user <span style=color:#666>=</span> userService<span style=color:#666>.</span><span style=color:#7d9029>getById</span><span style=color:#666>(</span>userId<span style=color:#666>);</span>

        <span style=color:#408080;font-style:italic>//查询地址数据
</span><span style=color:#408080;font-style:italic></span>        Long addressBookId <span style=color:#666>=</span> orders<span style=color:#666>.</span><span style=color:#7d9029>getAddressBookId</span><span style=color:#666>();</span>
        AddressBook addressBook <span style=color:#666>=</span> addressBookService<span style=color:#666>.</span><span style=color:#7d9029>getById</span><span style=color:#666>(</span>addressBookId<span style=color:#666>);</span>
        <span style=color:green;font-weight:700>if</span><span style=color:#666>(</span>addressBook <span style=color:#666>==</span> <span style=color:green;font-weight:700>null</span><span style=color:#666>){</span>
            <span style=color:green;font-weight:700>throw</span> <span style=color:green;font-weight:700>new</span> CustomException<span style=color:#666>(</span><span style=color:#ba2121>&#34;用户地址信息有误，不能下单&#34;</span><span style=color:#666>);</span>
        <span style=color:#666>}</span>

        <span style=color:#b00040>long</span> orderId <span style=color:#666>=</span> IdWorker<span style=color:#666>.</span><span style=color:#7d9029>getId</span><span style=color:#666>();</span><span style=color:#408080;font-style:italic>//订单号
</span><span style=color:#408080;font-style:italic></span>            <span style=color:#408080;font-style:italic>//IdWorker是mybatis-plus提供的一个ID生成工具，可以生成一个全局唯一的长整形ID
</span><span style=color:#408080;font-style:italic></span>            <span style=color:#408080;font-style:italic>//AtomicInteger是一个Java concurrent包提供的一个原子类，通过这个类可以对Integer进行一些原子操作。
</span><span style=color:#408080;font-style:italic></span>    <span style=color:#408080;font-style:italic>//原子整型数，保证线程安全
</span><span style=color:#408080;font-style:italic></span>
        AtomicInteger amount <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> AtomicInteger<span style=color:#666>(</span>0<span style=color:#666>);</span>

        List<span style=color:#666>&lt;</span>OrderDetail<span style=color:#666>&gt;</span> orderDetails <span style=color:#666>=</span> shoppingCarts<span style=color:#666>.</span><span style=color:#7d9029>stream</span><span style=color:#666>().</span><span style=color:#7d9029>map</span><span style=color:#666>((</span>item<span style=color:#666>)</span> <span style=color:#666>-&gt;</span> <span style=color:#666>{</span>
            OrderDetail orderDetail <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> OrderDetail<span style=color:#666>();</span>
            orderDetail<span style=color:#666>.</span><span style=color:#7d9029>setOrderId</span><span style=color:#666>(</span>orderId<span style=color:#666>);</span>
            orderDetail<span style=color:#666>.</span><span style=color:#7d9029>setNumber</span><span style=color:#666>(</span>item<span style=color:#666>.</span><span style=color:#7d9029>getNumber</span><span style=color:#666>());</span>
            orderDetail<span style=color:#666>.</span><span style=color:#7d9029>setDishFlavor</span><span style=color:#666>(</span>item<span style=color:#666>.</span><span style=color:#7d9029>getDishFlavor</span><span style=color:#666>());</span>
            orderDetail<span style=color:#666>.</span><span style=color:#7d9029>setDishId</span><span style=color:#666>(</span>item<span style=color:#666>.</span><span style=color:#7d9029>getDishId</span><span style=color:#666>());</span>
            orderDetail<span style=color:#666>.</span><span style=color:#7d9029>setSetmealId</span><span style=color:#666>(</span>item<span style=color:#666>.</span><span style=color:#7d9029>getSetmealId</span><span style=color:#666>());</span>
            orderDetail<span style=color:#666>.</span><span style=color:#7d9029>setName</span><span style=color:#666>(</span>item<span style=color:#666>.</span><span style=color:#7d9029>getName</span><span style=color:#666>());</span>
            orderDetail<span style=color:#666>.</span><span style=color:#7d9029>setImage</span><span style=color:#666>(</span>item<span style=color:#666>.</span><span style=color:#7d9029>getImage</span><span style=color:#666>());</span>
            orderDetail<span style=color:#666>.</span><span style=color:#7d9029>setAmount</span><span style=color:#666>(</span>item<span style=color:#666>.</span><span style=color:#7d9029>getAmount</span><span style=color:#666>());</span>
            <span style=color:#408080;font-style:italic>//这个是累加金额操作，累加每个菜品或者套餐乘于相应的份数
</span><span style=color:#408080;font-style:italic></span>            amount<span style=color:#666>.</span><span style=color:#7d9029>addAndGet</span><span style=color:#666>(</span>item<span style=color:#666>.</span><span style=color:#7d9029>getAmount</span><span style=color:#666>().</span><span style=color:#7d9029>multiply</span><span style=color:#666>(</span><span style=color:green;font-weight:700>new</span> BigDecimal<span style=color:#666>(</span>item<span style=color:#666>.</span><span style=color:#7d9029>getNumber</span><span style=color:#666>())).</span><span style=color:#7d9029>intValue</span><span style=color:#666>());</span>
            <span style=color:green;font-weight:700>return</span> orderDetail<span style=color:#666>;</span>
        <span style=color:#666>}).</span><span style=color:#7d9029>collect</span><span style=color:#666>(</span>Collectors<span style=color:#666>.</span><span style=color:#7d9029>toList</span><span style=color:#666>());</span>
        <span style=color:#408080;font-style:italic>//    //组装订单数据
</span><span style=color:#408080;font-style:italic></span>
        orders<span style=color:#666>.</span><span style=color:#7d9029>setId</span><span style=color:#666>(</span>orderId<span style=color:#666>);</span>
        orders<span style=color:#666>.</span><span style=color:#7d9029>setOrderTime</span><span style=color:#666>(</span>LocalDateTime<span style=color:#666>.</span><span style=color:#7d9029>now</span><span style=color:#666>());</span>
        orders<span style=color:#666>.</span><span style=color:#7d9029>setCheckoutTime</span><span style=color:#666>(</span>LocalDateTime<span style=color:#666>.</span><span style=color:#7d9029>now</span><span style=color:#666>());</span>
        orders<span style=color:#666>.</span><span style=color:#7d9029>setStatus</span><span style=color:#666>(</span>2<span style=color:#666>);</span>
        orders<span style=color:#666>.</span><span style=color:#7d9029>setAmount</span><span style=color:#666>(</span><span style=color:green;font-weight:700>new</span> BigDecimal<span style=color:#666>(</span>amount<span style=color:#666>.</span><span style=color:#7d9029>get</span><span style=color:#666>()));</span><span style=color:#408080;font-style:italic>//总金额
</span><span style=color:#408080;font-style:italic></span>        <span style=color:#408080;font-style:italic>//总金额，math的API类BigDecimal，用来对超过16位有效位的数进行精确的运算。
</span><span style=color:#408080;font-style:italic></span>        orders<span style=color:#666>.</span><span style=color:#7d9029>setUserId</span><span style=color:#666>(</span>userId<span style=color:#666>);</span>
        <span style=color:#408080;font-style:italic>//    //注意：orders里面的number是订单号的意思，不是数量
</span><span style=color:#408080;font-style:italic></span>        orders<span style=color:#666>.</span><span style=color:#7d9029>setNumber</span><span style=color:#666>(</span>String<span style=color:#666>.</span><span style=color:#7d9029>valueOf</span><span style=color:#666>(</span>orderId<span style=color:#666>));</span>
        orders<span style=color:#666>.</span><span style=color:#7d9029>setUserName</span><span style=color:#666>(</span>user<span style=color:#666>.</span><span style=color:#7d9029>getName</span><span style=color:#666>());</span>
        orders<span style=color:#666>.</span><span style=color:#7d9029>setConsignee</span><span style=color:#666>(</span>addressBook<span style=color:#666>.</span><span style=color:#7d9029>getConsignee</span><span style=color:#666>());</span>
        orders<span style=color:#666>.</span><span style=color:#7d9029>setPhone</span><span style=color:#666>(</span>addressBook<span style=color:#666>.</span><span style=color:#7d9029>getPhone</span><span style=color:#666>());</span>
        orders<span style=color:#666>.</span><span style=color:#7d9029>setAddress</span><span style=color:#666>((</span>addressBook<span style=color:#666>.</span><span style=color:#7d9029>getProvinceName</span><span style=color:#666>()</span> <span style=color:#666>==</span> <span style=color:green;font-weight:700>null</span> <span style=color:#666>?</span> <span style=color:#ba2121>&#34;&#34;</span> <span style=color:#666>:</span> addressBook<span style=color:#666>.</span><span style=color:#7d9029>getProvinceName</span><span style=color:#666>())</span>
                <span style=color:#666>+</span> <span style=color:#666>(</span>addressBook<span style=color:#666>.</span><span style=color:#7d9029>getCityName</span><span style=color:#666>()</span> <span style=color:#666>==</span> <span style=color:green;font-weight:700>null</span> <span style=color:#666>?</span> <span style=color:#ba2121>&#34;&#34;</span> <span style=color:#666>:</span> addressBook<span style=color:#666>.</span><span style=color:#7d9029>getCityName</span><span style=color:#666>())</span>
                <span style=color:#666>+</span> <span style=color:#666>(</span>addressBook<span style=color:#666>.</span><span style=color:#7d9029>getDistrictName</span><span style=color:#666>()</span> <span style=color:#666>==</span> <span style=color:green;font-weight:700>null</span> <span style=color:#666>?</span> <span style=color:#ba2121>&#34;&#34;</span> <span style=color:#666>:</span> addressBook<span style=color:#666>.</span><span style=color:#7d9029>getDistrictName</span><span style=color:#666>())</span>
                <span style=color:#666>+</span> <span style=color:#666>(</span>addressBook<span style=color:#666>.</span><span style=color:#7d9029>getDetail</span><span style=color:#666>()</span> <span style=color:#666>==</span> <span style=color:green;font-weight:700>null</span> <span style=color:#666>?</span> <span style=color:#ba2121>&#34;&#34;</span> <span style=color:#666>:</span> addressBook<span style=color:#666>.</span><span style=color:#7d9029>getDetail</span><span style=color:#666>()));</span>
        <span style=color:#408080;font-style:italic>//向订单表插入数据，一条数据
</span><span style=color:#408080;font-style:italic></span>        <span style=color:green;font-weight:700>this</span><span style=color:#666>.</span><span style=color:#7d9029>save</span><span style=color:#666>(</span>orders<span style=color:#666>);</span>

        <span style=color:#408080;font-style:italic>//向订单明细表插入数据，多条数据
</span><span style=color:#408080;font-style:italic></span>        orderDetailService<span style=color:#666>.</span><span style=color:#7d9029>saveBatch</span><span style=color:#666>(</span>orderDetails<span style=color:#666>);</span>

        <span style=color:#408080;font-style:italic>//清空购物车数据
</span><span style=color:#408080;font-style:italic></span>        shoppingCartService<span style=color:#666>.</span><span style=color:#7d9029>remove</span><span style=color:#666>(</span>wrapper<span style=color:#666>);</span>
    <span style=color:#666>}</span>

    <span style=color:#a2f>@Override</span>
    <span style=color:green;font-weight:700>public</span> R<span style=color:#666>&lt;</span>Page<span style=color:#666>&gt;</span> <span style=color:#00f>userPage</span><span style=color:#666>(</span><span style=color:#b00040>int</span> page<span style=color:#666>,</span> <span style=color:#b00040>int</span> pageSize<span style=color:#666>)</span> <span style=color:#666>{</span>

            <span style=color:#408080;font-style:italic>//分页构造器对象
</span><span style=color:#408080;font-style:italic></span>            Page<span style=color:#666>&lt;</span>Orders<span style=color:#666>&gt;</span> pageInfo <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> Page<span style=color:#666>&lt;&gt;(</span>page<span style=color:#666>,</span>pageSize<span style=color:#666>);</span>
            Page<span style=color:#666>&lt;</span>OrderDto<span style=color:#666>&gt;</span> pageDto <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> Page<span style=color:#666>&lt;&gt;(</span>page<span style=color:#666>,</span>pageSize<span style=color:#666>);</span>
            <span style=color:#408080;font-style:italic>//构造条件查询对象
</span><span style=color:#408080;font-style:italic></span>            LambdaQueryWrapper<span style=color:#666>&lt;</span>Orders<span style=color:#666>&gt;</span> queryWrapper <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> LambdaQueryWrapper<span style=color:#666>&lt;&gt;();</span>
            queryWrapper<span style=color:#666>.</span><span style=color:#7d9029>eq</span><span style=color:#666>(</span>Orders<span style=color:#666>::</span>getUserId<span style=color:#666>,</span> BaseContext<span style=color:#666>.</span><span style=color:#7d9029>getCurrentId</span><span style=color:#666>());</span>
            <span style=color:#408080;font-style:italic>//这里是直接把当前用户分页的全部结果查询出来，要添加用户id作为查询条件，否则会出现用户可以查询到其他用户的订单情况
</span><span style=color:#408080;font-style:italic></span>            <span style=color:#408080;font-style:italic>//添加排序条件，根据更新时间降序排列
</span><span style=color:#408080;font-style:italic></span>            queryWrapper<span style=color:#666>.</span><span style=color:#7d9029>orderByDesc</span><span style=color:#666>(</span>Orders<span style=color:#666>::</span>getOrderTime<span style=color:#666>);</span>
           <span style=color:green;font-weight:700>this</span><span style=color:#666>.</span><span style=color:#7d9029>page</span><span style=color:#666>(</span>pageInfo<span style=color:#666>,</span> queryWrapper<span style=color:#666>);</span>

            <span style=color:#408080;font-style:italic>//通过OrderId查询对应的OrderDetail
</span><span style=color:#408080;font-style:italic></span>            LambdaQueryWrapper<span style=color:#666>&lt;</span>OrderDetail<span style=color:#666>&gt;</span> queryWrapper2 <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> LambdaQueryWrapper<span style=color:#666>&lt;&gt;();</span>

            <span style=color:#408080;font-style:italic>//对OrderDto进行需要的属性赋值
</span><span style=color:#408080;font-style:italic></span>            List<span style=color:#666>&lt;</span>Orders<span style=color:#666>&gt;</span> records <span style=color:#666>=</span> pageInfo<span style=color:#666>.</span><span style=color:#7d9029>getRecords</span><span style=color:#666>();</span>
            List<span style=color:#666>&lt;</span>OrderDto<span style=color:#666>&gt;</span> orderDtoList <span style=color:#666>=</span> records<span style=color:#666>.</span><span style=color:#7d9029>stream</span><span style=color:#666>().</span><span style=color:#7d9029>map</span><span style=color:#666>((</span>item<span style=color:#666>)</span> <span style=color:#666>-&gt;{</span>
                OrderDto orderDto <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> OrderDto<span style=color:#666>();</span>
                <span style=color:#408080;font-style:italic>//此时的orderDto对象里面orderDetails属性还是空 下面准备为它赋值
</span><span style=color:#408080;font-style:italic></span>                Long orderId <span style=color:#666>=</span> item<span style=color:#666>.</span><span style=color:#7d9029>getId</span><span style=color:#666>();</span><span style=color:#408080;font-style:italic>//获取订单id
</span><span style=color:#408080;font-style:italic></span>                List<span style=color:#666>&lt;</span>OrderDetail<span style=color:#666>&gt;</span> orderDetailList <span style=color:#666>=</span> orderDetailService<span style=color:#666>.</span><span style=color:#7d9029>getOrderDetailListByOrderId</span><span style=color:#666>(</span>orderId<span style=color:#666>);</span>
                BeanUtils<span style=color:#666>.</span><span style=color:#7d9029>copyProperties</span><span style=color:#666>(</span>item<span style=color:#666>,</span>orderDto<span style=color:#666>);</span>
                <span style=color:#408080;font-style:italic>//对orderDto进行OrderDetails属性的赋值
</span><span style=color:#408080;font-style:italic></span>                orderDto<span style=color:#666>.</span><span style=color:#7d9029>setOrderDetails</span><span style=color:#666>(</span>orderDetailList<span style=color:#666>);</span>
                log<span style=color:#666>.</span><span style=color:#7d9029>info</span><span style=color:#666>(</span>orderDto<span style=color:#666>.</span><span style=color:#7d9029>toString</span><span style=color:#666>());</span>
                <span style=color:green;font-weight:700>return</span> orderDto<span style=color:#666>;</span>
            <span style=color:#666>}).</span><span style=color:#7d9029>collect</span><span style=color:#666>(</span>Collectors<span style=color:#666>.</span><span style=color:#7d9029>toList</span><span style=color:#666>());</span>

            <span style=color:#408080;font-style:italic>//使用dto的分页
</span><span style=color:#408080;font-style:italic></span>            BeanUtils<span style=color:#666>.</span><span style=color:#7d9029>copyProperties</span><span style=color:#666>(</span>pageInfo<span style=color:#666>,</span>pageDto<span style=color:#666>,</span><span style=color:#ba2121>&#34;records&#34;</span><span style=color:#666>);</span>

            pageDto<span style=color:#666>.</span><span style=color:#7d9029>setRecords</span><span style=color:#666>(</span>orderDtoList<span style=color:#666>);</span>
            <span style=color:green;font-weight:700>return</span> R<span style=color:#666>.</span><span style=color:#7d9029>success</span><span style=color:#666>(</span>pageDto<span style=color:#666>);</span>



    <span style=color:#666>}</span>

    <span style=color:#a2f>@Override</span>
    <span style=color:green;font-weight:700>public</span> R<span style=color:#666>&lt;</span>String<span style=color:#666>&gt;</span> <span style=color:#00f>again</span><span style=color:#666>(</span>Map<span style=color:#666>&lt;</span>String<span style=color:#666>,</span> String<span style=color:#666>&gt;</span> map<span style=color:#666>)</span> <span style=color:#666>{</span>
        String ids <span style=color:#666>=</span> map<span style=color:#666>.</span><span style=color:#7d9029>get</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;id&#34;</span><span style=color:#666>);</span>

        <span style=color:#b00040>long</span> id <span style=color:#666>=</span> Long<span style=color:#666>.</span><span style=color:#7d9029>parseLong</span><span style=color:#666>(</span>ids<span style=color:#666>);</span>

        LambdaQueryWrapper<span style=color:#666>&lt;</span>OrderDetail<span style=color:#666>&gt;</span> queryWrapper <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> LambdaQueryWrapper<span style=color:#666>&lt;&gt;();</span>
        queryWrapper<span style=color:#666>.</span><span style=color:#7d9029>eq</span><span style=color:#666>(</span>OrderDetail<span style=color:#666>::</span>getOrderId<span style=color:#666>,</span>id<span style=color:#666>);</span>
        <span style=color:#408080;font-style:italic>//获取该订单对应的所有的订单明细表
</span><span style=color:#408080;font-style:italic></span>        List<span style=color:#666>&lt;</span>OrderDetail<span style=color:#666>&gt;</span> orderDetailList <span style=color:#666>=</span> orderDetailService<span style=color:#666>.</span><span style=color:#7d9029>list</span><span style=color:#666>(</span>queryWrapper<span style=color:#666>);</span>

        <span style=color:#408080;font-style:italic>//通过用户id把原来的购物车给清空，这里的clean方法是视频中讲过的,建议抽取到service中,那么这里就可以直接调用了
</span><span style=color:#408080;font-style:italic></span>        shoppingCartService<span style=color:#666>.</span><span style=color:#7d9029>clean</span><span style=color:#666>();</span>

        <span style=color:#408080;font-style:italic>//获取用户id
</span><span style=color:#408080;font-style:italic></span>        Long userId <span style=color:#666>=</span> BaseContext<span style=color:#666>.</span><span style=color:#7d9029>getCurrentId</span><span style=color:#666>();</span>
        List<span style=color:#666>&lt;</span>ShoppingCart<span style=color:#666>&gt;</span> shoppingCartList <span style=color:#666>=</span> orderDetailList<span style=color:#666>.</span><span style=color:#7d9029>stream</span><span style=color:#666>().</span><span style=color:#7d9029>map</span><span style=color:#666>((</span>item<span style=color:#666>)</span> <span style=color:#666>-&gt;</span> <span style=color:#666>{</span>
            <span style=color:#408080;font-style:italic>//把从order表中和order_details表中获取到的数据赋值给这个购物车对象
</span><span style=color:#408080;font-style:italic></span>            ShoppingCart shoppingCart <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> ShoppingCart<span style=color:#666>();</span>
            shoppingCart<span style=color:#666>.</span><span style=color:#7d9029>setUserId</span><span style=color:#666>(</span>userId<span style=color:#666>);</span>
            shoppingCart<span style=color:#666>.</span><span style=color:#7d9029>setImage</span><span style=color:#666>(</span>item<span style=color:#666>.</span><span style=color:#7d9029>getImage</span><span style=color:#666>());</span>
            Long dishId <span style=color:#666>=</span> item<span style=color:#666>.</span><span style=color:#7d9029>getDishId</span><span style=color:#666>();</span>
            Long setmealId <span style=color:#666>=</span> item<span style=color:#666>.</span><span style=color:#7d9029>getSetmealId</span><span style=color:#666>();</span>
            <span style=color:green;font-weight:700>if</span> <span style=color:#666>(</span>dishId <span style=color:#666>!=</span> <span style=color:green;font-weight:700>null</span><span style=color:#666>)</span> <span style=color:#666>{</span>
                <span style=color:#408080;font-style:italic>//如果是菜品那就添加菜品的查询条件
</span><span style=color:#408080;font-style:italic></span>                shoppingCart<span style=color:#666>.</span><span style=color:#7d9029>setDishId</span><span style=color:#666>(</span>dishId<span style=color:#666>);</span>
            <span style=color:#666>}</span> <span style=color:green;font-weight:700>else</span> <span style=color:#666>{</span>
                <span style=color:#408080;font-style:italic>//添加到购物车的是套餐
</span><span style=color:#408080;font-style:italic></span>                shoppingCart<span style=color:#666>.</span><span style=color:#7d9029>setSetmealId</span><span style=color:#666>(</span>setmealId<span style=color:#666>);</span>
            <span style=color:#666>}</span>
            shoppingCart<span style=color:#666>.</span><span style=color:#7d9029>setName</span><span style=color:#666>(</span>item<span style=color:#666>.</span><span style=color:#7d9029>getName</span><span style=color:#666>());</span>
            shoppingCart<span style=color:#666>.</span><span style=color:#7d9029>setDishFlavor</span><span style=color:#666>(</span>item<span style=color:#666>.</span><span style=color:#7d9029>getDishFlavor</span><span style=color:#666>());</span>
            shoppingCart<span style=color:#666>.</span><span style=color:#7d9029>setNumber</span><span style=color:#666>(</span>item<span style=color:#666>.</span><span style=color:#7d9029>getNumber</span><span style=color:#666>());</span>
            shoppingCart<span style=color:#666>.</span><span style=color:#7d9029>setAmount</span><span style=color:#666>(</span>item<span style=color:#666>.</span><span style=color:#7d9029>getAmount</span><span style=color:#666>());</span>
            shoppingCart<span style=color:#666>.</span><span style=color:#7d9029>setCreateTime</span><span style=color:#666>(</span>LocalDateTime<span style=color:#666>.</span><span style=color:#7d9029>now</span><span style=color:#666>());</span>
            <span style=color:green;font-weight:700>return</span> shoppingCart<span style=color:#666>;</span>
        <span style=color:#666>}).</span><span style=color:#7d9029>collect</span><span style=color:#666>(</span>Collectors<span style=color:#666>.</span><span style=color:#7d9029>toList</span><span style=color:#666>());</span>

        <span style=color:#408080;font-style:italic>//把携带数据的购物车批量插入购物车表  这个批量保存的方法要使用熟练！！！
</span><span style=color:#408080;font-style:italic></span>        shoppingCartService<span style=color:#666>.</span><span style=color:#7d9029>saveBatch</span><span style=color:#666>(</span>shoppingCartList<span style=color:#666>);</span>

        <span style=color:green;font-weight:700>return</span> R<span style=color:#666>.</span><span style=color:#7d9029>success</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;操作成功&#34;</span><span style=color:#666>);</span>

    <span style=color:#666>}</span>
    
<span style=color:#666>}</span>
</code></pre></div><h4 id=4orderdetials的一个抽离方法>4orderdetials的一个抽离方法<a href=#4orderdetials的一个抽离方法 class=header-anchor arialabel=Anchor> #</a></h4><div class=highlight><pre style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#a2f>@Service</span>
<span style=color:green;font-weight:700>public</span> <span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>OrderDetailServiceImpl</span> <span style=color:green;font-weight:700>extends</span> ServiceImpl<span style=color:#666>&lt;</span>OrderDetailMapper<span style=color:#666>,</span> OrderDetail<span style=color:#666>&gt;</span> <span style=color:green;font-weight:700>implements</span> OrderDetailService <span style=color:#666>{</span>

    <span style=color:green;font-weight:700>private</span> OrderDetailService orderDetailService<span style=color:#666>;</span>
    <span style=color:#a2f>@Override</span>
    <span style=color:green;font-weight:700>public</span> List<span style=color:#666>&lt;</span>OrderDetail<span style=color:#666>&gt;</span> <span style=color:#00f>getOrderDetailListByOrderId</span><span style=color:#666>(</span>Long orderId<span style=color:#666>)</span> <span style=color:#666>{</span>
        LambdaQueryWrapper<span style=color:#666>&lt;</span>OrderDetail<span style=color:#666>&gt;</span> queryWrapper <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> LambdaQueryWrapper<span style=color:#666>&lt;&gt;();</span>
        queryWrapper<span style=color:#666>.</span><span style=color:#7d9029>eq</span><span style=color:#666>(</span>OrderDetail<span style=color:#666>::</span>getOrderId<span style=color:#666>,</span> orderId<span style=color:#666>);</span>
        List<span style=color:#666>&lt;</span>OrderDetail<span style=color:#666>&gt;</span> orderDetailList <span style=color:#666>=</span> orderDetailService<span style=color:#666>.</span><span style=color:#7d9029>list</span><span style=color:#666>(</span>queryWrapper<span style=color:#666>);</span>
        <span style=color:green;font-weight:700>return</span> orderDetailList<span style=color:#666>;</span>
    <span style=color:#666>}</span>
    <span style=color:#408080;font-style:italic>//抽离的一个方法，通过订单id查询订单明细，得到一个订单明细的集合
</span><span style=color:#408080;font-style:italic></span>    <span style=color:#408080;font-style:italic>//这里抽离出来是为了避免在stream中遍历的时候直接使用构造条件来查询导致eq叠加，从而导致后面查询的数据都是null
</span><span style=color:#408080;font-style:italic></span>    
<span style=color:#666>}</span>
</code></pre></div><h1 id=swagger>SWagger<a href=#swagger class=header-anchor arialabel=Anchor> #</a></h1><h3 id=1-介绍>1 介绍<a href=#1-介绍 class=header-anchor arialabel=Anchor> #</a></h3><p>官网：<a href=https://swagger.io/ target=_blank rel="noreferrer noopener">API Documentation & Design Tools for Teams | Swagger</a></p><blockquote><p>Swagger 是一个规范和完整的框架，用于生成、描述、调用和可视化 RESTful 风格的 Web 服务。功能主要包含以下几点:</p><p>A. 使得前后端分离开发更加方便，有利于团队协作</p><p>B. 接口文档在线自动生成，降低后端开发人员编写接口文档的负担</p><p>C. 接口功能测试</p></blockquote><h3 id=2-使用方式>2 使用方式<a href=#2-使用方式 class=header-anchor arialabel=Anchor> #</a></h3><h3 id=1-导入knife4j的maven坐标>1). 导入knife4j的maven坐标<a href=#1-导入knife4j的maven坐标 class=header-anchor arialabel=Anchor> #</a></h3><div class=highlight><pre style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#666>&lt;</span>dependency<span style=color:#666>&gt;</span>
    <span style=color:#666>&lt;</span>groupId<span style=color:#666>&gt;</span>com<span style=color:#666>.</span><span style=color:#7d9029>github</span><span style=color:#666>.</span><span style=color:#7d9029>xiaoymin</span><span style=color:#666>&lt;/</span>groupId<span style=color:#666>&gt;</span>
    <span style=color:#666>&lt;</span>artifactId<span style=color:#666>&gt;</span>knife4j<span style=color:#666>-</span>spring<span style=color:#666>-</span>boot<span style=color:#666>-</span>starter<span style=color:#666>&lt;/</span>artifactId<span style=color:#666>&gt;</span>
    <span style=color:#666>&lt;</span>version<span style=color:#666>&gt;</span>3<span style=color:#666>.</span><span style=color:#7d9029>0</span><span style=color:#666>.</span><span style=color:#7d9029>2</span><span style=color:#666>&lt;/</span>version<span style=color:#666>&gt;</span>
<span style=color:#666>&lt;/</span>dependency<span style=color:#666>&gt;</span>
<span style=color:#666>(</span>我用的版本优点问题<span>，</span>我调低了2<span style=color:#666>.</span><span style=color:#7d9029>04</span><span style=color:#666>)</span>
</code></pre></div><h3 id=2-导入knife4j相关配置类>2). 导入knife4j相关配置类<a href=#2-导入knife4j相关配置类 class=header-anchor arialabel=Anchor> #</a></h3><blockquote><p>这里我们就不需要再创建一个新的配置类了，我们直接在WebMvcConfig配置类中声明即可。</p><p>A. 在该配置类中加上两个注解 @EnableSwagger2 @EnableKnife4j ,开启Swagger和Knife4j的功能。</p><p>B. 在配置类中声明一个Docket类型的bean, 通过该bean来指定生成文档的信息。</p></blockquote><div class=highlight><pre style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#a2f>@Slf4j</span>
<span style=color:#a2f>@Configuration</span>
<span style=color:#a2f>@EnableSwagger2</span>
<span style=color:#a2f>@EnableKnife4j</span>
<span style=color:green;font-weight:700>public</span> <span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>WebMvcConfig</span> <span style=color:green;font-weight:700>extends</span> WebMvcConfigurationSupport <span style=color:#666>{</span>
	
    <span style=color:#408080;font-style:italic>/**
</span><span style=color:#408080;font-style:italic>     * 设置静态资源映射
</span><span style=color:#408080;font-style:italic>     * @param registry
</span><span style=color:#408080;font-style:italic>     */</span>
    <span style=color:#a2f>@Override</span>
    <span style=color:green;font-weight:700>protected</span> <span style=color:#b00040>void</span> <span style=color:#00f>addResourceHandlers</span><span style=color:#666>(</span>ResourceHandlerRegistry registry<span style=color:#666>)</span> <span style=color:#666>{</span>
        log<span style=color:#666>.</span><span style=color:#7d9029>info</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;开始进行静态资源映射...&#34;</span><span style=color:#666>);</span>
        registry<span style=color:#666>.</span><span style=color:#7d9029>addResourceHandler</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;/backend/**&#34;</span><span style=color:#666>).</span><span style=color:#7d9029>addResourceLocations</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;classpath:/backend/&#34;</span><span style=color:#666>);</span>
        registry<span style=color:#666>.</span><span style=color:#7d9029>addResourceHandler</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;/front/**&#34;</span><span style=color:#666>).</span><span style=color:#7d9029>addResourceLocations</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;classpath:/front/&#34;</span><span style=color:#666>);</span>
    <span style=color:#666>}</span>
	
    <span style=color:#408080;font-style:italic>/**
</span><span style=color:#408080;font-style:italic>     * 扩展mvc框架的消息转换器
</span><span style=color:#408080;font-style:italic>     * @param converters
</span><span style=color:#408080;font-style:italic>     */</span>
    <span style=color:#a2f>@Override</span>
    <span style=color:green;font-weight:700>protected</span> <span style=color:#b00040>void</span> <span style=color:#00f>extendMessageConverters</span><span style=color:#666>(</span>List<span style=color:#666>&lt;</span>HttpMessageConverter<span style=color:#666>&lt;?&gt;&gt;</span> converters<span style=color:#666>)</span> <span style=color:#666>{</span>
        log<span style=color:#666>.</span><span style=color:#7d9029>info</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;扩展消息转换器...&#34;</span><span style=color:#666>);</span>
        <span style=color:#408080;font-style:italic>//创建消息转换器对象
</span><span style=color:#408080;font-style:italic></span>        MappingJackson2HttpMessageConverter messageConverter <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> MappingJackson2HttpMessageConverter<span style=color:#666>();</span>
        <span style=color:#408080;font-style:italic>//设置对象转换器，底层使用Jackson将Java对象转为json
</span><span style=color:#408080;font-style:italic></span>        messageConverter<span style=color:#666>.</span><span style=color:#7d9029>setObjectMapper</span><span style=color:#666>(</span><span style=color:green;font-weight:700>new</span> JacksonObjectMapper<span style=color:#666>());</span>
        <span style=color:#408080;font-style:italic>//将上面的消息转换器对象追加到mvc框架的转换器集合中
</span><span style=color:#408080;font-style:italic></span>        converters<span style=color:#666>.</span><span style=color:#7d9029>add</span><span style=color:#666>(</span>0<span style=color:#666>,</span>messageConverter<span style=color:#666>);</span>
    <span style=color:#666>}</span>
	
    <span style=color:#a2f>@Bean</span>
    <span style=color:green;font-weight:700>public</span> Docket <span style=color:#00f>createRestApi</span><span style=color:#666>()</span> <span style=color:#666>{</span>
        <span style=color:#408080;font-style:italic>// 文档类型
</span><span style=color:#408080;font-style:italic></span>        <span style=color:green;font-weight:700>return</span> <span style=color:green;font-weight:700>new</span> Docket<span style=color:#666>(</span>DocumentationType<span style=color:#666>.</span><span style=color:#7d9029>SWAGGER_2</span><span style=color:#666>)</span>
                <span style=color:#666>.</span><span style=color:#7d9029>apiInfo</span><span style=color:#666>(</span>apiInfo<span style=color:#666>())</span>
                <span style=color:#666>.</span><span style=color:#7d9029>select</span><span style=color:#666>()</span>
                <span style=color:#666>.</span><span style=color:#7d9029>apis</span><span style=color:#666>(</span>RequestHandlerSelectors<span style=color:#666>.</span><span style=color:#7d9029>basePackage</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;com.itheima.reggie.controller&#34;</span><span style=color:#666>))</span>
                <span style=color:#666>.</span><span style=color:#7d9029>paths</span><span style=color:#666>(</span>PathSelectors<span style=color:#666>.</span><span style=color:#7d9029>any</span><span style=color:#666>())</span>
                <span style=color:#666>.</span><span style=color:#7d9029>build</span><span style=color:#666>();</span>
    <span style=color:#666>}</span>
	
    <span style=color:green;font-weight:700>private</span> ApiInfo <span style=color:#00f>apiInfo</span><span style=color:#666>()</span> <span style=color:#666>{</span>
        <span style=color:green;font-weight:700>return</span> <span style=color:green;font-weight:700>new</span> ApiInfoBuilder<span style=color:#666>()</span>
                <span style=color:#666>.</span><span style=color:#7d9029>title</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;Eatting外卖&#34;</span><span style=color:#666>)</span>
                <span style=color:#666>.</span><span style=color:#7d9029>version</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;1.0&#34;</span><span style=color:#666>)</span>
                <span style=color:#666>.</span><span style=color:#7d9029>description</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;Eatting外卖接口文档&#34;</span><span style=color:#666>)</span>
                <span style=color:#666>.</span><span style=color:#7d9029>build</span><span style=color:#666>();</span>
    <span style=color:#666>}</span>
<span style=color:#666>}</span>

</code></pre></div><blockquote><p>注意： Docket声明时，指定的有一个包扫描的路径，该路径指定的是Controller所在包的路径。因为Swagger在生成接口文档时，就是根据这里指定的包路径，自动的扫描该包下的@Controller， @RestController， @RequestMapping等SpringMVC的注解，依据这些注解来生成对应的接口文档。
————————————————</p></blockquote><h3 id=3-设置静态资源映射>3). 设置静态资源映射<a href=#3-设置静态资源映射 class=header-anchor arialabel=Anchor> #</a></h3><blockquote><p>由于Swagger生成的在线文档中，涉及到很多静态资源，这些静态资源需要添加静态资源映射，否则接口文档页面无法访问。因此需要在 WebMvcConfig类中的addResourceHandlers方法中增加如下配置。</p></blockquote><pre><code>registry.addResourceHandler(&quot;doc.html&quot;).addResourceLocations(&quot;classpath:/META-INF/resources/&quot;);
registry.addResourceHandler(&quot;/webjars/**&quot;).addResourceLocations(&quot;classpath:/META-INF/resources/webjars/&quot;);
</code></pre><h3 id=4-在logincheckfilter中设置不需要处理的请求路径>4). 在LoginCheckFilter中设置不需要处理的请求路径<a href=#4-在logincheckfilter中设置不需要处理的请求路径 class=header-anchor arialabel=Anchor> #</a></h3><blockquote><p>需要将Swagger及Knife4j相关的静态资源直接放行，无需登录即可访问，否则我们就需要登录之后，才可以访问接口文档的页面。</p></blockquote><blockquote><p>在原有的不需要处理的请求路径中，再增加如下链接：</p></blockquote><div class=highlight><pre style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#ba2121>&#34;/doc.html&#34;</span><span style=color:#666>,</span>
<span style=color:#ba2121>&#34;/webjars/**&#34;</span><span style=color:#666>,</span>
<span style=color:#ba2121>&#34;/swagger-resources&#34;</span><span style=color:#666>,</span>
<span style=color:#ba2121>&#34;/v2/api-docs&#34;</span>
</code></pre></div><h3 id=3-查看接口文档>3 查看接口文档<a href=#3-查看接口文档 class=header-anchor arialabel=Anchor> #</a></h3><blockquote><p>经过上面的集成配置之后，我们的项目集成Swagger及Knife4j就已经完成了，接下来我们可以重新启动项目，访问接口文档，访问链接为： http://localhost:8080/doc.html</p></blockquote><h3 id=4-常用注解>4 常用注解<a href=#4-常用注解 class=header-anchor arialabel=Anchor> #</a></h3><blockquote><p>注解 位置 说明
@Api 类 加载Controller类上,表示对类的说明
@ApiModel 类(通常是实体类) 描述实体类的作用
@ApiModelProperty 属性 描述实体类的属性
@ApiOperation 方法 说明方法的用途、作用
@ApiImplicitParams 方法 表示一组参数说明
@ApiImplicitParam 方法 用在@ApiImplicitParams注解中，指定一个请求参数的各个方面的属性</p></blockquote><h3 id=1-实体类>1). 实体类<a href=#1-实体类 class=header-anchor arialabel=Anchor> #</a></h3><blockquote><p>可以通过 @ApiModel , @ApiModelProperty 来描述实体类及属性</p></blockquote><div class=highlight><pre style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#a2f>@Data</span>
<span style=color:#a2f>@ApiModel</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;套餐&#34;</span><span style=color:#666>)</span>
<span style=color:green;font-weight:700>public</span> <span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>Setmeal</span> <span style=color:green;font-weight:700>implements</span> Serializable <span style=color:#666>{</span>
    <span style=color:green;font-weight:700>private</span> <span style=color:green;font-weight:700>static</span> <span style=color:green;font-weight:700>final</span> <span style=color:#b00040>long</span> serialVersionUID <span style=color:#666>=</span> 1L<span style=color:#666>;</span>
    <span style=color:#a2f>@ApiModelProperty</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;主键&#34;</span><span style=color:#666>)</span>
    <span style=color:green;font-weight:700>private</span> Long id<span style=color:#666>;</span>
   
    <span style=color:#408080;font-style:italic>//分类id
</span><span style=color:#408080;font-style:italic></span>    <span style=color:#a2f>@ApiModelProperty</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;分类id&#34;</span><span style=color:#666>)</span>
    <span style=color:green;font-weight:700>private</span> Long categoryId<span style=color:#666>;</span>
  
    <span style=color:#a2f>@TableField</span><span style=color:#666>(</span>fill <span style=color:#666>=</span> FieldFill<span style=color:#666>.</span><span style=color:#7d9029>INSERT_UPDATE</span><span style=color:#666>)</span>
    <span style=color:green;font-weight:700>private</span> Long updateUser<span style=color:#666>;</span>
<span style=color:#666>}</span>

</code></pre></div><h3 id=2-响应实体r>2). 响应实体R<a href=#2-响应实体r class=header-anchor arialabel=Anchor> #</a></h3><div class=highlight><pre style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#a2f>@Data</span>
<span style=color:#a2f>@ApiModel</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;返回结果&#34;</span><span style=color:#666>)</span>
<span style=color:green;font-weight:700>public</span> <span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>R</span><span style=color:#666>&lt;</span>T<span style=color:#666>&gt;</span> <span style=color:green;font-weight:700>implements</span> Serializable<span style=color:#666>{</span>
<span style=color:#a2f>@ApiModelProperty</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;编码&#34;</span><span style=color:#666>)</span>
<span style=color:green;font-weight:700>private</span> Integer code<span style=color:#666>;</span> <span style=color:#408080;font-style:italic>//编码：1成功，0和其它数字为失败
</span><span style=color:#408080;font-style:italic></span>
<span style=color:#408080;font-style:italic>//省略静态方法 ....
</span><span style=color:#408080;font-style:italic></span><span style=color:#666>}</span>
</code></pre></div><h3 id=3-controller类及其中的方法>3). Controller类及其中的方法<a href=#3-controller类及其中的方法 class=header-anchor arialabel=Anchor> #</a></h3><blockquote><p>描述Controller、方法及其方法参数，可以通过注解： @Api， @APIOperation， @ApiImplicitParams, @ApiImplicitParam</p></blockquote><div class=highlight><pre style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#a2f>@RestController</span>
<span style=color:#a2f>@RequestMapping</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;/setmeal&#34;</span><span style=color:#666>)</span>
<span style=color:#a2f>@Slf4j</span>
<span style=color:#a2f>@Api</span><span style=color:#666>(</span>tags <span style=color:#666>=</span> <span style=color:#ba2121>&#34;套餐相关接口&#34;</span><span style=color:#666>)</span>
<span style=color:green;font-weight:700>public</span> <span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>SetmealController</span> <span style=color:#666>{</span>
<span style=color:#a2f>@PostMapping</span>
<span style=color:#a2f>@CacheEvict</span><span style=color:#666>(</span>value <span style=color:#666>=</span> <span style=color:#ba2121>&#34;setmealCache&#34;</span><span style=color:#666>,</span>allEntries <span style=color:#666>=</span> <span style=color:green;font-weight:700>true</span><span style=color:#666>)</span>
<span style=color:#a2f>@ApiOperation</span><span style=color:#666>(</span>value <span style=color:#666>=</span> <span style=color:#ba2121>&#34;新增套餐接口&#34;</span><span style=color:#666>)</span>
<span style=color:green;font-weight:700>public</span> R<span style=color:#666>&lt;</span>String<span style=color:#666>&gt;</span> <span style=color:#00f>save</span><span style=color:#666>(</span><span style=color:#a2f>@RequestBody</span> SetmealDto setmealDto<span style=color:#666>){</span>
<span style=color:#666>}</span>

<span style=color:#a2f>@GetMapping</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;/page&#34;</span><span style=color:#666>)</span>
<span style=color:#a2f>@ApiOperation</span><span style=color:#666>(</span>value <span style=color:#666>=</span> <span style=color:#ba2121>&#34;套餐分页查询接口&#34;</span><span style=color:#666>)</span>
<span style=color:#a2f>@ApiImplicitParams</span><span style=color:#666>({</span>
        <span style=color:#a2f>@ApiImplicitParam</span><span style=color:#666>(</span>name <span style=color:#666>=</span> <span style=color:#ba2121>&#34;page&#34;</span><span style=color:#666>,</span>value <span style=color:#666>=</span> <span style=color:#ba2121>&#34;页码&#34;</span><span style=color:#666>,</span>required <span style=color:#666>=</span> <span style=color:green;font-weight:700>true</span><span style=color:#666>),</span>
        <span style=color:#a2f>@ApiImplicitParam</span><span style=color:#666>(</span>name <span style=color:#666>=</span> <span style=color:#ba2121>&#34;pageSize&#34;</span><span style=color:#666>,</span>value <span style=color:#666>=</span> <span style=color:#ba2121>&#34;每页记录数&#34;</span><span style=color:#666>,</span>required <span style=color:#666>=</span> <span style=color:green;font-weight:700>true</span><span style=color:#666>),</span>
        <span style=color:#a2f>@ApiImplicitParam</span><span style=color:#666>(</span>name <span style=color:#666>=</span> <span style=color:#ba2121>&#34;name&#34;</span><span style=color:#666>,</span>value <span style=color:#666>=</span> <span style=color:#ba2121>&#34;套餐名称&#34;</span><span style=color:#666>,</span>required <span style=color:#666>=</span> <span style=color:green;font-weight:700>false</span><span style=color:#666>)</span>
<span style=color:#666>})</span>

</code></pre></div><h1 id=优化1linux部署>优化1:Linux部署<a href=#优化1linux部署 class=header-anchor arialabel=Anchor> #</a></h1><h2 id=1手动部署步骤>1.手动部署步骤<a href=#1手动部署步骤 class=header-anchor arialabel=Anchor> #</a></h2><div class=highlight><pre style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span>#</span>1<span style=color:#666>.</span><span style=color:#7d9029>将打包的reggout</span><span style=color:#666>-</span>0<span style=color:#666>.</span><span style=color:#7d9029>0</span><span style=color:#666>.</span><span style=color:#7d9029>1</span><span style=color:#666>-</span>SNAPSHOT<span style=color:#666>.</span><span style=color:#7d9029>jar部署到linux虚拟机中</span>
<span>#</span>2<span style=color:#666>.</span><span style=color:#7d9029>用nohup</span> 命令进行手动部署
    
nohug 命令用于不挂段的运行指定命令<span>，</span>退出终端不会影响程序的运行
语法说明 nohup Command<span style=color:#666>[</span>Arg<span style=color:#666>...][&amp;]</span>   
    Command要执行的命令
 Arg一些参数<span>，</span>可以指定输出文件
 <span style=color:#666>&amp;</span> 让命令在后台运行   
 举例<span>：</span>    
<span>#</span> nohup java <span style=color:#666>-</span>jar reggout<span style=color:#666>-</span>0<span style=color:#666>.</span><span style=color:#7d9029>0</span><span style=color:#666>.</span><span style=color:#7d9029>1</span><span style=color:#666>-</span>SNAPSHOT<span style=color:#666>.</span><span style=color:#7d9029>jar</span> <span style=color:#666>&amp;&gt;</span>hello<span style=color:#666>.</span><span style=color:#7d9029>log</span> <span style=color:#666>&amp;</span>
<span style=color:#666>&amp;&gt;</span>hello<span style=color:#666>.</span><span style=color:#7d9029>log将日志写入hello</span><span style=color:#666>.</span><span style=color:#7d9029>log</span>
<span>#</span>这个时候想要停止就必须要杀进程
    
 <span>#</span> ps <span style=color:#666>-</span>ef 找到所有的进程
 <span style=color:#666>[</span>root<span style=color:#a2f>@yangvm01</span> app<span style=color:#666>]</span><span>#</span> ps <span style=color:#666>-</span>ef <span style=color:#666>|</span> grep java
root       4005   2988  3 01<span style=color:#666>:</span>38 pts<span style=color:#666>/</span>1    00<span style=color:#666>:</span>00<span style=color:#666>:</span>06 java <span style=color:#666>-</span>jar reggout<span style=color:#666>-</span>0<span style=color:#666>.</span><span style=color:#7d9029>0</span><span style=color:#666>.</span><span style=color:#7d9029>1</span><span style=color:#666>-</span>SNAPSHOT<span style=color:#666>.</span><span style=color:#7d9029>jar</span>

<span style=color:#666>[</span>root<span style=color:#a2f>@yangvm01</span> app<span style=color:#666>]</span><span>#</span> kill <span style=color:#666>-</span>9 4005  杀进程
</code></pre></div><h2 id=2shell自动部署>2.shell自动部署<a href=#2shell自动部署 class=header-anchor arialabel=Anchor> #</a></h2><blockquote><p>#1.linux安装git</p><pre><code>```shell
yum git list
yum install git
```
</code></pre><p>#2.linux安装maven</p><div class=highlight><pre style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>
<span style=color:#408080;font-style:italic># 1.解压maven   </span>
tar -zxvf apache-maven-3.5.4-bin.tar.gz
<span style=color:#408080;font-style:italic>#2.在/etc/profile写入</span>
<span style=color:#408080;font-style:italic>#2.1打开</span>
vim /etc/profile
 <span style=color:#408080;font-style:italic>#2.2写入</span>
<span style=color:green>export</span> <span style=color:#19177c>MAVEN_HOME</span><span style=color:#666>=</span>/usr/local/apache-maven-3.6.1
<span style=color:green>export</span> <span style=color:#19177c>PATH</span><span style=color:#666>=</span><span style=color:#19177c>$JAVA_HOME</span>/bin:<span style=color:#19177c>$MAVEN_HOME</span>/bin:<span style=color:#19177c>$PATH</span>
 <span style=color:#408080;font-style:italic>#3.退出进行加载</span>
<span style=color:green>source</span> /etc/profile
 <span style=color:#408080;font-style:italic>#4.查看配置</span>
mvn -version
    
<span style=color:#666>[</span>root@localhost local<span style=color:#666>]</span><span style=color:#408080;font-style:italic># mkdir repo</span>
<span style=color:#666>[</span>root@localhost local<span style=color:#666>]</span><span style=color:#408080;font-style:italic># cd apache-maven-3.5.4/</span>
<span style=color:#666>[</span>root@localhost apache-maven-3.5.4<span style=color:#666>]</span><span style=color:#408080;font-style:italic># cd conf/</span>
<span style=color:#666>[</span>root@localhost conf<span style=color:#666>]</span><span style=color:#408080;font-style:italic># vim settings.xml </span>
<span style=color:#408080;font-style:italic>#5.打开mvaen的seting.xml配置 </span>

在settings标签下加上这句话设置仓库位置
&lt;localRepository&gt;/usr/local/repo&lt;/localRepository&gt;

<span style=color:#408080;font-style:italic># mkdir repo  pwd的位置 /usr/local/repo</span>
<span style=color:#408080;font-style:italic># vim 写入</span>
     &lt;localRepository&gt;/usr/local/repo&lt;/localRepository&gt;
 <span style=color:#408080;font-style:italic>#5.将shell脚本复制到    </span>
<span style=color:#408080;font-style:italic>#将shell脚本复制到linux bootStart.sh</span>
</code></pre></div><p>#3.编写shell脚本，拉去代码，编译，打包，启动</p><p>#4.为用户授予执行shelll脚本的命令
#5.执行shell脚本</p></blockquote><h2 id=1具体步骤>1.具体步骤<a href=#1具体步骤 class=header-anchor arialabel=Anchor> #</a></h2><blockquote><p>1). 在服务器B(192.168.138.101)中安装jdk、git、maven、MySQL，使用git clone命令将git远程仓库的代码克隆下来</p></blockquote><blockquote><p>A. 确认JDK环境</p><p>java -version</p><p>B. 确认Git环境</p><p>C. 确认Maven环境</p><p>mvn -v</p><p>D. 将我们开发完成的代码推送至远程仓库,并在服务器B中克隆下来</p><p>#创建java代码存放目录
mkdir -p /usr/local/javaapp</p><p>#切换目录
cd /usr/local/javaapp</p><p>#克隆代码 , 需要使用自己的远程仓库
git clone xxxx</p><p>2). 将资料中提供的reggieStart.sh文件上传到服务器B，通过chmod命令设置执行权限</p><p>chmod 777 reggieStart.sh</p><p>3). 执行reggieStart.sh脚本文件，自动部署项目</p><div class=highlight><pre style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#bc7a00>#!/bin/sh
</span><span style=color:#bc7a00></span><span style=color:green>echo</span> <span style=color:#666>=================================</span>
<span style=color:green>echo</span>  自动化部署脚本启动
<span style=color:green>echo</span> <span style=color:#666>=================================</span>

<span style=color:green>echo</span> 停止原来运行中的工程
<span style=color:#19177c>APP_NAME</span><span style=color:#666>=</span>reggie_take_out

<span style=color:#19177c>tpid</span><span style=color:#666>=</span><span style=color:#ba2121>`</span>ps -ef|grep <span style=color:#19177c>$APP_NAME</span>|grep -v grep|grep -v kill|awk <span style=color:#ba2121>&#39;{print $2}&#39;</span><span style=color:#ba2121>`</span>
<span style=color:green;font-weight:700>if</span> <span style=color:#666>[</span> <span style=color:#b68;font-weight:700>${</span><span style=color:#19177c>tpid</span><span style=color:#b68;font-weight:700>}</span> <span style=color:#666>]</span>; <span style=color:green;font-weight:700>then</span>
<span style=color:green>echo</span> <span style=color:#ba2121>&#39;Stop Process...&#39;</span>
<span style=color:green>kill</span> -15 <span style=color:#19177c>$tpid</span>
<span style=color:green;font-weight:700>fi</span>
sleep <span style=color:#666>2</span>
<span style=color:#19177c>tpid</span><span style=color:#666>=</span><span style=color:#ba2121>`</span>ps -ef|grep <span style=color:#19177c>$APP_NAME</span>|grep -v grep|grep -v kill|awk <span style=color:#ba2121>&#39;{print $2}&#39;</span><span style=color:#ba2121>`</span>
<span style=color:green;font-weight:700>if</span> <span style=color:#666>[</span> <span style=color:#b68;font-weight:700>${</span><span style=color:#19177c>tpid</span><span style=color:#b68;font-weight:700>}</span> <span style=color:#666>]</span>; <span style=color:green;font-weight:700>then</span>
<span style=color:green>echo</span> <span style=color:#ba2121>&#39;Kill Process!&#39;</span>
<span style=color:green>kill</span> -9 <span style=color:#19177c>$tpid</span>
<span style=color:green;font-weight:700>else</span>
<span style=color:green>echo</span> <span style=color:#ba2121>&#39;Stop Success!&#39;</span>
<span style=color:green;font-weight:700>fi</span>

<span style=color:green>echo</span> 准备从Git仓库拉取最新代码
<span style=color:green>cd</span> /usr/local/app/reggie_take_out

<span style=color:green>echo</span> 开始从Git仓库拉取最新代码
git pull
<span style=color:green>echo</span> 代码拉取完成

<span style=color:green>echo</span> 开始打包
<span style=color:#19177c>output</span><span style=color:#666>=</span><span style=color:#ba2121>`</span>mvn clean package -Dmaven.test.skip<span style=color:#666>=</span><span style=color:green>true</span><span style=color:#ba2121>`</span>

<span style=color:green>cd</span> target

<span style=color:green>echo</span> 启动项目
nohup java -jar reggie_take_out-1.0-SNAPSHOT.jar &amp;&gt; reggie_take_out.log &amp;
<span style=color:green>echo</span> 项目启动完成
</code></pre></div><blockquote><p>tail -f reggg.log动态查看文件内容</p></blockquote><p>4). 访问系统测试</p><p>http://192.168.138.101/ (自己虚拟机的地址)</p><p>执行完shell脚本之后，我们可以通过 ps -ef|grep java 指令，查看服务是否启动。</p></blockquote><h1 id=优化2数据库的读写分离>优化2:数据库的读写分离<a href=#优化2数据库的读写分离 class=header-anchor arialabel=Anchor> #</a></h1><h2 id=1原理>1.原理<a href=#1原理 class=header-anchor arialabel=Anchor> #</a></h2><blockquote><h2 id=11mysql主从复制二进制日志介绍>1.1MySQL主从复制（二进制日志）介绍<a href=#11mysql主从复制二进制日志介绍 class=header-anchor arialabel=Anchor> #</a></h2><blockquote><p>MySQL主从复制是一个异步的复制过程，底层是基于Mysql数据库自带的二进制日志功能。
就是一台或多台MysQL数据库(slave，即从库)从另一台NySQL数据库（master，即主库）进行日志的复制然后再解析日志并应用到自身，最终实现从库的数据和主库的数据保持一致。MySQL主从复制是NySQL数据库自带功能，无需借助第三方工具。</p></blockquote><blockquote><p>MySQL复制过程分成三步:</p><p>master将改变记录到二进制日志（binary log)
slave将master的binary log拷贝到它的中继日志（relay log）
slave重做中继日志中的事件，将改变应用到自己的数据库中</p></blockquote></blockquote><h2 id=2引入依赖>2.引入依赖<a href=#2引入依赖 class=header-anchor arialabel=Anchor> #</a></h2><h4 id=1pom依赖>1.pom依赖<a href=#1pom依赖 class=header-anchor arialabel=Anchor> #</a></h4><div class=highlight><pre style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#666>&lt;</span>dependency<span style=color:#666>&gt;</span>
	<span style=color:#666>&lt;</span>groupId<span style=color:#666>&gt;</span>org<span style=color:#666>.</span><span style=color:#7d9029>apache</span><span style=color:#666>.</span><span style=color:#7d9029>shardingsphere</span><span style=color:#666>&lt;/</span>groupId<span style=color:#666>&gt;</span>
	<span style=color:#666>&lt;</span>artifactId<span style=color:#666>&gt;</span> sharding<span style=color:#666>-</span>jdbc<span style=color:#666>-</span>spring<span style=color:#666>-</span>boot<span style=color:#666>-</span>starter<span style=color:#666>&lt;/</span>artifactId<span style=color:#666>&gt;</span>
	<span style=color:#666>&lt;</span>version<span style=color:#666>&gt;</span>4<span style=color:#666>.</span><span style=color:#7d9029>0</span><span style=color:#666>.</span><span style=color:#7d9029>0</span><span style=color:#666>-</span>RC1<span style=color:#666>&lt;/</span>version<span style=color:#666>&gt;</span>
<span style=color:#666>&lt;/</span>dependency<span style=color:#666>&gt;</span>
</code></pre></div><h4 id=2yaml配置>2.yaml配置<a href=#2yaml配置 class=header-anchor arialabel=Anchor> #</a></h4><div class=highlight><pre style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:green;font-weight:700>server</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>port</span>:<span style=color:#bbb> </span><span style=color:#666>8080</span><span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>mybatis-plus</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>configuration</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:#408080;font-style:italic>#在映射实体或者属性时，将数据库中表名和字段名中的下划线去掉，按照驼峰命名法映射</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>map-underscore-to-camel-case</span>:<span style=color:#bbb> </span><span style=color:green;font-weight:700>true</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>log-impl</span>:<span style=color:#bbb> </span>org.apache.ibatis.logging.stdout.StdOutImpl<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>global-config</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>db-config</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>id-type</span>:<span style=color:#bbb> </span>ASSIGN_ID<span style=color:#bbb>
</span><span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>spring</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>shardingsphere</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>datasource</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>names</span>:<span style=color:#bbb>
</span><span style=color:#bbb>        </span>master,slave<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:#408080;font-style:italic># 主数据源</span><span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>master</span>:<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>type</span>:<span style=color:#bbb> </span>com.alibaba.druid.pool.DruidDataSource<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>driver-class-name</span>:<span style=color:#bbb> </span>com.mysql.cj.jdbc.Driver<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>url</span>:<span style=color:#bbb> </span>jdbc:mysql://192.168.xx.xx:3306/rw?characterEncoding=utf-8<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>username</span>:<span style=color:#bbb> </span>root<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>password</span>:<span style=color:#bbb> </span><span style=color:#666>123456</span><span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:#408080;font-style:italic># 从数据源</span><span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>slave</span>:<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>type</span>:<span style=color:#bbb> </span>com.alibaba.druid.pool.DruidDataSource<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>driver-class-name</span>:<span style=color:#bbb> </span>com.mysql.cj.jdbc.Driver<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>url</span>:<span style=color:#bbb> </span>jdbc:mysql://192.168.xxx.xxx:3306/rw?characterEncoding=utf-8<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>username</span>:<span style=color:#bbb> </span>root<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>password</span>:<span style=color:#bbb> </span><span style=color:#666>123456</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>masterslave</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:#408080;font-style:italic># 读写分离配置</span><span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>load-balance-algorithm-type</span>:<span style=color:#bbb> </span>round_robin<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:#408080;font-style:italic># 最终的数据源名称</span><span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>dataSource<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:#408080;font-style:italic># 主库数据源名称</span><span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>master-data-source-name</span>:<span style=color:#bbb> </span>master<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:#408080;font-style:italic># 从库数据源名称列表，多个逗号分隔</span><span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>slave-data-source-names</span>:<span style=color:#bbb> </span>slave<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>props</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>sql</span>:<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>show</span>:<span style=color:#bbb> </span><span style=color:green;font-weight:700>true</span><span style=color:#bbb> </span><span style=color:#408080;font-style:italic>#开启SQL显示，默认false</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>main</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>allow-bean-definition-overriding</span>:<span style=color:#bbb> </span><span style=color:green;font-weight:700>true</span><span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#408080;font-style:italic>#在配置文件中配置允许bean定义覆盖配置项</span><span style=color:#bbb>
</span></code></pre></div><h1 id=优化3nginx前后端分离>优化3:nginx前后端分离<a href=#优化3nginx前后端分离 class=header-anchor arialabel=Anchor> #</a></h1><h3 id=1nginx-配置>1.Nginx 配置<a href=#1nginx-配置 class=header-anchor arialabel=Anchor> #</a></h3><blockquote><p>官网 http://nginx.org/ 版本建议：1.20.1</p></blockquote><pre><code>命令拉取安装版本（推荐）
因为Nginx是用C写的，所以要提前拉取一部分安装包
安装过程:
1、安装依赖包yum -y install gcc pcre-devel zlib-devel openssl openssl-devel
2、下载Nginx安装包wget https://nginx.org/download/nginx-1.16.1.tar.gz
3、解压tar -zxvf nginx-1.16.1.tar.gz
4、cd nginx-1.16.1
5、./configure --prefix=/usr/local/nginx
6、make &amp;&amp; make install


# vim /etc/profile
    #添加nginx的环境边框
PATH=/usr/local/nginx/sbin:$JAVA_HOME/bin:$PATH
# source /etc/profile
# 现在可以
    nginx -s reload
</code></pre><h3 id=2nginx命令>2.nginx命令<a href=#2nginx命令 class=header-anchor arialabel=Anchor> #</a></h3><p>启动之前先测试一下</p><pre><code>./nginx -v 查看版本
</code></pre><p><img src=https://img-blog.csdnimg.cn/4629e866ca0645f5a1532f0599d9ad87.png alt=在这里插入图片描述>
<img src=https://img-blog.csdnimg.cn/44a52af0649e49c8a805d4c7b0245259.png alt=在这里插入图片描述>
<img src=https://img-blog.csdnimg.cn/60441840faa042bb9ecf0b263d7485d6.png alt=在这里插入图片描述></p><blockquote><p>这样也可以启动</p><p>/usr/local/nginx/sbin/nginx</p></blockquote><blockquote><p>此时意思是会被反向代理到 proxy_pass http://192.168.8.130:8080;</p></blockquote><div class=highlight><pre style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span>#</span>user  nobody<span style=color:#666>;</span>
worker_processes  1<span style=color:#666>;</span>

<span>#</span>error_log  logs<span style=color:#666>/</span>error<span style=color:#666>.</span><span style=color:#7d9029>log</span><span style=color:#666>;</span>
<span>#</span>error_log  logs<span style=color:#666>/</span>error<span style=color:#666>.</span><span style=color:#7d9029>log</span>  notice<span style=color:#666>;</span>
<span>#</span>error_log  logs<span style=color:#666>/</span>error<span style=color:#666>.</span><span style=color:#7d9029>log</span>  info<span style=color:#666>;</span>

<span>#</span>pid        logs<span style=color:#666>/</span>nginx<span style=color:#666>.</span><span style=color:#7d9029>pid</span><span style=color:#666>;</span>


events <span style=color:#666>{</span>
    worker_connections  1024<span style=color:#666>;</span>
<span style=color:#666>}</span>


http <span style=color:#666>{</span>
    include       mime<span style=color:#666>.</span><span style=color:#7d9029>types</span><span style=color:#666>;</span>
    default_type  application<span style=color:#666>/</span>octet<span style=color:#666>-</span>stream<span style=color:#666>;</span>

    <span>#</span>log_format  main  <span>&#39;</span>$remote_addr <span style=color:#666>-</span> $remote_user <span style=color:#666>[</span>$time_local<span style=color:#666>]</span> <span style=color:#ba2121>&#34;$request&#34;</span> <span>&#39;</span>
    <span>#</span>                  <span>&#39;</span>$status $body_bytes_sent <span style=color:#ba2121>&#34;$http_referer&#34;</span> <span>&#39;</span>
    <span>#</span>                  <span>&#39;</span><span style=color:#ba2121>&#34;$http_user_agent&#34;</span> <span style=color:#ba2121>&#34;$http_x_forwarded_for&#34;</span><span>&#39;</span><span style=color:#666>;</span>

    <span>#</span>access_log  logs<span style=color:#666>/</span>access<span style=color:#666>.</span><span style=color:#7d9029>log</span>  main<span style=color:#666>;</span>

    sendfile        on<span style=color:#666>;</span>
    <span>#</span>tcp_nopush     on<span style=color:#666>;</span>

    <span>#</span>keepalive_timeout  0<span style=color:#666>;</span>
    keepalive_timeout  65<span style=color:#666>;</span>

    <span>#</span>gzip  on<span style=color:#666>;</span>

    server <span style=color:#666>{</span>
        listen       80<span style=color:#666>;</span>
        server_name  localhost<span style=color:#666>;</span>

        <span>#</span>charset koi8<span style=color:#666>-</span>r<span style=color:#666>;</span>

        <span>#</span>access_log  logs<span style=color:#666>/</span>host<span style=color:#666>.</span><span style=color:#7d9029>access</span><span style=color:#666>.</span><span style=color:#7d9029>log</span>  main<span style=color:#666>;</span>

        location <span style=color:#666>/</span> <span style=color:#666>{</span>
            root   html<span style=color:#666>/</span>dist<span style=color:#666>;</span>
            index  index<span style=color:#666>.</span><span style=color:#7d9029>html</span> index<span style=color:#666>.</span><span style=color:#7d9029>htm</span><span style=color:#666>;</span>
        <span style=color:#666>}</span>

       <span>#</span>反向代理

       location <span style=color:#666>^~</span> <span style=color:#666>/</span>api<span style=color:#666>/</span> <span style=color:#666>{</span>
	    rewrite <span style=color:#666>^/</span>api<span style=color:#666>/(.*)</span>$ <span style=color:#666>/</span>$1 <span style=color:green;font-weight:700>break</span><span style=color:#666>;</span>
	    proxy_pass http<span style=color:#666>:</span><span style=color:#408080;font-style:italic>//192.168.8.130:8080;
</span><span style=color:#408080;font-style:italic></span>	<span style=color:#666>}</span>


        <span>#</span>error_page  404              <span style=color:#666>/</span>404<span style=color:#666>.</span><span style=color:#7d9029>html</span><span style=color:#666>;</span>

        <span>#</span> redirect server error pages to the <span style=color:green;font-weight:700>static</span> page <span style=color:#666>/</span>50x<span style=color:#666>.</span><span style=color:#7d9029>html</span>
        <span>#</span>
        error_page   500 502 503 504  <span style=color:#666>/</span>50x<span style=color:#666>.</span><span style=color:#7d9029>html</span><span style=color:#666>;</span>
        location <span style=color:#666>=</span> <span style=color:#666>/</span>50x<span style=color:#666>.</span><span style=color:#7d9029>html</span> <span style=color:#666>{</span>
            root   html<span style=color:#666>;</span>
        <span style=color:#666>}</span>

        <span>#</span> proxy the PHP scripts to Apache listening on 127<span style=color:#666>.</span><span style=color:#7d9029>0</span><span style=color:#666>.</span><span style=color:#7d9029>0</span><span style=color:#666>.</span><span style=color:#7d9029>1</span><span style=color:#666>:</span>80
        <span>#</span>
        <span>#</span>location <span style=color:#666>~</span> <span>\</span><span style=color:#666>.</span><span style=color:#7d9029>php$</span> <span style=color:#666>{</span>
        <span>#</span>    proxy_pass   http<span style=color:#666>:</span><span style=color:#408080;font-style:italic>//127.0.0.1;
</span><span style=color:#408080;font-style:italic></span>        <span>#</span><span style=color:#666>}</span>

        <span>#</span> pass the PHP scripts to FastCGI server listening on 127<span style=color:#666>.</span><span style=color:#7d9029>0</span><span style=color:#666>.</span><span style=color:#7d9029>0</span><span style=color:#666>.</span><span style=color:#7d9029>1</span><span style=color:#666>:</span>9000
        <span>#</span>
        <span>#</span>location <span style=color:#666>~</span> <span>\</span><span style=color:#666>.</span><span style=color:#7d9029>php$</span> <span style=color:#666>{</span>
        <span>#</span>    root           html<span style=color:#666>;</span>
        <span>#</span>    fastcgi_pass   127<span style=color:#666>.</span><span style=color:#7d9029>0</span><span style=color:#666>.</span><span style=color:#7d9029>0</span><span style=color:#666>.</span><span style=color:#7d9029>1</span><span style=color:#666>:</span>9000<span style=color:#666>;</span>
        <span>#</span>    fastcgi_index  index<span style=color:#666>.</span><span style=color:#7d9029>php</span><span style=color:#666>;</span>
        <span>#</span>    fastcgi_param  SCRIPT_FILENAME  <span style=color:#666>/</span>scripts$fastcgi_script_name<span style=color:#666>;</span>
        <span>#</span>    include        fastcgi_params<span style=color:#666>;</span>
        <span>#</span><span style=color:#666>}</span>

        <span>#</span> deny access to <span style=color:#666>.</span><span style=color:#7d9029>htaccess</span> files<span style=color:#666>,</span> <span style=color:green;font-weight:700>if</span> Apache<span>&#39;</span>s document root
        <span>#</span> concurs with nginx<span>&#39;</span>s one
        <span>#</span>
        <span>#</span>location <span style=color:#666>~</span> <span style=color:#666>/</span><span>\</span><span style=color:#666>.</span><span style=color:#7d9029>ht</span> <span style=color:#666>{</span>
        <span>#</span>    deny  all<span style=color:#666>;</span>
        <span>#</span><span style=color:#666>}</span>
    <span style=color:#666>}</span>


    <span>#</span> another virtual host using mix of IP<span style=color:#666>-,</span> name<span style=color:#666>-,</span> and port<span style=color:#666>-</span>based configuration
    <span>#</span>
    <span>#</span>server <span style=color:#666>{</span>
    <span>#</span>    listen       8000<span style=color:#666>;</span>
    <span>#</span>    listen       somename<span style=color:#666>:</span>8080<span style=color:#666>;</span>
    <span>#</span>    server_name  somename  alias  another<span style=color:#666>.</span><span style=color:#7d9029>alias</span><span style=color:#666>;</span>

    <span>#</span>    location <span style=color:#666>/</span> <span style=color:#666>{</span>
    <span>#</span>        root   html<span style=color:#666>;</span>
    <span>#</span>        index  index<span style=color:#666>.</span><span style=color:#7d9029>html</span> index<span style=color:#666>.</span><span style=color:#7d9029>htm</span><span style=color:#666>;</span>
    <span>#</span>    <span style=color:#666>}</span>
    <span>#</span><span style=color:#666>}</span>


    <span>#</span> HTTPS server
    <span>#</span>
    <span>#</span>server <span style=color:#666>{</span>
    <span>#</span>    listen       443 ssl<span style=color:#666>;</span>
    <span>#</span>    server_name  localhost<span style=color:#666>;</span>

    <span>#</span>    ssl_certificate      cert<span style=color:#666>.</span><span style=color:#7d9029>pem</span><span style=color:#666>;</span>
    <span>#</span>    ssl_certificate_key  cert<span style=color:#666>.</span><span style=color:#7d9029>key</span><span style=color:#666>;</span>

    <span>#</span>    ssl_session_cache    shared<span style=color:#666>:</span>SSL<span style=color:#666>:</span>1m<span style=color:#666>;</span>
    <span>#</span>    ssl_session_timeout  5m<span style=color:#666>;</span>

    <span>#</span>    ssl_ciphers  HIGH<span style=color:#666>:!</span>aNULL<span style=color:#666>:!</span>MD5<span style=color:#666>;</span>
    <span>#</span>    ssl_prefer_server_ciphers  on<span style=color:#666>;</span>

    <span>#</span>    location <span style=color:#666>/</span> <span style=color:#666>{</span>
    <span>#</span>        root   html<span style=color:#666>;</span>
    <span>#</span>        index  index<span style=color:#666>.</span><span style=color:#7d9029>html</span> index<span style=color:#666>.</span><span style=color:#7d9029>htm</span><span style=color:#666>;</span>
    <span>#</span>    <span style=color:#666>}</span>
    <span>#</span><span style=color:#666>}</span>

<span style=color:#666>}</span>

</code></pre></div><h2 id=yaml配置>yaml配置<a href=#yaml配置 class=header-anchor arialabel=Anchor> #</a></h2><div class=highlight><pre style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:green;font-weight:700>server</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>port</span>:<span style=color:#bbb> </span><span style=color:#666>8080</span><span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>spring</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>application</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>reggie_take_out<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:#408080;font-style:italic>#应用的名称默认该项目名</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>datasource</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>druid</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>driver-class-name</span>:<span style=color:#bbb> </span>com.mysql.cj.jdbc.Driver<span style=color:#bbb>
</span><span style=color:#bbb>      </span>jdbc:mysql://192.168.8.1:3306/reggie?serverTimezone=Asia/Shanghai&amp;useUnicode=true&amp;characterEncoding=utf-8&amp;zeroDateTimeBehavior=convertToNull&amp;useSSL=false&amp;allowPublicKeyRetrieval=true<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:#408080;font-style:italic>#Url要改成自己的jdbc:mysql://localhost:3306/reggie?serverTimezone=UTC</span><span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#408080;font-style:italic>#      url: jdbc:mysql://localhost:3306/reggie?serverTimezone=Asia/Shanghai&amp;useUnicode=true&amp;characterEncoding=utf-8&amp;zeroDateTimeBehavior=convertToNull&amp;useSSL=false&amp;allowPublicKeyRetrieval=true</span><span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>username</span>:<span style=color:#bbb> </span>root<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>password</span>:<span style=color:#bbb> </span><span style=color:#666>123456</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>redis</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>host</span>:<span style=color:#bbb> </span><span style=color:#666>192.168.8.130</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>port</span>:<span style=color:#bbb> </span><span style=color:#666>6379</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>password</span>:<span style=color:#bbb> </span>yangroot<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>cache</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>redis</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>time-to-live</span>:<span style=color:#bbb> </span><span style=color:#666>1800000</span><span style=color:#bbb> </span><span style=color:#408080;font-style:italic>#设置缓存有效期</span><span style=color:#bbb>
</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>lettuce</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>pool</span>:<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>max-active</span>:<span style=color:#bbb> </span><span style=color:#666>10</span><span style=color:#bbb> </span><span style=color:#408080;font-style:italic>#最大连接数量</span><span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>max-idle</span>:<span style=color:#bbb> </span><span style=color:#666>10</span><span style=color:#bbb> </span><span style=color:#408080;font-style:italic>#阻塞最大等待时间</span><span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>min-idle</span>:<span style=color:#bbb> </span><span style=color:#666>1</span><span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>time-between-eviction-runs</span>:<span style=color:#bbb> </span>10s<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>database</span>:<span style=color:#bbb> </span><span style=color:#666>1</span><span style=color:#bbb> </span><span style=color:#408080;font-style:italic>#操作的数据库1，这里默认是0,我的0做的其他项目缓存</span><span style=color:#bbb>
</span><span style=color:#bbb>
</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#408080;font-style:italic># 邮箱配置</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>mail</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>host</span>:<span style=color:#bbb> </span>smtp.qq.com <span style=color:#bbb> </span><span style=color:#408080;font-style:italic># 发送邮件的服务器地址</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>username</span>:<span style=color:#bbb> </span>xxxxxx@qq.com<span style=color:#bbb> </span><span style=color:#408080;font-style:italic># 开启 IMAP/SMTP服务 的qq邮箱的账号</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span>password:xxxxxxxxxx<span style=color:#bbb> </span><span style=color:#408080;font-style:italic># 开启 IMAP/SMTP服务 获得的授权码,而不是qq邮箱的登录密码</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>default-encoding</span>:<span style=color:#bbb> </span>UTF-8<span style=color:#bbb>
</span><span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>mybatis-plus</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>configuration</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:#408080;font-style:italic>#在映射实体或者属性时，将数据库中表名和字段名中的下划线去掉，按照驼峰命名法映射</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:#408080;font-style:italic>#比如表user_name &gt; 对应表userName</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>map-underscore-to-camel-case</span>:<span style=color:#bbb> </span><span style=color:green;font-weight:700>true</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>log-impl</span>:<span style=color:#bbb> </span>org.apache.ibatis.logging.stdout.StdOutImpl<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>global-config</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:#408080;font-style:italic>#    mapper-locations: classpath:mybatis/mapper/*.xml</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>db-config</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>id-type</span>:<span style=color:#bbb> </span>ASSIGN_ID<span style=color:#bbb>
</span><span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#408080;font-style:italic>#设置一个外部配置源，输出的地址</span><span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>reggie</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>path</span>:<span style=color:#bbb> </span>/usr/local/img/<span style=color:#bbb>
</span></code></pre></div><div class=highlight><pre style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#bc7a00>#!/bin/sh
</span><span style=color:#bc7a00></span><span style=color:green>echo</span> <span style=color:#666>=================================</span>
<span style=color:green>echo</span>  自动化部署脚本启动
<span style=color:green>echo</span> <span style=color:#666>=================================</span>

<span style=color:green>echo</span> 停止原来运行中的工程
<span style=color:#19177c>APP_NAME</span><span style=color:#666>=</span>reggie_take_out

<span style=color:#19177c>tpid</span><span style=color:#666>=</span><span style=color:#ba2121>`</span>ps -ef|grep <span style=color:#19177c>$APP_NAME</span>|grep -v grep|grep -v kill|awk <span style=color:#ba2121>&#39;{print $2}&#39;</span><span style=color:#ba2121>`</span>
<span style=color:green;font-weight:700>if</span> <span style=color:#666>[</span> <span style=color:#b68;font-weight:700>${</span><span style=color:#19177c>tpid</span><span style=color:#b68;font-weight:700>}</span> <span style=color:#666>]</span>; <span style=color:green;font-weight:700>then</span>
<span style=color:green>echo</span> <span style=color:#ba2121>&#39;Stop Process...&#39;</span>
<span style=color:green>kill</span> -15 <span style=color:#19177c>$tpid</span>
<span style=color:green;font-weight:700>fi</span>
sleep <span style=color:#666>2</span>
<span style=color:#19177c>tpid</span><span style=color:#666>=</span><span style=color:#ba2121>`</span>ps -ef|grep <span style=color:#19177c>$APP_NAME</span>|grep -v grep|grep -v kill|awk <span style=color:#ba2121>&#39;{print $2}&#39;</span><span style=color:#ba2121>`</span>
<span style=color:green;font-weight:700>if</span> <span style=color:#666>[</span> <span style=color:#b68;font-weight:700>${</span><span style=color:#19177c>tpid</span><span style=color:#b68;font-weight:700>}</span> <span style=color:#666>]</span>; <span style=color:green;font-weight:700>then</span>
<span style=color:green>echo</span> <span style=color:#ba2121>&#39;Kill Process!&#39;</span>
<span style=color:green>kill</span> -9 <span style=color:#19177c>$tpid</span>
<span style=color:green;font-weight:700>else</span>
<span style=color:green>echo</span> <span style=color:#ba2121>&#39;Stop Success!&#39;</span>
<span style=color:green;font-weight:700>fi</span>

<span style=color:green>echo</span> 准备从Git仓库拉取最新代码
<span style=color:green>cd</span> /usr/local/app/reggie_take_out

<span style=color:green>echo</span> 开始从Git仓库拉取最新代码
git pull
<span style=color:green>echo</span> 代码拉取完成

<span style=color:green>echo</span> 开始打包
<span style=color:#19177c>output</span><span style=color:#666>=</span><span style=color:#ba2121>`</span>mvn clean package -Dmaven.test.skip<span style=color:#666>=</span><span style=color:green>true</span><span style=color:#ba2121>`</span>

<span style=color:green>cd</span> target

<span style=color:green>echo</span> 启动项目
nohup java -jar reggie_take_out 1.0-SNAPSHOT.jar &amp;&gt; reggie_take_out.log &amp;
<span style=color:green>echo</span> 项目启动完成
</code></pre></div><p style=color:#777>最后一次修改于 2022-12-01</p></div><a href=#top><i class="fa fa-chevron-up" style=font-size:30px;color:#000></i></a></main><footer class=footer><script type=text/javascript src=/js/math-code.js></script><script async src="//mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script><script type=text/javascript src=/js/center-img.js></script><ul class=footer-links><li><a href=/cn/posts/index.xml type=application/rss+xml title="RSS feed">订阅</a></li><li><a href=http://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh target=_blank>版权
<i class="fa fa-cc" aria-hidden=true title="Attribution-NonCommercial-ShareAlike 4.0 International"></i></a></li></ul><div class=copyright-text>©
杨星月
2020-2021</div></footer>